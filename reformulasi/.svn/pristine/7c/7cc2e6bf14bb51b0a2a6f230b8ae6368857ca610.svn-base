 
        <?php
        /* Generated by Sovdev 2 ERP CRUD Generator 2018-02-15 10:30:28 */
        /* Location: ./modules/reformulasi/controllers/export_permintaan_sample.php */
        /* Please DO NOT modify this information : */ 
         
        if ( ! defined('BASEPATH')) exit('No direct script access allowed');
        class export_permintaan_sample extends MX_Controller {
            function __construct() {
                parent::__construct();
                $this->load->library('auth_export');
                $this->db = $this->load->database('formulasi', false, true);
                $this->user = $this->auth_export->user();
                $this->url = 'export_permintaan_sample';
            }
            function index($action = '') {
                $action = $this->input->get('action');
                //Bikin Object Baru Nama nya $grid      
                $grid = new Grid;
                $grid->setTitle('Permintaan Sample');
                $grid->setTable('reformulasi.export_request_sample');      
                $grid->setUrl('export_permintaan_sample');

                //List Table
                $grid->addList('iTujuan_request','vRequest_no','dTgl_request','export_req_refor.vno_export_req_refor','dossier_upd.vNama_usulan','plc2_upb_team.vteam'); 
                $grid->setSortBy('iexport_request_sample');
                $grid->setSortOrder('Desc');  

                //List field
                $grid->addFields('iTujuan_request','vRequest_no','dTgl_request','cRequestor','iexport_req_refor','detail','iApprove_pd'); 

                //Setting Grid Width Name 
                /*
                    Kamu bisa merubah nama label dari sini, Contoh :
                    $grid->setLabel('nama field','nama field yang akan diubah');

                */
            
                
                
                $grid->setLabel('cRequestor','Requestor');
                $grid->setLabel('dossier_upd.vNama_usulan','Nama Usulan');
                $grid->setWidth('dossier_upd.vNama_usulan', '350');

                $grid->setLabel('plc2_upb_team.vteam','Team PD');
                


                $grid->setWidth('iTujuan_request', '120');
                $grid->setAlign('iTujuan_request', 'left');
                $grid->setLabel('iTujuan_request','Tujuan Request');
                $grid->setLabel('tujuan_request_sample.vNm_tujuan','Tujuan Request');
            
                $grid->setWidth('vRequest_no', '150');
                $grid->setAlign('vRequest_no', 'left');
                $grid->setLabel('vRequest_no','No Permintaan Sample');
            
                $grid->setWidth('dTgl_request', '120');
                $grid->setAlign('dTgl_request', 'left');
                $grid->setLabel('dTgl_request','Tgl Request');
            
                $grid->setWidth('iexport_req_refor', '100');
                $grid->setAlign('iexport_req_refor', 'left');
                $grid->setLabel('iexport_req_refor','No Request Refor');
                $grid->setLabel('export_req_refor.vno_export_req_refor','No Request Refor');
                $grid->setWidth('export_req_refor.vno_export_req_refor', '120');
                
            
                $grid->setWidth('iApprove_pd', '120');
                $grid->setAlign('iApprove_pd', 'left');
                $grid->setLabel('iApprove_pd','Status Approval');
            
                $grid->setWidth('cApprove_pd', '120');
                $grid->setAlign('cApprove_pd', 'left');
                $grid->setLabel('cApprove_pd','CAPPROVE_PD');
            
                $grid->setWidth('dApprove_pd', '120');
                $grid->setAlign('dApprove_pd', 'left');
                $grid->setLabel('dApprove_pd','DAPPROVE_PD');
            
                $grid->setWidth('dCreate', '120');
                $grid->setAlign('dCreate', 'left');
                $grid->setLabel('dCreate','DCREATE');
            
                $grid->setWidth('cCreated', '120');
                $grid->setAlign('cCreated', 'left');
                $grid->setLabel('cCreated','CCREATED');
            
                $grid->setWidth('dupdate', '120');
                $grid->setAlign('dupdate', 'left');
                $grid->setLabel('dupdate','DUPDATE');
            
                $grid->setWidth('cUpdate', '120');
                $grid->setAlign('cUpdate', 'left');
                $grid->setLabel('cUpdate','CUPDATE');
            
                $grid->setWidth('lDeleted', '120');
                $grid->setAlign('lDeleted', 'left');
                $grid->setLabel('lDeleted','lDeleted');
            

                //$grid->setJoinTable('reformulasi.tujuan_request_sample', 'tujuan_request_sample.iTujuan_request = export_request_sample.iTujuan_request', 'inner');
                $grid->setJoinTable('reformulasi.export_req_refor', 'export_req_refor.iexport_req_refor = export_request_sample.iexport_req_refor', 'inner');
                $grid->setJoinTable('dossier.dossier_upd', 'dossier_upd.idossier_upd_id = export_req_refor.idossier_upd_id', 'inner');
                $grid->setJoinTable('reformulasi.reformulasi_team', 'reformulasi_team.ireformulasi_team = export_req_refor.iTeamPD', 'inner');

                $grid->setRelation('iTujuan_request','reformulasi.tujuan_request_sample','iTujuan_request','vNm_tujuan','','inner',array('lDeleted'=>0),array('iTujuan_request'=>'asc'));


                $grid->setQuery('export_req_refor.lDeleted',0);
                // request refor sudah diterima
                $grid->setQuery('export_req_refor.iSubmitPD = 1 ', null); 

                //Query PD
                if($this->auth_export->is_manager()){
                    $x=$this->auth_export->dept();
                    $manager=$x['manager'];
                    if(in_array('PD', $manager)){
                        $type='PD';
                        $grid->setQuery('export_req_refor.iTeamPD IN ('.$this->auth_export->my_teams().')', null);
                    }
                    else{$type='';}
                }
                else{
                    $x=$this->auth_export->dept();
                    $team=$x['team'];
                    if(in_array('PD', $team)){
                        $type='PD';
                        $grid->setQuery('export_req_refor.iTeamPD IN ('.$this->auth_export->my_teams().')', null);
                    }
                    else{$type='';}
                }



                //$grid->changeFieldType('ideleted','combobox','',array(''=>'Pilih',0=>'Aktif',1=>'Tidak aktif'));
                //Example modifikasi GRID ERP
                /*
                    - Set Query
                        $grid->setQuery('lDeleted = 0 ', null); 
                        $grid->setQuery('plc2_upb.iupb_id IN (select distinct(bk.iupb_id) from plc2.plc2_upb_spesifikasi_fg bk where bk.iappqa=2 and bk.lDeleted=0)', null);  

                    - Join Table
                        $grid->setJoinTable('hrd.employee', 'employee.cNip = pk_master.vnip', 'inner');

                    - Change Field Name
                        $grid->changeFieldType('ideleted','combobox','',array(''=>'Pilih',0=>'Aktif',1=>'Tidak aktif'));
                */

                 //set search
                $grid->setSearch('vRequest_no','export_req_refor.vno_export_req_refor','iTujuan_request','dossier_upd.vNama_usulan');
                
                //set required
                $grid->setRequired('iTujuan_request','vRequest_no','dTgl_request','iexport_req_refor','iApprove_pd','cApprove_pd','dApprove_pd','dCreate','cCreated','dupdate','cUpdate','lDeleted'); 

                $grid->setGridView('grid');

                switch ($action) {
                    case 'json':
                            $grid->getJsonData();
                            break;
                    case 'view':
                            $grid->render_form($this->input->get('id'), true);
                            break;
                    case 'create':
                            $grid->render_form();
                            break;
                    case 'createproses':
                            echo $grid->saved_form();
                            break;
                    case 'update':
                            $grid->render_form($this->input->get('id'));
                            break;
                    case 'updateproses':
                            echo $grid->updated_form();
                            break;
                    case 'delete':
                            echo $grid->delete_row();
                            break; 
                    
                        //Ini Merupakan Standart Case Untuk Approve

                        case 'approve':
                            echo $this->approve_view();
                            break;
                        case 'approve_process':
                            echo $this->approve_process();
                            break;
                        case 'reject':
                            echo $this->reject_view();
                            break;
                        case 'reject_process':
                            echo $this->reject_process();
                            break; 
                     
                    default:
                            $grid->render_grid();
                            break;
                }
            }
            //Create Manipulate Field 

            //Jika Ingin Menambahkan Seting grid seperti button edit enable dalam kondisi tertentu
             
            function listBox_Action($row, $actions) {
                /*if ($row->vNo_Or<>'' || $row->vNo_Or<>NULL) { 
                        unset($actions['edit']);
                }
                return $actions;*/

                $logged_nip =$this->user->gNIP;
                $userLogin = $this->whoAmI($logged_nip);

                
                $iSubmit = $row->iSubmit;
                $iApprove_pd = $row->iApprove_pd;
                $cRequestor = $row->cRequestor;


                /*$update = '<button onclick="javascript:update_btn_back(\'export_permintaan_sample\', \''.base_url().'processor/reformulasi/export/permintaan/sample?company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\', this)" class="ui-button-text icon-save" id="button_save_export_permintaan_sample">Update & Submit</button>';
                $updatedraft = '<button onclick="javascript:update_draft_btn(\'export_permintaan_sample\', \''.base_url().'processor/reformulasi/export/permintaan/sample?company_id='.$this->input->get('company_id').'&draft=true&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\', this, true)" class="ui-button-text icon-save" id="button_save_export_permintaan_sample">Update as Draft</button>';


                $approve = '<button onclick="javascript:load_popup(\''.base_url().'processor/reformulasi/export/permintaan/sample?action=approve&iexport_request_sample='.$rowData['iexport_request_sample'].'&cNip='.$logged_nip.'&lvl=1&status=1&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\')" class="ui-button-text icon-save" id="button_approve_export_permintaan_sample">Approve</button>';
                $reject = '<button onclick="javascript:load_popup(\''.base_url().'processor/reformulasi/export/permintaan/sample?action=reject&iexport_request_sample='.$rowData['iexport_request_sample'].'&cNip='.$logged_nip.'&lvl=1&status=1&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\')" class="ui-button-text icon-save" id="button_reject_export_permintaan_sample">Reject</button>';

                $js = $this->load->view('export/sample/js/export_permintaan_sample_js');
                $js .= $this->load->view('export/sample/js/upload_js');*/

                /*if ($this->input->get('action') == 'view') {
                    unset($buttons['update']);
                }
                else{*/ 
                    $le_manager = false;
                    if($this->auth_export->is_manager()){
                        $x=$this->auth_export->dept();
                        $manager=$x['manager'];
                        if(in_array('PD', $manager)){
                            $type='PD';
                            $le_manager = true;
                        }else if(in_array('MIS', $manager)){
                            $type='MIS';
                            $le_manager = true;
                        }
                        else{$type='';}
                    }
                    else{
                        $x=$this->auth_export->dept();
                        $team=$x['team'];
                        if(in_array('PD', $team)){
                            $type='PD';
                        }
                        else{$type='';}
                    }

                    
                    
                    if($iSubmit > 0){
                        if($iApprove_pd == 0 ){
                            // yang bisa approve adalah manager PD

                            if( ($le_manager) and  $type == 'PD'  ){

                                //$buttons['update'] = $reject.$approve.$js;

                            }else{
                                // level bukan manager PD
                                //unset($buttons['update']);
                                unset($actions['edit']);
                            }
                            

                        }else{
                            //sudah ada approval 
                            //unset($buttons['update']);
                            unset($actions['edit']);
                        }

                    }else{
                        // masih draft , manager dan yang create yang bisa update

                        if( (  ($le_manager) and  $type == 'PD' ) ||  ($cRequestor == $logged_nip) ){
                            // jika user login sesuai dengan inisiator
                            //$buttons['update'] = $updatedraft.$update.$js;
                        }else{
                            //unset($buttons['update']);  
                            unset($actions['edit']); 
                        }

                    }


                        
                //}
                
                return $actions;

            } 
            

            function whoAmI($nip){
                $sql = 'select b.vDescription as vdepartemen,a.*,b.*,c.iLvlemp 
                        from hrd.employee a 
                        join hrd.msdepartement b on b.iDeptID=a.iDepartementID
                        join hrd.position c on c.iPostId=a.iPostID
                        where a.cNip ="'.$nip.'"
                        ';
                $data = $this->db->query($sql)->row_array();
                return $data;
            }

            
            function insertBox_export_permintaan_sample_iTujuan_request($field, $id) {
                //$teams = $this->db->get_where('reformulasi.tujuan_request_sample', array('lDeleted' => 0,'iTujuan_request' <> 1))->result_array();
                $sql = 'select * from reformulasi.tujuan_request_sample a where a.lDeleted=0 and a.iTujuan_request ';
                $teams = $this->db->query($sql)->result_array();
                $o = '<select class="required" name="'.$field.'" id="'.$id.'">';
                $o .= '<option value="">--Select--</option>';
                foreach ($teams as $t) {
                    $o .= '<option value="'.$t['iTujuan_request'].'">'.$t['vNm_tujuan'].'</option>';
                }
                $o .= '</select>';

                $o .= '<script type="text/javascript">';
                        $o .=  '
                            $("#'.$id.'").off();
                            $("#'.$id.'").on("change",function(){
                                $("#'.$this->url.'_vno_export_req_refor").val("");
                                $("#'.$this->url.'_iexport_req_refor").val("");

                                $("#'.$this->url.'_vUpd_no").html("");
                                $("#'.$this->url.'_vNama_usulan").html("");
                                $("#'.$this->url.'_iTeamPD").html("");
                                $("#'.$this->url.'_iTeamAndev").html("");
                                

                                var tuju = $("#'.$id.'").val();
                                if(tuju == ""){
                                    $(".bt_brow").hide();
                                }else if (tuju==1){
                                    $(".bt_brow").hide();
                                    $(".bt_brow[tuju=1]").show();
                                }else if (tuju==2){
                                    $(".bt_brow").hide();
                                    $(".bt_brow[tuju=2]").show();
                                }else if (tuju==3){
                                    $(".bt_brow").hide();
                                    $(".bt_brow[tuju=3]").show();
                                }else if (tuju==4){
                                    $(".bt_brow").hide();
                                    $(".bt_brow[tuju=4]").show();
                                }else if (tuju==5){
                                    $(".bt_brow").hide();
                                    $(".bt_brow[tuju=5]").show();
                                }else if (tuju==6){
                                    $(".bt_brow").hide();
                                    $(".bt_brow[tuju=6]").show();
                                }else if (tuju==7){
                                    $(".bt_brow").hide();
                                    $(".bt_brow[tuju=7]").show();
                                }


                                
                            })' ;
                $o .= '</script>';


                return $o;
            }
           /* function updateBox_upb_daftar_iGroup_produk($field, $id, $value, $rowData) {
                $sql = "select * from plc2.master_group_produk a where a.lDeleted=0 ";
                $teams = $this->db->query($sql)->result_array();
                $echo = '<select class="required" name="'.$id.'" id="'.$id.'">';
                $echo .= '<option value="">--Pilih--</option>';
                foreach($teams as $t) {
                    $selected = $rowData['iGroup_produk'] == $t['imaster_group_produk'] ? 'selected' : '';
                    $echo .= '<option '.$selected.' value="'.$t['imaster_group_produk'].'">'.$t['vNama_Group'].'</option>';
                }
                $echo .= '</select>';
                return $echo;
            }*/


            function updateBox_export_permintaan_sample_iTujuan_request($field, $id, $value, $rowData) {
                $sql = 'select * from reformulasi.tujuan_request_sample a where a.lDeleted=0 and a.iTujuan_request = "'.$value.'" ';
                $teams = $this->db->query($sql)->row_array();

                if ($this->input->get('action') == 'view') {
                     $return= $teams['vNm_tujuan']; 
                }else{
                $return = '<input type="hidden" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="10" value="'.$value.'"/>';
                $return .= $teams['vNm_tujuan']; 
                
                } 
                return $return;
            }   
            
            function insertBox_export_permintaan_sample_vRequest_no($field, $id) {
                $o = '<label title="Auto Number">Auto Number</label>';
                $o .= '<input type="hidden" name="isdraft" id="isdraft">';
                

                return $o;
            }



            function updateBox_export_permintaan_sample_vRequest_no($field, $id, $value, $rowData) {
                $o = "<input type='hidden' name='".$field."' id='".$id."' readonly='readonly' value='".$value."'/>";
                $o .= "<label title='Auto Number'>".$value."</label>";
                $o .= '<input type="hidden" name="isdraft" id="isdraft">';
                return $o;
            }

            
            function insertBox_export_permintaan_sample_dTgl_request($field, $id) {
                $now = date('Y-m-d');
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'" value="'.$now.'" readonly="readonly" class="input_rows1 required" size="8" />';
                return $return;
            }
            function updateBox_export_permintaan_sample_dTgl_request($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="8" readonly="readonly" value="'.$value.'"/>';
                } 
                return $return;
            }  

            function insertBox_export_permintaan_sample_cRequestor($field, $id) {
                $nip = $this->user->gNIP;
                $iAm = $this->whoAmI($this->user->gNIP);

                $return = '<input type="hidden" name="'.$field.'"  id="'.$id.'" value="'.$nip.'" readonly="readonly" class="input_rows1 required" size="8" />';
                $return .=  $iAm['cNip'].' - '.$iAm['vName'];

                return $return;
            }
            function updateBox_export_permintaan_sample_cRequestor($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                    
                    $iAm = $this->whoAmI($value);

                    $return = '<input type="hidden" name="'.$field.'"  id="'.$id.'" value="'.$iAm['cNip'].'" readonly="readonly" class="input_rows1 required" size="8" />';
                    $return .=  $iAm['cNip'].' - '.$iAm['vName'];

                }else{
                    $iAm = $this->whoAmI($value);

                    $return = '<input type="hidden" name="'.$field.'"  id="'.$id.'" value="'.$iAm['cNip'].'" readonly="readonly" class="input_rows1 required" size="8" />';
                    $return .=  $iAm['cNip'].' - '.$iAm['vName'];

                } 
                return $return;
            }  

            
            function insertBox_export_permintaan_sample_iexport_req_refor($field, $id) {     
                $uri = 'export_permintaan_sample';
                $o = "";  
                $o   .= "<div style='
                                padding: 3px;
                                width: 500px;
                                border: 1px solid rgba(51, 23, 93, 0.2);
                                background-color: #FFF;'>";
                
                
                $o   .= "<table border='0' style='width: 100%;'>
                            <tbody>";  
                $o  .="         <tr>
                                    <td width='20%'>No Request Refor</td>
                                    <td>:</td>
                                    <td width='75%'>";
                $o .= '         <input type="hidden" name="'.$field.'"  id="'.$id.'"  class="'.$id.' input_rows1 required" size="30" />';
                $o .= '         <input readonly type="text" name="'.$uri.'_vno_export_req_refor"  id="'.$uri.'_vno_export_req_refor"  class="'.$uri.'_vno_export_req_refor required input_rows1" size="30" />';
                $o .= '&nbsp;';
                    $sqlt = 'select a.iTujuan_request,a.vNm_tujuan from reformulasi.tujuan_request_sample a where a.lDeleted=0';
                    //echo $sqlt;
                    $dtuj = $this->db->query($sqlt)->result_array();
                    foreach ($dtuj as $tuj ) {
                        $o .= '         <button class="icon_pop bt_brow" tuju="'.$tuj['iTujuan_request'].'"  onclick="browse(\''.base_url().'processor/reformulasi/export/browse/request/sample/?field='.$uri.'&tujuan_request_sample='.$tuj['iTujuan_request'].'\',\'Request Reformulasi Export\')" type="button">Browse</button>';                      
                    }
                
               
                $o  .="             </td>
                                </tr>
                                
                                <tr>
                                    <td width='20%'>No UPD</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_vUpd_no' id='".$uri."_vUpd_no'></span> 
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>Nama Usulan</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_vNama_usulan' id='".$uri."_vNama_usulan'></span> 
                                    </td>
                                </tr>
                                 

                                <tr>
                                    <td width='20%'>Team PD</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_iTeamPD' id='".$uri."_iTeamPD'></span>  
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>Team Andev</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_iTeamAndev' id='".$uri."_iTeamAndev'></span>  
                                    </td>
                                </tr>
                                
                                
                            </tbody>    
                        </table>"; 
                $o .= "    </div>";  

                $o .= '<script>
                        

                        $(".bt_brow").hide();

                        $( "button.icon_pop" ).button({
                            icons: {
                                primary: "ui-icon-newwin"
                            }, 
                        })
                    </script>';

                     
                return $o;
            }
            function updateBox_export_permintaan_sample_iexport_req_refor($field, $id, $value, $rowData) {
                $sql = "SELECT * FROM reformulasi.`export_req_refor` lr 
                        join dossier.dossier_upd b on b.idossier_upd_id=lr.idossier_upd_id
                        WHERE lr.`lDeleted` = 0 AND lr.`iexport_req_refor` = '".$value."'";
                $dt = $this->db->query($sql)->row_array();

                //print_r($dt);
                
                $_vno_export_req_refor='';
                $vUpd_no = ''; 
                $vNama_usulan = '';
                $_iteam_pd = '';
                $_iteam_ad = '';
                
                
                if(!empty($dt['iexport_req_refor'])){
                        


                        $_vno_export_req_refor = $dt['vno_export_req_refor'];
                        $vUpd_no = $dt['vUpd_no'];
                        $vNama_usulan = $dt['vNama_usulan'];



                        $pd = "SELECT r.vteam FROM reformulasi.`reformulasi_team` r WHERE r.lDeleted=0 
                            AND r.ireformulasi_team= '".$dt['iteam_pd']."'";
                        $c_pd = $this->db->Query($pd)->row_array();
                        if(empty($c_pd['vteam'])){
                            $c_pd['vteam'] = '-';
                        }


                        

                        $pd = "SELECT r.vteam FROM reformulasi.`reformulasi_team` r WHERE r.lDeleted=0 AND r.ireformulasi_team= '".$dt['iTeamPD']."'";
                        $c_pd = $this->db->Query($pd)->row_array();
                        if(empty($c_pd['vteam'])){
                            $c_pd['vteam'] = '-';
                        }
                        $_iteam_pd=$c_pd['vteam'];

                        $ad = "SELECT r.vteam FROM reformulasi.`reformulasi_team` r WHERE r.lDeleted=0 AND r.ireformulasi_team= '".$dt['iTeamAndev']."'";
                        $c_ad = $this->db->Query($ad)->row_array();
                        if(empty($c_ad['vteam'])){
                            $c_ad['vteam'] = '-';
                        }

                        $_iteam_ad=$c_ad['vteam'];


                        
                }

                $uri = 'export_permintaan_sample';
                $o = "";  
                $o   .= "<div style='
                                padding: 3px;
                                width: 500px;
                                border: 1px solid rgba(51, 23, 93, 0.2);
                                background-color: #FFF;'>";
                
                
                $o   .= "<table border='0' style='width: 100%;'>
                            <tbody>";  
                $o  .="         <tr>
                                    <td width='20%'>No Request Refor</td>
                                    <td>:</td>
                                    <td width='75%'>";
                $o .= '         <input type="hidden" name="'.$field.'"  id="'.$id.'"  class="'.$id.' input_rows1 required" size="30" value="'.$value.'"/>';
                $o .= '         <input readonly type="text" name="'.$uri.'_vno_export_req_refor"  id="'.$uri.'_vno_export_req_refor"  class="'.$uri.'_vno_export_req_refor required input_rows1" size="10" value="'.$_vno_export_req_refor.'"/>';
                if($rowData['iSubmit']==0){
                    $o .= '&nbsp;';
                    $sqlt = 'select a.iTujuan_request,a.vNm_tujuan from reformulasi.tujuan_request_sample a where a.lDeleted=0 and a.iTujuan_request="'.$rowData['iTujuan_request'].'" ';
                    //echo $sqlt;
                    $dtuj = $this->db->query($sqlt)->result_array();
                    foreach ($dtuj as $tuj ) {
                       /* $o .= '         <button class="icon_pop bt_brow" tuju="'.$tuj['iTujuan_request'].'"  onclick="browse(\''.base_url().'processor/reformulasi/export/browse/request/sample/?field='.$uri.'&tujuan_request_sample='.$tuj['iTujuan_request'].'\',\'Request Reformulasi Export\')" type="button">Browse</button>';*/                      
                    }
                }
                $o  .="             </td>
                                </tr>

                                <tr>
                                    <td width='20%'>No UPD</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_vUpd_no' id='".$uri."_vUpd_no'>".$vUpd_no."</span>
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>Nama Usulan</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_vNama_usulan' id='".$uri."_vNama_usulan'>".$vNama_usulan."</span>
                                    </td>
                                </tr>
                                 

                                <tr>
                                    <td width='20%'>Team PD</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_iTeamPD' id='".$uri."_iTeamPD'>".$_iteam_pd."</span>
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>Team Andev</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_iTeamAndev' id='".$uri."_iTeamAndev'>".$_iteam_ad."</span>
                                    </td>
                                </tr>
                            </tbody>    
                        </table>"; 
                $o .= "    </div>";  

                $o .= '<script>
                        //$(".bt_brow").hide();
                        $( "button.icon_pop" ).button({
                            icons: {
                                primary: "ui-icon-newwin"
                            }, 
                        })
                    </script>';

                     
                return $o;
            }  





            function insertBox_export_permintaan_sample_iApprove_pd($field, $id) {
                $o='-';
                $o.='
                <script type="text/javascript">
                    // datepicker
                     $(".tanggal").datepicker({changeMonth:true,
                                                changeYear:true,
                                                dateFormat:"yy-mm-dd" });

                    // input number
                       $(".angka").numeric();
                </script>
                ';

                return $o;
            }

            function updateBox_export_permintaan_sample_iApprove_pd($field, $id, $value, $rowData) {
                if(($value <> 0) || (!empty($value))){
                    $sql_dtapp = 'select * 
                                from reformulasi.export_request_sample a 
                                join hrd.employee b on b.cNip=a.cApprove_pd
                                where
                                a.lDeleted = 0
                                and  a.iexport_request_sample = "'.$rowData['iexport_request_sample'].'"';
                    $row = $this->db->query($sql_dtapp)->row_array();
                    if($value==2){
                        $st='<p style="color:green;font-size:120%;">Approved';
                        $ret= $st.' oleh '.$row['vName'].' pada '.$row['dApprove_pd'].'</br> Alasan: '.$row['vRemark'].'</p>';
                    }
                    elseif($value==1){
                        $st='<p style="color:red;font-size:120%;">Rejected';
                        $ret= $st.' oleh '.$row['vName'].' pada '.$row['dApprove_pd'].'</br> Alasan: '.$row['vRemark'].'</p>';
                    } 
                    
                }
                else{
                    $ret='Waiting for Approval';
                }
                

                $ret.='
                <script type="text/javascript">
                    // datepicker
                     $(".tanggal").datepicker({changeMonth:true,
                                                changeYear:true,
                                                dateFormat:"yy-mm-dd" });

                    // input number
                       $(".angka").numeric();
                </script>
                ';

                return $ret;
            }

            
            function updateBox_export_permintaan_sample_detail($name, $id, $value, $rowData) {
                /*$this->load->helper('search_array');*/
                $this->db->where('iexport_request_sample', $rowData['iexport_request_sample']);
                $this->db->where('lDeleted', 0);
                $this->db->order_by('iexport_request_sample', 'asc');
                $data['rows'] = $this->db->get('reformulasi.export_request_sample_detail')->result_array();
                $data['browse_url'] = base_url().'processor/reformulasi/browse/bb';
                return $this->load->view('export/sample/detail_permintaan_sample', $data, TRUE);
            }
            function insertBox_export_permintaan_sample_detail($name, $id) {
                //$this->load->helper('search_array');
                $data['rows'] = array();
                $data['browse_url'] = base_url().'processor/reformulasi/browse/bb';
                return $this->load->view('export/sample/detail_permintaan_sample', $data, TRUE);
            }


            function insertBox_export_permintaan_sample_cApprove_pd($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" maxlength = "50" />';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                    var len = this.value.length;
                                        if (len >= 250) {
                                            this.value = this.value.substring(0, 50);
                                        }
                                    $("#maxlengthnote_'.$id.'").text(50 - len);
                                });
                             </script>';
                $return .= '<br/>tersisa <span id="maxlengthnote_'.$id.'">50</span> karakter<br/>';
                return $return;
            }
            function updateBox_export_permintaan_sample_cApprove_pd($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" maxlength = "50"  value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                    var len = this.value.length;
                                        if (len >= 50) {
                                            this.value = this.value.substring(0, 50);
                                        }
                                    $("#maxlengthnote_'.$id.'").text(50 - len);
                                });
                             </script>';
                $return .= '<br/>tersisa <span id="maxlengthnote_'.$id.'">50</span> karakter<br/>';

                } 
                return $return;
            }   
            
            function insertBox_export_permintaan_sample_dApprove_pd($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_export_permintaan_sample_dApprove_pd($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                } 
                return $return;
            }   
            
            function insertBox_export_permintaan_sample_dCreate($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_export_permintaan_sample_dCreate($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                } 
                return $return;
            }   
            
            function insertBox_export_permintaan_sample_cCreated($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" maxlength = "50" />';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                    var len = this.value.length;
                                        if (len >= 250) {
                                            this.value = this.value.substring(0, 50);
                                        }
                                    $("#maxlengthnote_'.$id.'").text(50 - len);
                                });
                             </script>';
                $return .= '<br/>tersisa <span id="maxlengthnote_'.$id.'">50</span> karakter<br/>';
                return $return;
            }
            function updateBox_export_permintaan_sample_cCreated($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" maxlength = "50"  value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                    var len = this.value.length;
                                        if (len >= 50) {
                                            this.value = this.value.substring(0, 50);
                                        }
                                    $("#maxlengthnote_'.$id.'").text(50 - len);
                                });
                             </script>';
                $return .= '<br/>tersisa <span id="maxlengthnote_'.$id.'">50</span> karakter<br/>';

                } 
                return $return;
            }   
            
            function insertBox_export_permintaan_sample_dupdate($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_export_permintaan_sample_dupdate($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                } 
                return $return;
            }   
            
            function insertBox_export_permintaan_sample_cUpdate($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" maxlength = "50" />';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                    var len = this.value.length;
                                        if (len >= 250) {
                                            this.value = this.value.substring(0, 50);
                                        }
                                    $("#maxlengthnote_'.$id.'").text(50 - len);
                                });
                             </script>';
                $return .= '<br/>tersisa <span id="maxlengthnote_'.$id.'">50</span> karakter<br/>';
                return $return;
            }
            function updateBox_export_permintaan_sample_cUpdate($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" maxlength = "50"  value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                    var len = this.value.length;
                                        if (len >= 50) {
                                            this.value = this.value.substring(0, 50);
                                        }
                                    $("#maxlengthnote_'.$id.'").text(50 - len);
                                });
                             </script>';
                $return .= '<br/>tersisa <span id="maxlengthnote_'.$id.'">50</span> karakter<br/>';

                } 
                return $return;
            }   
            
            function insertBox_export_permintaan_sample_lDeleted($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                     this.value = this.value.replace(/[^0-9\.]/g,"");
                                });
                             </script>';
                return $return;
            }
            function updateBox_export_permintaan_sample_lDeleted($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                     this.value = this.value.replace(/[^0-9\.]/g,"");
                                });
                             </script>';
                } 
                return $return;
            }   
            
            
                //Ini Merupakan Standart Approve yang digunakan di erp
 
                function approve_view() {
                    $echo = '<script type="text/javascript">
                                 function submit_ajax(form_id) {
                                    return $.ajax({
                                        url: $("#"+form_id).attr("action"),
                                        type: $("#"+form_id).attr("method"),
                                        data: $("#"+form_id).serialize(),
                                        success: function(data) {
                                            var o = $.parseJSON(data);
                                            var last_id = o.last_id;
                                            var url = "'.base_url().'processor/reformulasi/export/permintaan/sample";  
                                            var grid =  "export_permintaan_sample";                          
                                            if(o.status == true) { 
                                                $("#alert_dialog_form").dialog("close");
                                                     $.get(url+"?action=update&id="+last_id, function(data) {
                                                     $("div#form_export_permintaan_sample").html(data);
                                                     
                                                });
                                                
                                            }
                                                var  full = $("#infomodule").text().split(":");
                                                var part1 = full[1].split("/");
                                                //alert(part1[1]);
                                                reload_grid_new(part1[1],grid);

                                        }
                                        
                                     })
                                 }
                             </script>';
                    $echo .= '<h1>Approve</h1><br />';
                    $echo .= '<form id="form_export_permintaan_sample_approve" action="'.base_url().'processor/reformulasi/export/permintaan/sample?action=approve_process" method="post">';
                    $echo .= '<div style="vertical-align: top;">';
                    $echo .= 'Remark : 
                            <input type="hidden" name="iexport_request_sample" value="'.$this->input->get('iexport_request_sample').'" />
                            <input type="hidden" name="lvl" value="'.$this->input->get('lvl').'" />
                            <input type="hidden" name="group_id" value="'.$this->input->get('group_id').'" />
                            <input type="hidden" name="modul_id" value="'.$this->input->get('modul_id').'" />
                            <textarea name="vRemark"></textarea>
                    <button type="button" onclick="submit_ajax(\'form_export_permintaan_sample_approve\')">Approve</button>';
                        
                    $echo .= '</div>';
                    $echo .= '</form>';
                    return $echo;
                } 
 
                function approve_process() {
                    $post = $this->input->post();
                    $cNip= $this->user->gNIP;
                    $vName= $this->user->gName;
                    $iexport_request_sample = $post['iexport_request_sample'];
                    
                    $vRemark = $post['vRemark'];
                    
                    
                    $data=array('iApprove_pd'=>'2','cApprove_pd'=>$cNip , 'dApprove_pd'=>date('Y-m-d H:i:s'), 'vRemark'=>$vRemark);
                    $this -> db -> where('iexport_request_sample', $iexport_request_sample);
                    $updet = $this -> db -> update('reformulasi.export_request_sample', $data);

                    if ($updet) {
                        $qsql="select * 
                            from reformulasi.export_request_sample a 
                            join hrd.employee b on b.cNip=a.cRequestor
                            where a.lDeleted=0
                            and a.iexport_request_sample='".$iexport_request_sample."'";
                        $rsql = $this->db->query($qsql)->row_array();

                        // kirim notifikasi message ERp
                        $sqlEmpAr = 'select * from reformulasi.mailsparam a where a.cVariable="export_permintaan_sample_app "';
                        $dEmpAr =  $this->db->query($sqlEmpAr)->row_array();

                           

                        $to = $dEmpAr['vTo'];
                        $cc = $dEmpAr['vCc'];
                        //$to = $cc = '';
                        //$to = $rsql['mgr_mail'];
                        //$cc = $iAm['vEmail'].','.$Requestor['vEmail'];

                       // $subject="Approval Reformulasi: No Request ".$rsql['vNo_req_refor'];
                        $subject = 'Reformulasi - Permintaan Sample '.$rsql['vRequest_no'];
                        $content="
                            Diberitahukan bahwa telah ada Approval Permintaan Sample dengan rincian sebagai berikut :<br><br>  
                                <table border='0' style='width: 600px;'>
                                    <tr>
                                            <td style='width: 110px;'><b>Requestor </b></td><td style='width: 20px;'> : </td>
                                            <td>".$rsql['cNip'].' || '.$rsql['vName']."</td>
                                    </tr>
                                    <tr>
                                            <td><b>No Request  </b></td><td> : </td>
                                            <td>".$rsql['vRequest_no']."</td>
                                    </tr> 
                                    <tr>
                                            <td><b>Tanggal Request  </b></td><td> : </td>
                                            <td>".$rsql['dTgl_request']."</td>
                                    </tr> 
                                </table> 

                            <br/> <br/>
                            Demikian, mohon segera follow up  pada aplikasi ERP Reformulasi. Terimakasih.<br><br><br>
                            Post Master"; 
                            //$this->lib_utilitas->send_email($to, $cc, $subject, $content);
                        //$content="ini content";
                            

                        $this->sess_auth->send_message_erp($this->uri->segment_array(),$to, $cc, $subject, $content);



                    } 
                    //Letakan Query Update approve disini

                    $data['status']  = true;
                    $data['last_id'] = $post['iexport_request_sample'];
                    return json_encode($data);
                }
            

        
            
                //Ini Merupakan Standart Reject yang digunakan di erp

                function reject_view() {
                    $echo = '<script type="text/javascript">
                                 function submit_ajax(form_id) {
                                    var remark = $("#export_permintaan_sample_remark").val();
                                    if (remark=="") {
                                        alert("Remark tidak boleh kosong ");
                                        return
                                    }

                                    return $.ajax({
                                        url: $("#"+form_id).attr("action"),
                                        type: $("#"+form_id).attr("method"),
                                        data: $("#"+form_id).serialize(),
                                        success: function(data) {
                                            var o = $.parseJSON(data);
                                            var last_id = o.last_id;
                                            var url = "'.base_url().'processor/reformulasi/export/permintaan/sample";                             
                                            if(o.status == true) { 
                                                $("#alert_dialog_form").dialog("close");
                                                     $.get(url+"?action=update&id="+last_id, function(data) {
                                                     $("div#form_export_permintaan_sample").html(data);
                                                     
                                                });
                                                
                                            }
                                                reload_grid("grid_export_permintaan_sample");
                                        }
                                        
                                     })
                                 }
                             </script>';
                    $echo .= '<h1>Reject</h1><br />';
                    $echo .= '<form id="form_export_permintaan_sample_reject" action="'.base_url().'processor/reformulasi/export/permintaan/sample?action=reject_process" method="post">';
                    $echo .= '<div style="vertical-align: top;">';
                    $echo .= 'Remark : 
                            <input type="hidden" name="iexport_request_sample" value="'.$this->input->get('iexport_request_sample').'" />
                            <input type="hidden" name="lvl" value="'.$this->input->get('lvl').'" />
                            <input type="hidden" name="group_id" value="'.$this->input->get('group_id').'" />
                            <input type="hidden" name="modul_id" value="'.$this->input->get('modul_id').'" />
                            <textarea name="vRemark" id="reject_export_permintaan_sample_remark"></textarea>
                    <button type="button" onclick="submit_ajax(\'form_export_permintaan_sample_reject\')">Reject</button>';
                        
                    $echo .= '</div>';
                    $echo .= '</form>';
                    return $echo;
                }


                
                function reject_process() {
                    $post = $this->input->post();
                    $cNip= $this->user->gNIP;
                    $vName= $this->user->gName;
                    $iexport_request_sample = $post['iexport_request_sample'];
                    $vRemark = $post['vRemark'];
                    $lvl = $post['lvl'];
 
                    //Letakan Query Update approve disini

                    $data['status']  = true;
                    $data['last_id'] = $post['iexport_request_sample'];
                    return json_encode($data);
                }
            

        
            //Standart Setiap table harus memiliki dCreate , cCreated, dupdate, cUpdate
            function before_insert_processor($row, $postData) {

                $postData['dCreate'] = date('Y-m-d H:i:s');
                $postData['cCreated']=$this->user->gNIP;
                if($postData['isdraft']==true){
                    $postData['iSubmit']=0;
                } 
                else{$postData['iSubmit']=1;} 
                return $postData;

            }
            function before_update_processor($row, $postData) {
                if($postData['isdraft']==true){
                    $postData['iSubmit']=0;
                } 
                else{$postData['iSubmit']=1;} 

                $postData['dupdate'] = date('Y-m-d H:i:s');
                $postData['cUpdate'] = $this->user->gNIP;
                return $postData; 

            }    
        
            function after_insert_processor($fields, $id, $postData) {

                $post = $this->input->post();
                $iexport_request_sample_detail = $post['iexport_request_sample_detail'];
                $detrawid = $post['detrawid'];
                $detsatuan = $post['detsatuan'];
                $detspesifikasi = $post['detspesifikasi'];
                $detjumlah = $post['detjumlah'];
                foreach($iexport_request_sample_detail as $k => $v) {
                    if(empty($v)) {
                        if(!empty($detrawid[$k])) {
                            $idet['iexport_request_sample'] = $id;
                            $idet['raw_id'] = $detrawid[$k];
                            $idet['iJumlah'] = $detjumlah[$k];
                            $idet['vSatuan'] = $detsatuan[$k];
                            $idet['vSpesifikasi'] = $detspesifikasi[$k];
                            $this->db->insert('reformulasi.export_request_sample_detail', $idet);
                        }                       
                    }
                }


                $nomor = "RS".str_pad($id, 8, "0", STR_PAD_LEFT);
                $sql = "UPDATE reformulasi.export_request_sample SET vRequest_no = '".$nomor."' WHERE iexport_request_sample=$id LIMIT 1";
                $query = $this->db->query( $sql );



                //Example After Insert
                /*
                $cNip = $this->sess_auth_export->gNIP; 
                $sql = 'Place Query In Here';
                $this->dbset->query($sql);
                */
            }
    
            function after_update_processor($fields, $id, $postData) {

                $post = $this->input->post();
                $iexport_request_sample_detail = $post['iexport_request_sample_detail'];
                $detrawid = $post['detrawid'];
                $detsatuan = $post['detsatuan'];
                $detspesifikasi = $post['detspesifikasi'];
                $detjumlah = $post['detjumlah'];
                
                $eRows = $this->db->get_where('reformulasi.export_request_sample_detail', array('iexport_request_sample'=>$id, 'lDeleted'=>0))->result_array();
                foreach($eRows as $k => $v) {
                    if(in_array($v['iexport_request_sample_detail'], $iexport_request_sample_detail)) {

                        $this->db->where('iexport_request_sample_detail', $v['iexport_request_sample_detail']);
                        $key = array_search($v['iexport_request_sample_detail'], $iexport_request_sample_detail);
                        $this->db->update('reformulasi.export_request_sample_detail', array('raw_id'=>$detrawid[$key],'iJumlah'=>$detjumlah[$key],'vSatuan'=>$detsatuan[$key],'vSpesifikasi'=>$detspesifikasi[$key]));
                    }
                    else {
                        $this->db->where('iexport_request_sample', $v['iexport_request_sample']);
                        $this->db->update('reformulasi.export_request_sample_detail', array('lDeleted'=>1));
                    }
                }

                foreach($iexport_request_sample_detail as $k => $v) {
                    if(empty($v)) {
                        if(!empty($detrawid[$k])) {
                            $idet['iexport_request_sample'] = $id;
                            $idet['raw_id'] = $detrawid[$k];
                            $idet['iJumlah'] = $detjumlah[$k];
                            $idet['vSatuan'] = $detsatuan[$k];
                            $idet['vSpesifikasi'] = $detspesifikasi[$k];
                            $this->db->insert('reformulasi.export_request_sample_detail', $idet);
                        }                       
                    }
                }

            }
            function manipulate_insert_button($buttons) {
                unset($buttons['save']);


                $save_draft = '<button onclick="javascript:save_draft_btn_multiupload(\'export_permintaan_sample\', \''.base_url().'processor/reformulasi/export/permintaan/sample?draft=true\', this, true)" class="ui-button-text icon-save" id="button_save_draft_export_permintaan_sample">Save as Draft</button>';
                $save = '<button onclick="javascript:save_btn_multiupload(\'export_permintaan_sample\', \''.base_url().'processor/reformulasi/export/permintaan/sample?company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\', this)" class="ui-button-text icon-save" id="button_save_export_permintaan_sample">Save &amp; Submit</button>';
                $js = $this->load->view('export/sample/js/export_permintaan_sample_js');
                $js .= $this->load->view('export/sample/js/upload_js');
                $buttons['save'] = $save_draft.$save.$js;

                return $buttons;
            }

            function manipulate_update_button($buttons, $rowData) { 
                //Load Javascript In Here 
                $logged_nip =$this->user->gNIP;
                $userLogin = $this->whoAmI($logged_nip);

                
                $iSubmit = $rowData['iSubmit'];
                $iApprove_pd = $rowData['iApprove_pd'];
                $cRequestor = $rowData['cRequestor'];


                $update = '<button onclick="javascript:update_btn_back(\'export_permintaan_sample\', \''.base_url().'processor/reformulasi/export/permintaan/sample?company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\', this)" class="ui-button-text icon-save" id="button_save_export_permintaan_sample">Update & Submit</button>';
                $updatedraft = '<button onclick="javascript:update_draft_btn(\'export_permintaan_sample\', \''.base_url().'processor/reformulasi/export/permintaan/sample?company_id='.$this->input->get('company_id').'&draft=true&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\', this, true)" class="ui-button-text icon-save" id="button_save_export_permintaan_sample">Update as Draft</button>';


                $approve = '<button onclick="javascript:load_popup(\''.base_url().'processor/reformulasi/export/permintaan/sample?action=approve&iexport_request_sample='.$rowData['iexport_request_sample'].'&cNip='.$logged_nip.'&lvl=1&status=1&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\')" class="ui-button-text icon-save" id="button_approve_export_permintaan_sample">Approve</button>';
                $reject = '<button onclick="javascript:load_popup(\''.base_url().'processor/reformulasi/export/permintaan/sample?action=reject&iexport_request_sample='.$rowData['iexport_request_sample'].'&cNip='.$logged_nip.'&lvl=1&status=1&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\')" class="ui-button-text icon-save" id="button_reject_export_permintaan_sample">Reject</button>';

                $js = $this->load->view('export/sample/js/export_permintaan_sample_js');
                $js .= $this->load->view('export/sample/js/upload_js');

                if ($this->input->get('action') == 'view') {
                    unset($buttons['update']);
                }
                else{ 
                    $le_manager = false;
                    if($this->auth_export->is_manager()){
                        $x=$this->auth_export->dept();
                        $manager=$x['manager'];
                        if(in_array('PD', $manager)){
                            $type='PD';
                            $le_manager = true;
                        }else if(in_array('MIS', $manager)){
                            $type='MIS';
                            $le_manager = true;
                        }
                        else{$type='';}
                    }
                    else{
                        $x=$this->auth_export->dept();
                        $team=$x['team'];
                        if(in_array('PD', $team)){
                            $type='PD';
                        }
                        else{$type='';}
                    }

                    
                    
                    if($iSubmit > 0){
                        if($iApprove_pd == 0 ){
                            // yang bisa approve adalah manager PD

                            if( ($le_manager) and  $type == 'PD'  ){

                                $buttons['update'] = $reject.$approve.$js;

                            }else{
                                // diatas level 6 tidak bisa approval
                                unset($buttons['update']);
                            }
                            

                        }else{
                            //sudah ada approval 
                            unset($buttons['update']);
                        }

                    }else{
                        // masih draft , manager dan yang create yang bisa update

                        if( (  ($le_manager) and  $type == 'PD' ) ||  ($cRequestor == $logged_nip) ){
                            // jika user login sesuai dengan inisiator
                            $buttons['update'] = $updatedraft.$update.$js;
                        }else{
                            unset($buttons['update']);   
                        }

                    }


                        
                }
                
                return $buttons;
            }


            /*function manipulate_update_button($buttons, $rowData) { 
                //Load Javascript In Here 
                if ($this->input->get('action') == 'view') {
                    unset($buttons['update']);
                }
                else{ 
                    
                }
                
                return $buttons;
            }*/
            //Output
            public function output(){
                $this->index($this->input->get('action'));
            }
        }