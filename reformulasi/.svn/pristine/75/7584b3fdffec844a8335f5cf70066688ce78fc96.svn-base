 
        <?php
        /* Generated by Sovdev 2 ERP CRUD Generator 2017-11-22 09:03:59 */
        /* Location: ./modules/reformulasi/controllers/lokal_skala_trial.php */
        /* Please DO NOT modify this information : */ 
         
        if ( ! defined('BASEPATH')) exit('No direct script access allowed');
        class lokal_skala_trial extends MX_Controller {
            function __construct() {
                parent::__construct();
                $this->load->library('auth_local');
                $this->load->library('lib_utilitas');
                $this->db = $this->load->database('formulasi', false, true);
                $this->user = $this->auth_local->user();
            }
            function index($action = '') {
                $action = $this->input->get('action');
                //Bikin Object Baru Nama nya $grid      
                $grid = new Grid;
                $grid->setTitle('Lokal Skala Trial');
                $grid->setTable('reformulasi.lokal_refor_skala_trial');      
                $grid->setUrl('lokal_skala_trial');

                //List Table
                //$grid->addList('vnoFormulasi','local_req_refor.vNo_req_refor','itemas.c_itnam','local_req_refor.vBatch_no','isubmit_trial','iksm_skala_trial','iappd'); 
                //Revisi 2018-01-15 by : Achmad Aries Pirnando
                $grid->addList('vnoFormulasi','local_req_refor.vNo_req_refor','itemas.c_itnam','isubmit_trial','iksm_skala_trial','iappd'); 
                
                $grid->setSortBy('ilokal_refor_skala_trial');
                $grid->setSortOrder('desc');  

                //List field
                $grid->addFields('iLocal_req_refor','vnoFormulasi','dstart_skala_trial','dfinish_skala_trial','cpic_skala_trial','iuploadtrial','dstart_kimiawi','dfinish_kimiawi','cpic_kimiawi','iksm_kimiawi','dksm_kimiawi','iuploadkimiawi',
                    'dstart_disolusi','dfinish_disolusi','cpic_disolusi','iksm_disolusi','dksm_disolusi',
                    'iuploaddisolusi','iksm_skala_trial','iappd'); 

                //Setting Grid Width Name 
                /*
                    Kamu bisa merubah nama label dari sini, Contoh :
                    $grid->setLabel('nama field','nama field yang akan diubah');

                */
        
                $grid->setWidth('iuploaddisolusi', '100');
                $grid->setAlign('iuploaddisolusi', 'left');
                $grid->setLabel('iuploaddisolusi','File Analisa Disolusi');

                $grid->setWidth('iLocal_req_refor', '100');
                $grid->setAlign('iLocal_req_refor', 'left');
                $grid->setLabel('iLocal_req_refor','No Request'); 

                $grid->setWidth('local_req_refor.vNo_req_refor', '100');
                $grid->setAlign('local_req_refor.vNo_req_refor', 'left');
                $grid->setLabel('local_req_refor.vNo_req_refor','No Request'); 
            
                $grid->setWidth('iuploadkimiawi', '100');
                $grid->setAlign('iuploadkimiawi', 'left');
                $grid->setLabel('iuploadkimiawi','File Analisa Kimiawi');
            
                $grid->setWidth('iuploadtrial', '100');
                $grid->setAlign('iuploadtrial', 'left');
                $grid->setLabel('iuploadtrial','Upload File');
            
                $grid->setWidth('cUpdate', '100');
                $grid->setAlign('cUpdate', 'left');
                $grid->setLabel('cUpdate','CUPDATE');
            
                $grid->setWidth('lDeleted', '100');
                $grid->setAlign('lDeleted', 'left');
                $grid->setLabel('lDeleted','LDELETED');
            
                $grid->setWidth('iappd', '150');
                $grid->setAlign('iappd', 'left');
                $grid->setLabel('iappd','Status Approve');
            
                $grid->setWidth('cappd', '100');
                $grid->setAlign('cappd', 'left');
                $grid->setLabel('cappd','CAPPD');
            
                $grid->setWidth('tappd', '100');
                $grid->setAlign('tappd', 'left');
                $grid->setLabel('tappd','TAPPD');
            
                $grid->setWidth('dappd', '100');
                $grid->setAlign('dappd', 'left');
                $grid->setLabel('dappd','DAPPD');
            
                $grid->setWidth('vnoFormulasi', '100');
                $grid->setAlign('vnoFormulasi', 'left');
                $grid->setLabel('vnoFormulasi','No Formulasi');
            
                $grid->setWidth('cpic_skala_trial', '100');
                $grid->setAlign('cpic_skala_trial', 'left');
                $grid->setLabel('cpic_skala_trial','PIC Skala Trial');
            
                $grid->setWidth('dstart_skala_trial', '100');
                $grid->setAlign('dstart_skala_trial', 'left');
                $grid->setLabel('dstart_skala_trial','Tgl Mulai Orientasi Skala Trial');
            
                $grid->setWidth('dfinish_skala_trial', '100');
                $grid->setAlign('dfinish_skala_trial', 'left');
                $grid->setLabel('dfinish_skala_trial','Tgl Selesai Orientasi Skala Trial');
            
                $grid->setWidth('iksm_skala_trial', '150');
                $grid->setAlign('iksm_skala_trial', 'left');
                $grid->setLabel('iksm_skala_trial','Kesimpulan Skala Trial');
            
                $grid->setWidth('cpic_kimiawi', '100');
                $grid->setAlign('cpic_kimiawi', 'left');
                $grid->setLabel('cpic_kimiawi','PIC Analisa Kimiawi');
            
                $grid->setWidth('iksm_kimiawi', '100');
                $grid->setAlign('iksm_kimiawi', 'left');
                $grid->setLabel('iksm_kimiawi','Kesimpulan Analisa Kimiawi');
            
                $grid->setWidth('dksm_kimiawi', '100');
                $grid->setAlign('dksm_kimiawi', 'left');
                $grid->setLabel('dksm_kimiawi','Tgl Kesimpulan Analisa Kimiawi');
            
                $grid->setWidth('dstart_kimiawi', '100');
                $grid->setAlign('dstart_kimiawi', 'left');
                $grid->setLabel('dstart_kimiawi','Tgl Mulai Analisa Kimiawi');
            
                $grid->setWidth('dfinish_kimiawi', '100');
                $grid->setAlign('dfinish_kimiawi', 'left');
                $grid->setLabel('dfinish_kimiawi','Tgl Selesai Analisa Kimiawi');
            
                $grid->setWidth('cpic_disolusi', '100');
                $grid->setAlign('cpic_disolusi', 'left');
                $grid->setLabel('cpic_disolusi','PIC ANalisa Disolusi');
            
                $grid->setWidth('iksm_disolusi', '100');
                $grid->setAlign('iksm_disolusi', 'left');
                $grid->setLabel('iksm_disolusi','Kesimpulan Analisa Disolusi');
            
                $grid->setWidth('dksm_disolusi', '100');
                $grid->setAlign('dksm_disolusi', 'left');
                $grid->setLabel('dksm_disolusi','Tgl Kesimpulan Analisa Disolusi');
            
                $grid->setWidth('dstart_disolusi', '100');
                $grid->setAlign('dstart_disolusi', 'left');
                $grid->setLabel('dstart_disolusi','Tgl Mulai Analisa Disolusi');
            
                $grid->setWidth('dfinish_disolusi', '100');
                $grid->setAlign('dfinish_disolusi', 'left');
                $grid->setLabel('dfinish_disolusi','Tgl Selesai Analisa Disolusi');

                $grid->setWidth('isubmit_trial', '150');
                $grid->setAlign('isubmit_trial', 'left');
                $grid->setLabel('isubmit_trial','Status Submit');

                $grid->setWidth('itemas.c_itnam', '150');
                $grid->setAlign('itemas.c_itnam', 'left');
                $grid->setLabel('itemas.c_itnam','Nama Product');

                $grid->setWidth('local_req_refor.vBatch_no', '150');
                $grid->setAlign('local_req_refor.vBatch_no', 'left');
                $grid->setLabel('local_req_refor.vBatch_no','No Batch'); 

                $grid->changeFieldType('isubmit_trial','combobox','',array(''=>'--Selected--',0=>'Draft - Need to be Publish',1=>'Submitted'));
                $grid->changeFieldType('iksm_skala_trial','combobox','',array(''=>'--Selected--',0=>'Tidak Memenuhi Syarat',1=>'Memenuhi Syarat'));
                $grid->setJoinTable('reformulasi.local_req_refor', 'local_req_refor.iLocal_req_refor = lokal_refor_skala_trial.iLocal_req_refor', 'inner');
                $grid->setJoinTable('sales.itemas', 'itemas.c_iteno = local_req_refor.cIteno', 'inner');
            
                //Example modifikasi GRID ERP
                /*
                    - Set Query
                        $grid->setQuery('lDeleted = 0 ', null); 
                        $grid->setQuery('plc2_upb.iupb_id IN (select distinct(bk.iupb_id) from plc2.plc2_upb_spesifikasi_fg bk where bk.iappqa=2 and bk.ldeleted=0)', null);  

                    - Join Table
                        $grid->setJoinTable('hrd.employee', 'employee.cNip = pk_master.vnip', 'inner');

                    - Change Field Name
                        $grid->changeFieldType('ideleted','combobox','',array(''=>'Pilih',0=>'Aktif',1=>'Tidak aktif'));
                */

                 

                if($this->auth_local->is_manager()){
                    $x=$this->auth_local->dept();
                    $manager=$x['manager'];
                    if(in_array('PD', $manager)){
                        $type='PD';
                        $grid->setQuery('local_req_refor.iteam_pd IN ('.$this->auth_local->my_teams().')', null); 
                    }
                    else{$type='';}
                }
                else{
                    $x=$this->auth_local->dept();
                    $team=$x['team'];
                    if(in_array('PD', $team)){
                        $type='PD';
                        $grid->setQuery('local_req_refor.iteam_pd IN ('.$this->auth_local->my_teams().')', null); 
                        $grid->setQuery('(local_req_refor.cFormulator = "'.$this->user->gNIP.'") ', null); 
                    }
                    else{$type='';}
                }
                $grid->setQuery('lokal_refor_skala_trial.lDeleted = 0 ', null);

                //set search
                $grid->setSearch('vnoFormulasi','itemas.c_itnam','local_req_refor.vBatch_no','isubmit_trial'); 
                //$grid->setSearch('dCreate','cCreated','dupdate','cUpdate','lDeleted','iappd','cappd','tappd','dappd','vnoFormulasi','cpic_skala_trial','dstart_skala_trial','dfinish_skala_trial','iksm_skala_trial','cpic_kimiawi','iksm_kimiawi','dksm_kimiawi','dstart_kimiawi','dfinish_kimiawi','cpic_disolusi','iksm_disolusi','dksm_disolusi','dstart_disolusi','dfinish_disolusi');
                
                //set required
                $grid->setRequired('cCreated','dupdate','cUpdate','lDeleted','iappd','cappd','tappd','dappd',
                    'vnoFormulasi','cpic_skala_trial','dstart_skala_trial','dfinish_skala_trial',
                    'iksm_skala_trial'); 

                $grid->setGridView('grid');

                switch ($action) {
                    case 'json':
                            $grid->getJsonData();
                            break;
                    case 'view':
                            $grid->render_form($this->input->get('id'), true);
                            break;
                    case 'create':
                            $grid->render_form();
                            break;
                    case 'createproses': 
                            
                            $isUpload = $this->input->get('isUpload'); 
                            if($isUpload) { 
                                $lastId=$this->input->get('lastId');
                                $path = realpath("files/reformulasi/"); 

                                /* Upload Trial */ 
                                if(!file_exists($path."/"."local/skala_trial/trial"."/".$lastId)){
                                    if (!mkdir($path."/"."local/skala_trial/trial"."/".$lastId, 0777, true)) { 
                                        die('Failed upload, try again!');
                                    }
                                } 
                                $fileketerangan = array();
                                foreach($_POST as $key=>$value) {                       
                                    if ($key == 'fileketerangan_lokal_skala_trial_file') {
                                        foreach($value as $k=>$v) {
                                            $fileketerangan[$k] = $v;
                                        }
                                    }
                                } 
                                $i=0; 
                                $sql = array();
                                foreach ($_FILES['fileid_lokal_skala_trial_file_upload_lokal_skala_trial_file']["error"] as $key => $error) {
                                    if ($error == UPLOAD_ERR_OK) {
                                        $tmp_name = $_FILES['fileid_lokal_skala_trial_file_upload_lokal_skala_trial_file']["tmp_name"][$key];
                                        $name =$_FILES['fileid_lokal_skala_trial_file_upload_lokal_skala_trial_file']["name"][$key];
                                        $data['filename'] = $name;
                                        $data['dInsertDate'] = date('Y-m-d H:i:s');

                                            if(move_uploaded_file($tmp_name, $path."/"."local/skala_trial/trial"."/".$lastId."/".$name)) {
                                                $sql[]="INSERT INTO reformulasi.local_refor_skala_trial_file(ilokal_refor_skala_trial, 
                                                        vFilename, dCreate, cCreated, 
                                                        tKeterangan,iJenisfile) 
                                                        VALUES (".$lastId.",'".$data['filename']."',
                                                            '".$data['dInsertDate']."','".$this->user->gNIP."',
                                                            '".$fileketerangan[$i]."',1)";
                                                $i++;   
                                            }
                                            else{
                                                echo "Upload ke folder gagal";  
                                            }
                                    }
                                }
                                foreach($sql as $q) {
                                    try {
                                        $this->db->query($q);
                                    }catch(Exception $e) {
                                    die($e);
                                    }
                                } 

                                /* Upload Kimiawi */ 
                                if(!file_exists($path."/"."local/skala_trial/kimiawi"."/".$lastId)){
                                    if (!mkdir($path."/"."local/skala_trial/kimiawi"."/".$lastId, 0777, true)) { 
                                        die('Failed upload, try again!');
                                    }
                                } 
                                $fileketerangan = array();
                                foreach($_POST as $key=>$value) {                       
                                    if ($key == 'fileketerangan_lokal_skala_trial_file_kimiawi') {
                                        foreach($value as $k=>$v) {
                                            $fileketerangan[$k] = $v;
                                        }
                                    }
                                } 
                                $i=0;
                                $sql = array();
                                foreach ($_FILES['fileid_lokal_skala_trial_file_kimiawi_upload_lokal_skala_trial_file_kimiawi']["error"] as $key => $error) {
                                    if ($error == UPLOAD_ERR_OK) {
                                        $tmp_name = $_FILES['fileid_lokal_skala_trial_file_kimiawi_upload_lokal_skala_trial_file_kimiawi']["tmp_name"][$key];
                                        $name =$_FILES['fileid_lokal_skala_trial_file_kimiawi_upload_lokal_skala_trial_file_kimiawi']["name"][$key];
                                        $data['filename'] = $name;
                                        $data['dInsertDate'] = date('Y-m-d H:i:s');

                                            if(move_uploaded_file($tmp_name, $path."/"."local/skala_trial/kimiawi"."/".$lastId."/".$name)) {
                                                $sql[]="INSERT INTO reformulasi.local_refor_skala_trial_file(ilokal_refor_skala_trial, 
                                                        vFilename, dCreate, cCreated, 
                                                        tKeterangan,iJenisfile) 
                                                        VALUES (".$lastId.",'".$data['filename']."',
                                                            '".$data['dInsertDate']."','".$this->user->gNIP."',
                                                            '".$fileketerangan[$i]."',2)";
                                                $i++;   
                                            }
                                            else{
                                                echo "Upload ke folder gagal";  
                                            }
                                    }
                                }
                                foreach($sql as $q) {
                                    try {
                                        $this->db->query($q);
                                    }catch(Exception $e) {
                                    die($e);
                                    }
                                }

                                /* Upload disolusi */ 
                                if(!file_exists($path."/"."local/skala_trial/disolusi"."/".$lastId)){
                                    if (!mkdir($path."/"."local/skala_trial/disolusi"."/".$lastId, 0777, true)) { 
                                        die('Failed upload, try again!');
                                    }
                                } 
                                $fileketerangan = array();
                                foreach($_POST as $key=>$value) {                       
                                    if ($key == 'fileketerangan_lokal_skala_trial_file_disolusi') {
                                        foreach($value as $k=>$v) {
                                            $fileketerangan[$k] = $v;
                                        }
                                    }
                                } 
                                $i=0;
                                 $sql = array();
                                foreach ($_FILES['fileid_lokal_skala_trial_file_disolusi_upload_lokal_skala_trial_file_disolusi']["error"] as $key => $error) {
                                    if ($error == UPLOAD_ERR_OK) {
                                        $tmp_name = $_FILES['fileid_lokal_skala_trial_file_disolusi_upload_lokal_skala_trial_file_disolusi']["tmp_name"][$key];
                                        $name =$_FILES['fileid_lokal_skala_trial_file_disolusi_upload_lokal_skala_trial_file_disolusi']["name"][$key];
                                        $data['filename'] = $name;
                                        $data['dInsertDate'] = date('Y-m-d H:i:s');

                                            if(move_uploaded_file($tmp_name, $path."/"."local/skala_trial/disolusi"."/".$lastId."/".$name)) {
                                                $sql[]="INSERT INTO reformulasi.local_refor_skala_trial_file(ilokal_refor_skala_trial, 
                                                        vFilename, dCreate, cCreated, 
                                                        tKeterangan,iJenisfile) 
                                                        VALUES (".$lastId.",'".$data['filename']."',
                                                            '".$data['dInsertDate']."','".$this->user->gNIP."',
                                                            '".$fileketerangan[$i]."',3)";
                                                $i++;   
                                            }
                                            else{
                                                echo "Upload ke folder gagal";  
                                            }
                                    }
                                }
                                foreach($sql as $q) {
                                    try {
                                        $this->db->query($q);
                                    }catch(Exception $e) {
                                    die($e);
                                    }
                                }
 
                                $r['status'] = TRUE;
                                $r['last_id'] = $this->input->get('lastId');                    
                                echo json_encode($r);
                                }
                            else{ 
                                $key = $this->input->post('vnoFormulasi');
                                $cek_data = 'SELECT ls.`vnoFormulasi` FROM reformulasi.`lokal_refor_skala_trial` ls WHERE ls.`lDeleted` = 0  
                                              AND ls.`vnoFormulasi`="'.trim($key).'" '; 
                                $data_cek = $this->db->query($cek_data)->row_array(); 
                                if(empty($data_cek)){
                                    echo $grid->saved_form();
                                }else{ 
                                   $r['status'] = FALSE;
                                   $r['message'] = "Nomor Formula Sudah Digunakan";
                                   echo json_encode($r); 
                                }
                                    
                            } 
                            break;
                    case 'update':
                            $grid->render_form($this->input->get('id'));
                            break;
                    case 'updateproses':
                            $id=$_POST['ilokal_refor_skala_trial']; 
                            $key = $this->input->post('vnoFormulasi');

                            $cek_data = 'SELECT ls.`vnoFormulasi` FROM reformulasi.`lokal_refor_skala_trial` ls WHERE ls.`lDeleted` = 0  
                                        AND ls.`vnoFormulasi`="'.trim($key).'" ';
                            $result = $this->db->query($cek_data)->row_array();

                            $sql2 = 'select * from reformulasi.`lokal_refor_skala_trial` a where a.ilokal_refor_skala_trial = "'.$id.'"';
                            $old = $this->db->query($sql2)->row_array(); 
                            
                            if (empty($result) or $old['vnoFormulasi'] == $key  ) { 
                                $isUpload = $this->input->get('isUpload');
                                $post=$this->input->post();
                                $lastId=$post['ilokal_refor_skala_trial'];
                                $path = realpath("files/reformulasi/"); 
                                if($isUpload) {

                                    //Upload Trial
                                    if(!file_exists($path."/"."local/skala_trial/trial"."/".$lastId)){
                                        if (!mkdir($path."/"."local/skala_trial/trial"."/".$lastId, 0777, true)) { 
                                            die('Failed upload, try again!');
                                        }
                                    } 
                                    $fileketerangan = array();
                                    foreach($_POST as $key=>$value) {                       
                                        if ($key == 'fileketerangan_lokal_skala_trial_file') {
                                            foreach($value as $k=>$v) {
                                                $fileketerangan[$k] = $v;
                                            }
                                        }
                                    } 
                                    $i=0; 
                                    foreach ($_FILES['fileid_lokal_skala_trial_file_upload_lokal_skala_trial_file']["error"] as $key => $error) {
                                        if ($error == UPLOAD_ERR_OK) {
                                            $tmp_name = $_FILES['fileid_lokal_skala_trial_file_upload_lokal_skala_trial_file']["tmp_name"][$key];
                                            $name =$_FILES['fileid_lokal_skala_trial_file_upload_lokal_skala_trial_file']["name"][$key];
                                            $data['filename'] = $name;
                                            $data['dInsertDate'] = date('Y-m-d H:i:s');

                                                if(move_uploaded_file($tmp_name, $path."/"."local/skala_trial/trial"."/".$lastId."/".$name)) {
                                                    $sql[]="INSERT INTO reformulasi.local_refor_skala_trial_file(ilokal_refor_skala_trial, 
                                                            vFilename, dCreate, cCreated, 
                                                            tKeterangan,iJenisfile) 
                                                            VALUES (".$lastId.",'".$data['filename']."',
                                                                '".$data['dInsertDate']."','".$this->user->gNIP."',
                                                                '".$fileketerangan[$i]."',1)";
                                                    $i++;   
                                                }
                                                else{
                                                    echo "Upload ke folder gagal";  
                                                }
                                        }
                                    }
                                    foreach($sql as $q) {
                                        try {
                                            $this->db->query($q);
                                        }catch(Exception $e) {
                                        die($e);
                                        }
                                    }


                                    //Upload Kimiawi

                                    if(!file_exists($path."/"."local/skala_trial/kimiawi"."/".$lastId)){
                                        if (!mkdir($path."/"."local/skala_trial/kimiawi"."/".$lastId, 0777, true)) { 
                                            die('Failed upload, try again!');
                                        }
                                    } 
                                    $fileketerangan = array();
                                    foreach($_POST as $key=>$value) {                       
                                        if ($key == 'fileketerangan_lokal_skala_trial_file_kimiawi') {
                                            foreach($value as $k=>$v) {
                                                $fileketerangan[$k] = $v;
                                            }
                                        }
                                    } 
                                    $i=0;
                                     $sql = array();
                                    foreach ($_FILES['fileid_lokal_skala_trial_file_kimiawi_upload_lokal_skala_trial_file_kimiawi']["error"] as $key => $error) {
                                        if ($error == UPLOAD_ERR_OK) {
                                            $tmp_name = $_FILES['fileid_lokal_skala_trial_file_kimiawi_upload_lokal_skala_trial_file_kimiawi']["tmp_name"][$key];
                                            $name =$_FILES['fileid_lokal_skala_trial_file_kimiawi_upload_lokal_skala_trial_file_kimiawi']["name"][$key];
                                            $data['filename'] = $name;
                                            $data['dInsertDate'] = date('Y-m-d H:i:s');

                                                if(move_uploaded_file($tmp_name, $path."/"."local/skala_trial/kimiawi"."/".$lastId."/".$name)) {
                                                    $sql[]="INSERT INTO reformulasi.local_refor_skala_trial_file(ilokal_refor_skala_trial, 
                                                            vFilename, dCreate, cCreated, 
                                                            tKeterangan,iJenisfile) 
                                                            VALUES (".$lastId.",'".$data['filename']."',
                                                                '".$data['dInsertDate']."','".$this->user->gNIP."',
                                                                '".$fileketerangan[$i]."',2)";
                                                    $i++;   
                                                }
                                                else{
                                                    echo "Upload ke folder gagal";  
                                                }
                                        }
                                    }
                                    foreach($sql as $q) {
                                        try {
                                            $this->db->query($q);
                                        }catch(Exception $e) {
                                        die($e);
                                        }
                                    }

                                    //Upload Disolusi
                                    if(!file_exists($path."/"."local/skala_trial/disolusi"."/".$lastId)){
                                        if (!mkdir($path."/"."local/skala_trial/disolusi"."/".$lastId, 0777, true)) { 
                                            die('Failed upload, try again!');
                                        }
                                    } 
                                    $fileketerangan = array();
                                    foreach($_POST as $key=>$value) {                       
                                        if ($key == 'fileketerangan_lokal_skala_trial_file_disolusi') {
                                            foreach($value as $k=>$v) {
                                                $fileketerangan[$k] = $v;
                                            }
                                        }
                                    } 
                                    $i=0;
                                     $sql = array();
                                    foreach ($_FILES['fileid_lokal_skala_trial_file_disolusi_upload_lokal_skala_trial_file_disolusi']["error"] as $key => $error) {
                                        if ($error == UPLOAD_ERR_OK) {
                                            $tmp_name = $_FILES['fileid_lokal_skala_trial_file_disolusi_upload_lokal_skala_trial_file_disolusi']["tmp_name"][$key];
                                            $name =$_FILES['fileid_lokal_skala_trial_file_disolusi_upload_lokal_skala_trial_file_disolusi']["name"][$key];
                                            $data['filename'] = $name;
                                            $data['dInsertDate'] = date('Y-m-d H:i:s');

                                                if(move_uploaded_file($tmp_name, $path."/"."local/skala_trial/disolusi"."/".$lastId."/".$name)) {
                                                    $sql[]="INSERT INTO reformulasi.local_refor_skala_trial_file(ilokal_refor_skala_trial, 
                                                            vFilename, dCreate, cCreated, 
                                                            tKeterangan,iJenisfile) 
                                                            VALUES (".$lastId.",'".$data['filename']."',
                                                                '".$data['dInsertDate']."','".$this->user->gNIP."',
                                                                '".$fileketerangan[$i]."',3)";
                                                    $i++;   
                                                }
                                                else{
                                                    echo "Upload ke folder gagal";  
                                                }
                                        }
                                    }
                                    foreach($sql as $q) {
                                        try {
                                            $this->db->query($q);
                                        }catch(Exception $e) {
                                        die($e);
                                        }
                                    }


                                    $r['status'] = TRUE;
                                    $r['last_id'] = $lastId;                    
                                    echo json_encode($r);
                                }
                                else{

                                    //Trial
                                    $fileid1='';
                                    foreach($_POST as $key=>$value) {
                                        if ($key == 'fileid_lokal_skala_trial_file') {
                                            $i=0;
                                            foreach($value as $k=>$v) {
                                                if($i==0){
                                                    $fileid1 .= "'".$v."'";
                                                }else{
                                                    $fileid1 .= ",'".$v."'";
                                                }
                                                $i++;
                                            }
                                        }
                                    } 
                                    $tgl= date('Y-m-d H:i:s');
                                    $sql1="update reformulasi.local_refor_skala_trial_file set lDeleted=1, 
                                        dupdate='".$tgl."', cUpdate='".$this->user->gNIP."' where 
                                        ilokal_refor_skala_trial='".$lastId."' and iJenisfile =1 and
                                        ilocal_refor_skala_trial_file not in (".$fileid1.")";
                                    $this->db->query($sql1); 


                                    //Kimiawi
                                    $fileid1='';
                                    foreach($_POST as $key=>$value) {
                                        if ($key == 'fileid_lokal_skala_trial_file_kimiawi') {
                                            $i=0;
                                            foreach($value as $k=>$v) {
                                                if($i==0){
                                                    $fileid1 .= "'".$v."'";
                                                }else{
                                                    $fileid1 .= ",'".$v."'";
                                                }
                                                $i++;
                                            }
                                        }
                                    } 
                                    $tgl= date('Y-m-d H:i:s');
                                    $sql1="update reformulasi.local_refor_skala_trial_file set lDeleted=1, 
                                        dupdate='".$tgl."', cUpdate='".$this->user->gNIP."' where 
                                        ilokal_refor_skala_trial='".$lastId."' and iJenisfile =2 and
                                        ilocal_refor_skala_trial_file not in (".$fileid1.")";
                                    $this->db->query($sql1); 

                                    //Disolusi
                                    $fileid1='';
                                    foreach($_POST as $key=>$value) {
                                        if ($key == 'fileid_lokal_skala_trial_file_disolusi') {
                                            $i=0;
                                            foreach($value as $k=>$v) {
                                                if($i==0){
                                                    $fileid1 .= "'".$v."'";
                                                }else{
                                                    $fileid1 .= ",'".$v."'";
                                                }
                                                $i++;
                                            }
                                        }
                                    } 
                                    $tgl= date('Y-m-d H:i:s');
                                    $sql1="update reformulasi.local_refor_skala_trial_file set lDeleted=1, 
                                        dupdate='".$tgl."', cUpdate='".$this->user->gNIP."' where 
                                        ilokal_refor_skala_trial='".$lastId."' and iJenisfile =3 and
                                        ilocal_refor_skala_trial_file not in (".$fileid1.")";
                                    $this->db->query($sql1); 



                                    echo $grid->updated_form();
                                }
                            }else{
                                $r['status'] = FALSE;
                                $r['message'] = "Nomor Formula Sudah Digunakan";
                                echo json_encode($r);
                            }
                            break;
                    case 'delete':
                            echo $grid->delete_row();
                            break; 
                    case 'searchcNip':
                        echo $this->searchcNip();
                        break;
                    
                        //Ini Merupakan Standart Case Untuk Approve

                        case 'approve':
                            echo $this->approve_view();
                            break;
                        case 'approve_process':
                            echo $this->approve_process();
                            break;
                        case 'reject':
                            echo $this->reject_view();
                            break;
                        case 'reject_process':
                            echo $this->reject_process();
                            break; 
                        case 'download':
                            $this->download($this->input->get('file'));
                            break;
                     
                    default:
                            $grid->render_grid();
                            break;
                }
            }
            //Create Manipulate Field 

            //Jika Ingin Menambahkan Seting grid seperti button edit enable dalam kondisi tertentu
            function whoAmI($nip){
                $sql = 'select b.vDescription as vdepartemen,a.*,b.* 
                        from hrd.employee a 
                        join hrd.msdepartement b on b.iDeptID=a.iDepartementID
                        where a.cNip ="'.$nip.'"
                        ';
                $data = $this->db->query($sql)->row_array();
                return $data;
            }
            function listBox_Action($row, $actions) {
                if ($row->isubmit_trial<>0 ) { 
                    if ($row->iappd<>0 ) { 
                        unset($actions['edit']);
                    }else{
                        $type = '';
                        if($this->auth_local->is_manager()){
                            $x=$this->auth_local->tipe();
                            $manager=$x['manager'];
                            if(in_array('PD', $manager)){
                                $type='PD';
                            }
                            else{
                                $type='';
                            }
                        }  
                        if(!$this->auth_local->is_manager() && $type!='PD'){
                            unset($actions['edit']);
                        }
                    }
                }
                return $actions;
            } 
            
            function listBox_lokal_skala_trial_iappd($value) {
                if($value==0){$vstatus='Waiting for approval';}
                elseif($value==1){$vstatus='Rejected';}
                elseif($value==2){$vstatus='Approved';}
                return $vstatus;
            }
            public function searchcNip() {
                    $tgl        = date('Y-m-d');
                    $term       = $this->input->get('term'); 
                    
                    $data = array(); 

                    //$sql = "select cNip, vName from hrd.employee where (cNip like '%{$term}%') limit 1 ";
                    $sql = "SELECT a.cNip,a.vName,a.iDivisionID,a.iDepartementId,a.ibagid,a.iArea,a.iPostId,
                            (SELECT vDescription FROM hrd.msdivision WHERE iDivID=a.iDivisionID) AS divisi,
                            (SELECT vDescription FROM hrd.msdepartement WHERE iDeptID=a.iDepartementId) AS departement,
                            (SELECT vDescription FROM hrd.bagian WHERE ibagid=a.ibagid) AS bagian,
                            (SELECT vAreaname FROM hrd.area WHERE iAreaID=a.iArea) AS vAreaname,
                            (SELECT vDescription FROM hrd.position WHERE iPostId=a.iPostId) AS jabatan,
                            (SELECT c.vDescription FROM hrd.position AS b LEFT JOIN hrd.lvlemp AS c ON c.iLvlEmp=b.iLvlID 
                              WHERE b.iPostId=a.iPostID) AS lvlemply

                            FROM hrd.employee AS a WHERE 
                            (a.dresign='0000-00-00' OR a.dresign>'".date('Y-m-d H:i:s')."') AND
                            (a.cNip LIKE '%{$term}%' OR a.vName LIKE '%{$term}%') limit 50";
                    //echo $sql;exit;   
                
                    $query = $this->db->query($sql);
                    if ($query->num_rows > 0) {         
                        foreach($query->result_array() as $line) {
                            $row_array['id']        = trim($line['cNip']);
                            $row_array['value']     = trim($line['cNip']).' - '.trim($line['vName']);
                            $row_array['divisi']    = trim($line['divisi']);
                            $row_array['vAreaname'] = trim($line['vAreaname']);
                            $row_array['jabatan']   = trim($line['jabatan']);
                            $row_array['departement']   = trim($line['departement']);
                            $row_array['bagian']        = trim($line['bagian']);
                            $row_array['lvlemply']      = trim($line['lvlemply']);

                            $row_array['iDivisionID']   = trim($line['iDivisionID']);
                            $row_array['iDepartementId']    = trim($line['iDepartementId']);
                            $row_array['ibagid']        = trim($line['ibagid']);
                            $row_array['iArea']         = trim($line['iArea']);
                            $row_array['iPostId']       = trim($line['iPostId']); 
                            
                            array_push($data, $row_array);
                        }
                    }
                    
                    echo json_encode($data);
                    exit;   
                }

            
            function insertBox_lokal_skala_trial_dCreate($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_lokal_skala_trial_dCreate($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                } 
                return $return;
            } 
            function insertBox_lokal_skala_trial_iuploadkimiawi($field, $id) {
                $data['rows']=array();
                $return = $this->load->view('local/lokal_skala_trial_file_kimiawi',$data,TRUE);
                return $return;
            }
            function insertBox_lokal_skala_trial_iuploadtrial($field, $id) {
                $data['rows']=array();
                $return = $this->load->view('local/lokal_skala_trial_file',$data,TRUE);
                return $return;
            }
            function insertBox_lokal_skala_trial_iuploaddisolusi($field, $id) {
                $data['rows']=array();
                $return = $this->load->view('local/lokal_skala_trial_file_disolusi',$data,TRUE);
                return $return;
            }

            function updateBox_lokal_skala_trial_iuploadkimiawi($field, $id, $value, $rowData) {
                $sq = "SELECT * FROM reformulasi.`local_refor_skala_trial_file` lr WHERE lr.`lDeleted` = 0 AND 
                    lr.`iJenisfile` = 2 AND lr.`ilokal_refor_skala_trial` ='".$rowData['ilokal_refor_skala_trial']."'";
                $data['rows']=$this->db->query($sq)->result_array();
                $return = $this->load->view('local/lokal_skala_trial_file_kimiawi',$data,TRUE);
                return $return;
            }
            function updateBox_lokal_skala_trial_iuploadtrial($field, $id, $value, $rowData) {
                $sq = "SELECT * FROM reformulasi.`local_refor_skala_trial_file` lr WHERE lr.`lDeleted` = 0 AND 
                    lr.`iJenisfile` = 1 AND lr.`ilokal_refor_skala_trial` ='".$rowData['ilokal_refor_skala_trial']."'";
                $data['rows']=$this->db->query($sq)->result_array();
                $return = $this->load->view('local/lokal_skala_trial_file',$data,TRUE);
                return $return;
            }
            function updateBox_lokal_skala_trial_iuploaddisolusi($field, $id, $value, $rowData) {
                $sq = "SELECT * FROM reformulasi.`local_refor_skala_trial_file` lr WHERE lr.`lDeleted` = 0 AND 
                    lr.`iJenisfile` = 3 AND lr.`ilokal_refor_skala_trial` ='".$rowData['ilokal_refor_skala_trial']."'";
                $data['rows']=$this->db->query($sq)->result_array();
                $return = $this->load->view('local/lokal_skala_trial_file_disolusi',$data,TRUE);
                return $return;
            }

              
            
            function insertBox_lokal_skala_trial_iLocal_req_refor($field, $id) {     
                $uri = 'lokal_skala_trial';
                $o = "";  
                $o   .= "<div style='
                                padding: 3px;
                                width: 500px;
                                border: 1px solid rgba(51, 23, 93, 0.2);
                                background-color: #FFF;'>";
                
                
                $o   .= "<table border='0' style='width: 100%;'>
                            <tbody>";  
                $o  .="         <tr>
                                    <td width='20%'>No Request</td>
                                    <td>:</td>
                                    <td width='75%'>";
                $o .= '         <input type="hidden" name="'.$field.'"  id="'.$id.'"  class="'.$id.' input_rows1 required" size="30" />';
                $o .= '         <input readonly type="text" name="'.$uri.'_vNo_req_refor"  id="'.$uri.'_vNo_req_refor"  class="'.$uri.'_vNo_req_refor required input_rows1" size="30" />';
                $o .= '         &nbsp;<button class="icon_pop"  onclick="browse(\''.base_url().'processor/reformulasi/browse/skala/trial/?field=lokal_skala_trial\',\'Request Reformulasi\')" type="button">Browse</button>';  
                $o  .="             </td>
                                </tr>
                                
                                <tr>
                                    <td width='20%'>Nama Produk</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_cIteno' id='".$uri."_cIteno'></span> 
                                    </td>
                                </tr>
                                 

                                <tr>
                                    <td width='20%'>Nama Inisiator</td>
                                    <td>:</td>
                                    <td width='75%'> 

                                        <span class='".$uri."_cInisiator' id='".$uri."_cInisiator'></span>
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>Dapartement</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_cdapart' id='".$uri."_cdapart'></span>
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>Alasan Refor</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_vAlasan_refor' id='".$uri."_vAlasan_refor'></span>
                                    </td>
                                </tr> 

                                <tr>
                                    <td width='20%'>Team PD</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_iteam_pd' id='".$uri."_iteam_pd'></span>  
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>Tgl Permintaan Refor</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_dRequest' id='".$uri."_dRequest'></span> 
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>Approval Atasan Inisiator</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_iStatus' id='".$id."_iStatus'></span> 
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>PIC Formulator Refor</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_cFormulator' id='".$uri."_cFormulator'></span>  
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>File Upload</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_iupload_f' id='".$uri."_iupload_f'></span>
                                    </td>
                                </tr>

                                
                                
                            </tbody>    
                        </table>"; 
                $o .= "    </div>";  

                $o .= '<script>
                        $( "button.icon_pop" ).button({
                            icons: {
                                primary: "ui-icon-newwin"
                            }, 
                        })
                    </script>';

                     
                return $o;
            }
            function updateBox_lokal_skala_trial_iLocal_req_refor($field, $id, $value, $rowData) {
                $sql = "SELECT * FROM reformulasi.`local_req_refor` lr WHERE lr.`lDeleted` = 0 AND lr.`iLocal_req_refor` = '".$value."'";
                $dt = $this->db->query($sql)->row_array();
                $_cIteno = ''; 
                $_vNo_req_refor='';
                $_vBatch_no='';
                $_vAlasan_refor='';
                $_dRequest=''; 
                $_cIteno=''; 
                $_cInisiator='';
                $_cdapart='';
                $_iteam_pd='';
                $_iStatus='';
                $_cFormulator='';
                $_iupload_f = '';
                if(!empty($dt['iLocal_req_refor'])){
                        $sq_all='SELECT * FROM reformulasi.`local_req_refor_file` lf WHERE lf.lDeleted = 0 AND 
                                lf.iLocal_req_refor = "'.$value.'"'; 
                        $data['sq_all'] = $this->db->query($sq_all)->result_array();  
                        $_iupload_f =  $this->load->view('local/lokal_skala_trial_ref_file',$data,TRUE);


                        $_vNo_req_refor = $dt['vNo_req_refor'];
                        $_vBatch_no = $dt['vBatch_no'];
                        $_vAlasan_refor = $dt['vAlasan_refor'];
                        $_dRequest = $dt['dRequest'];
                        
                        $itname = "SELECT i.`c_itnam` FROM sales.`itemas` i WHERE i.`lDeleted` = 0 
                            AND i.`c_iteno` = '".$dt['cIteno']."'";
                        $c_itnam = $this->db->Query($itname)->row_array();
                        if(empty($c_itnam['c_itnam'])){
                            $c_itnam['c_itnam'] = '-';
                        }
                        $_cIteno = $c_itnam['c_itnam'];


                        $vn = "SELECT e.`vName` FROM hrd.`employee` e WHERE e.`cNip` = '".$dt['cInisiator']."'";
                                $vName = $this->db->query($vn)->row_array();
                        if(empty($vName['vName'])){
                            $vName['vName'] = '-';
                        }
                        $_cInisiator = $vName['vName'];

                        $dp = "SELECT e.`vName`, m.`vDescription` FROM hrd.`employee` e 
                                        JOIN hrd.`msdepartement` m ON m.`iDeptID` = e.`iDepartementID` 
                                        WHERE e.`cNip` = '".$dt['cInisiator']."'";
                        $cdapart = $this->db->query($dp)->row_array();
                        if(empty($cdapart['vDescription'])){
                            $cdapart['vDescription'] = '-';
                        }
                        $_cdapart = $cdapart['vDescription'];

                        $pd = "SELECT r.vteam FROM reformulasi.`reformulasi_team` r WHERE r.ldeleted=0 
                            AND r.ireformulasi_team= '".$dt['iteam_pd']."'";
                        $c_pd = $this->db->Query($pd)->row_array();
                        if(empty($c_pd['vteam'])){
                            $c_pd['vteam'] = '-';
                        }
                        $_iteam_pd=$c_pd['vteam'];

                        $ap = "SELECT e.`vName` FROM hrd.`employee` e WHERE e.`cNip` = '".$dt['cApproval']."'";
                        $app = $this->db->query($vn)->row_array();
                        if($dt['iStatus']==2){
                            if(empty($app['vName'])){
                                $app['vName'] = 'Approved'.' Tgl '.$dt['dApproval'];
                            }else{ 
                                $app['vName'] = 'Approved by '.$app['vName'].' Tgl '.$dt['dApproval'];
                            }
                        }else if($dt['iStatus']==1){
                            if(empty($app['vName'])){
                                $app['vName'] = 'Rejected'.' Tgl '.$dt['dApproval'];
                            }else{ 
                                $app['vName'] = 'Rejected by '.$app['vName'].' Tgl '.$dt['dApproval'];
                            }
                        }else{
                            $app['vName'] = 'Waiting Approval';
                        }
                        $_iStatus = $app['vName'];

                        $for = "SELECT e.`vName` FROM hrd.`employee` e WHERE e.`cNip` = '".$dt['cFormulator']."'";
                        $formu = $this->db->query($vn)->row_array();
                        if(empty($vName['vName'])){
                            $formu['vName'] = '-';
                        }
                        $_cFormulator = $formu['vName'];
                }

                $uri = 'lokal_skala_trial';
                $o = "";  
                $o   .= "<div style='
                                padding: 3px;
                                width: 500px;
                                border: 1px solid rgba(51, 23, 93, 0.2);
                                background-color: #FFF;'>";
                
                
                $o   .= "<table border='0' style='width: 100%;'>
                            <tbody>";  
                $o  .="         <tr>
                                    <td width='20%'>No Request</td>
                                    <td>:</td>
                                    <td width='75%'>";
                $o .= '         <input type="hidden" name="'.$field.'"  id="'.$id.'"  class="'.$id.' input_rows1 required" size="30" value="'.$value.'"/>';
                $o .= '         <input readonly type="text" name="'.$uri.'_vNo_req_refor"  id="'.$uri.'_vNo_req_refor"  class="'.$uri.'_vNo_req_refor required input_rows1" size="30" value="'.$_vNo_req_refor.'"/>';
                if($rowData['isubmit_trial']==0){
                    $o .= '         &nbsp;<button class="icon_pop"  onclick="browse(\''.base_url().'processor/reformulasi/browse/skala/trial/?field=lokal_skala_trial\',\'Request Reformulasi\')" type="button">Browse</button>';  
                }
                $o  .="             </td>
                                </tr>
                                
                                <tr>
                                    <td width='20%'>Nama Produk</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_cIteno' id='".$uri."_cIteno'>".$_cIteno."</span> 
                                    </td>
                                </tr>
                                
                                

                                <tr>
                                    <td width='20%'>Nama Inisiator</td>
                                    <td>:</td>
                                    <td width='75%'> 

                                        <span class='".$uri."_cInisiator' id='".$uri."_cInisiator'>".$_cInisiator."</span>
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>Dapartement</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_cdapart' id='".$uri."_cdapart'>".$_cdapart."</span>
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>Alasan Refor</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_vAlasan_refor' id='".$uri."_vAlasan_refor'>".$_vAlasan_refor."</span>
                                    </td>
                                </tr> 

                                <tr>
                                    <td width='20%'>Team PD</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_iteam_pd' id='".$uri."_iteam_pd'>".$_iteam_pd."</span>  
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>Tgl Permintaan Refor</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_dRequest' id='".$uri."_dRequest'>".$_dRequest."</span> 
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>Approval Atasan Inisiator</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_iStatus' id='".$id."_iStatus'>".$_iStatus."</span> 
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>PIC Formulator Refor</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_cFormulator' id='".$uri."_cFormulator'>".$_cFormulator."</span>  
                                    </td>
                                </tr>

                                <tr>
                                    <td width='20%'>File Upload</td>
                                    <td>:</td>
                                    <td width='75%'> 
                                        <span class='".$uri."_iupload_f' id='".$uri."_iupload_f'>".$_iupload_f."</span>
                                    </td>
                                </tr>

                                
                                
                            </tbody>    
                        </table>"; 
                $o .= "    </div>";  

                $o .= '<script>
                        $( "button.icon_pop" ).button({
                            icons: {
                                primary: "ui-icon-newwin"
                            }, 
                        })
                    </script>';

                     
                return $o;
            }   
            
            function insertBox_lokal_skala_trial_dupdate($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_lokal_skala_trial_dupdate($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_cUpdate($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" maxlength = "50" />';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                    var len = this.value.length;
                                        if (len >= 250) {
                                            this.value = this.value.substring(0, 50);
                                        }
                                    $("#maxlengthnote_'.$id.'").text(50 - len);
                                });
                             </script>';
                $return .= '<br/>tersisa <span id="maxlengthnote_'.$id.'">50</span> karakter<br/>';
                return $return;
            }
            function updateBox_lokal_skala_trial_cUpdate($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" maxlength = "50"  value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                    var len = this.value.length;
                                        if (len >= 50) {
                                            this.value = this.value.substring(0, 50);
                                        }
                                    $("#maxlengthnote_'.$id.'").text(50 - len);
                                });
                             </script>';
                $return .= '<br/>tersisa <span id="maxlengthnote_'.$id.'">50</span> karakter<br/>';

                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_lDeleted($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                     this.value = this.value.replace(/[^0-9\.]/g,"");
                                });
                             </script>';
                return $return;
            }
            function updateBox_lokal_skala_trial_lDeleted($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                     this.value = this.value.replace(/[^0-9\.]/g,"");
                                });
                             </script>';
                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_iappd($field, $id) {
                $return ='';
                $return .= '
                            <script type="text/javascript">
                                $("label[for=\''.$id.'\']").hide();
                                $("label[for=\''.$id.'\']").next().css("margin-left",0);
                            </script>
                        ';
                $return .= '<div></div>';
                return $return;
            }
            function updateBox_lokal_skala_trial_iappd($field, $id, $value, $rowData) {
                if(($value <> 0) || (!empty($value))){
                    $sql_dtapp = "SELECT * FROM reformulasi.`lokal_refor_skala_trial` a JOIN hrd.employee b on b.cNip=a.cappd
                    WHERE a.`lDeleted` = 0 AND a.ilokal_refor_skala_trial = '".$rowData['ilokal_refor_skala_trial']."'";
                    $row = $this->db->query($sql_dtapp)->row_array();
                    
                    if($value==2){
                        $st='<p style="">Approved';
                        $ret= $st.' oleh '.$row['vName'].' pada '.$row['dappd'].'</br> Alasan: '.$row['tappd'].'</p>';
                    }
                    elseif($value==1){
                        $st='<p style="color:red;">Rejected';
                        $ret= $st.' oleh '.$row['vName'].' pada '.$row['dappd'].'</br> Alasan: '.$row['tappd'].'</p>';
                    } 
                }
                else{
                    $ret='Waiting for Approval';
                }
                $ret .= "<input type='hidden' name='".$field."' id='".$id."'  value='".$value."'/>";
                return $ret;
            }   
            
            function insertBox_lokal_skala_trial_cappd($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" maxlength = "50" />';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                    var len = this.value.length;
                                        if (len >= 250) {
                                            this.value = this.value.substring(0, 50);
                                        }
                                    $("#maxlengthnote_'.$id.'").text(50 - len);
                                });
                             </script>';
                $return .= '<br/>tersisa <span id="maxlengthnote_'.$id.'">50</span> karakter<br/>';
                return $return;
            }
            function updateBox_lokal_skala_trial_cappd($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" maxlength = "50"  value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                    var len = this.value.length;
                                        if (len >= 50) {
                                            this.value = this.value.substring(0, 50);
                                        }
                                    $("#maxlengthnote_'.$id.'").text(50 - len);
                                });
                             </script>';
                $return .= '<br/>tersisa <span id="maxlengthnote_'.$id.'">50</span> karakter<br/>';

                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_tappd($field, $id) {
                $return = '<textarea name="'.$field.'" id="'.$id.'" class="required" style="width: 240px; height: 50px;" size="250" maxlength ="250"></textarea>';
                $return .= '<script>
                                $("#'.$id.'").keyup(function() {
                                    var len = this.value.length;
                                        if (len >= 250) {
                                            this.value = this.value.substring(0, 255);
                                        }
                                    $("#maxlengthnote_'.$id.'").text(255 - len);
                                });
                             </script>';
                $return .= '<br/>tersisa <span id="maxlengthnote_'.$id.'">250</span> karakter<br/>';
                return $return;
            }
            function updateBox_lokal_skala_trial_tappd($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= '<label title="Note">'.nl2br($value).'</label>'; 
                }else{
                    $return = '<textarea name="'.$field.'" id="'.$id.'" class="required" style="width: 240px; height: 50px;" size="250" maxlength ="250">'.nl2br($value).'</textarea>';
                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_dappd($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_lokal_skala_trial_dappd($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_vnoFormulasi($field, $id) {
                $return = '<input  type="text" name="'.$field.'"  id="'.$id.'"  class="'.$id.' input_rows1 required" size="30" maxlength = "50" />';
                $return .= '';
                return $return;
            }
            function updateBox_lokal_skala_trial_vnoFormulasi($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input  type="text" name="'.$field.'"  id="'.$id.'"  class="'.$id.' input_rows1 required" size="30" maxlength = "50"  value="'.$value.'"/>';
                $return .= '';

                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_cpic_skala_trial($field, $id) {  
                $url6 = base_url().'processor/reformulasi/lokal/skala/trial?action=searchcNip'; 
                // $o = "<script type='text/javascript'>
                //                 $(document).ready(function() { 
                //                     $('#".$id."_').live('keyup', function(e) {
                //                         var config = {
                //                             source: '".$url6."',                    
                //                             select: function(event, ui){
                //                                 $('#".$id."').val(ui.item.id);
                //                                 $('#".$id."_').val(ui.item.value);  
                //                                 return false;                           
                //                             },
                //                             minLength: 2,
                //                             autoFocus: true,
                //                             }; 
                //                         $('#".$id."_').autocomplete(config);  
                //                         $(this).keypress(function(e){
                //                             if(e.which != 13) {
                //                                 $('#".$id."').val('');
                //                             }           
                //                         });
                //                         $(this).blur(function(){
                //                             if($('#".$id."').val() == '') {
                //                                 $(this).val('');
                //                             }           
                //                         });

                //                     }); 
                                        
                //                 }); 
                //           </script>";
                $o    = '';
                $o   .= '<input type="hidden" name="'.$field.'"  id="'.$id.'"  class="'.$id.' input_rows1 required" size="30" maxlength = "50"  value=""/>';
                $o   .= '<input readonly type="text" name="'.$field.'_"  id="'.$id.'_"  class="'.$id.'_ input_rows1 required" size="30" maxlength = "50"  value=""/>';             
                return $o;
            }
            function updateBox_lokal_skala_trial_cpic_skala_trial($field, $id, $value, $rowData) {
                $vn = "SELECT e.`vName` FROM hrd.`employee` e WHERE e.`cNip` = '".$value."'";
                $vName = $this->db->query($vn)->row_array();
                if(empty($vName['vName'])){
                    $vName['vName'] = '-';
                }
                if ($this->input->get('action') == 'view') {
                     $o= $value.' - '.$vName['vName']; 
                }else{
                    $url6 = base_url().'processor/reformulasi/lokal/skala/trial?action=searchcNip'; 
                    // $o = "<script type='text/javascript'>
                    //                 $(document).ready(function() { 
                    //                     $('#".$id."_').live('keyup', function(e) {
                    //                         var config = {
                    //                             source: '".$url6."',                    
                    //                             select: function(event, ui){
                    //                                 $('#".$id."').val(ui.item.id);
                    //                                 $('#".$id."_').val(ui.item.value);  
                    //                                 return false;                           
                    //                             },
                    //                             minLength: 2,
                    //                             autoFocus: true,
                    //                             }; 
                    //                         $('#".$id."_').autocomplete(config);  
                    //                         $(this).keypress(function(e){
                    //                             if(e.which != 13) {
                    //                                 $('#".$id."').val('');
                    //                             }           
                    //                         });
                    //                         $(this).blur(function(){
                    //                             if($('#".$id."').val() == '') {
                    //                                 $(this).val('');
                    //                             }           
                    //                         });

                    //                     }); 
                                            
                    //                 }); 
                    //           </script>";
                    $o    = '';
                    $o   .= '<input type="hidden" name="'.$field.'"  id="'.$id.'"  class="'.$id.' input_rows1 required" size="30" maxlength = "50"  value="'.$value.'"/>';
                    $o   .= '<input readonly type="text" name="'.$field.'_"  id="'.$id.'_"  class="'.$id.'_ input_rows1 required" size="30" maxlength = "50"  value="'.$value.' - '.$vName['vName'].'"/>';
                }

                
                return $o;
            }   
            
            function insertBox_lokal_skala_trial_dstart_skala_trial($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_lokal_skala_trial_dstart_skala_trial($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_dfinish_skala_trial($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_lokal_skala_trial_dfinish_skala_trial($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_iksm_skala_trial($field, $id) {
               $return = '<select id="'.$id.'" class="required combobox" name="'.$field.'">
                            <option value="">--Select--</option>
                            <option value="0">TMS</option>
                            <option value="1">MS</option>
                          </select><input type="hidden" name="isdraft" id="isdraft">
                          <style>
                             #'.$id.'{
                                 width:160px;   
                            }
                          </style>';
                return $return;
            }
            function updateBox_lokal_skala_trial_iksm_skala_trial($field, $id, $value, $rowData) {
                $ast = array(''=>'--Select--','0'=>'TMS','1'=>'MS'); 

                if ($this->input->get('action') == 'view') {
                    $return= $ast[$value];
                }
                else{
                    $return  = "<select id='".$id."' class='combobox' name='".$field."'>";            
                        foreach($ast as $k=>$v) {
                            if ($k == $value) $selected = " selected";
                            else $selected = "";
                            $return .= "<option {$selected} value='".$k."'>".$v."</option>";
                        }            
                    $return .= "</select><input type='hidden' name='isdraft' id='isdraft'>";
                    $return .= '<style>
                                    #'.$id.'{
                                    width:160px;   
                                    }
                                </style>';
                }
                
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_cpic_kimiawi($field, $id) {
                $url6 = base_url().'processor/reformulasi/lokal/skala/trial?action=searchcNip'; 
                $o = "<script type='text/javascript'>
                                $(document).ready(function() { 
                                    $('#".$id."_').live('keyup', function(e) {
                                        var config = {
                                            source: '".$url6."',                    
                                            select: function(event, ui){
                                                $('#".$id."').val(ui.item.id);
                                                $('#".$id."_').val(ui.item.value);  
                                                return false;                           
                                            },
                                            minLength: 2,
                                            autoFocus: true,
                                            }; 
                                        $('#".$id."_').autocomplete(config);  
                                        $(this).keypress(function(e){
                                            if(e.which != 13) {
                                                $('#".$id."').val('');
                                            }           
                                        });
                                        $(this).blur(function(){
                                            if($('#".$id."').val() == '') {
                                                $(this).val('');
                                            }           
                                        });

                                    }); 
                                        
                                }); 
                          </script>";
                $o   .= '<input type="hidden" name="'.$field.'"  id="'.$id.'"  class="input_rows1 " size="30" maxlength = "50"  value=""/>';
                $o   .= '<input type="text" name="'.$field.'_"  id="'.$id.'_"  class="input_rows1 " size="30" maxlength = "50"  value=""/>';             
                return $o;
            }
            function updateBox_lokal_skala_trial_cpic_kimiawi($field, $id, $value, $rowData) {
                $vn = "SELECT e.`vName` FROM hrd.`employee` e WHERE e.`cNip` = '".$value."'";
                $vName = $this->db->query($vn)->row_array();
                if(empty($vName['vName'])){
                    $vName['vName'] = '-';
                }
                if ($this->input->get('action') == 'view') {
                     $o= $value.' - '.$vName['vName']; 
                }else{
                    $url6 = base_url().'processor/reformulasi/lokal/skala/trial?action=searchcNip'; 
                    $o = "<script type='text/javascript'>
                                    $(document).ready(function() { 
                                        $('#".$id."_').live('keyup', function(e) {
                                            var config = {
                                                source: '".$url6."',                    
                                                select: function(event, ui){
                                                    $('#".$id."').val(ui.item.id);
                                                    $('#".$id."_').val(ui.item.value);  
                                                    return false;                           
                                                },
                                                minLength: 2,
                                                autoFocus: true,
                                                }; 
                                            $('#".$id."_').autocomplete(config);  
                                            $(this).keypress(function(e){
                                                if(e.which != 13) {
                                                    $('#".$id."').val('');
                                                }           
                                            });
                                            $(this).blur(function(){
                                                if($('#".$id."').val() == '') {
                                                    $(this).val('');
                                                }           
                                            });

                                        }); 
                                            
                                    }); 
                              </script>";
                    $o   .= '<input type="hidden" name="'.$field.'"  id="'.$id.'"  class="input_rows1 " size="30" maxlength = "50"  value="'.$value.'"/>';
                    $o   .= '<input type="text" name="'.$field.'_"  id="'.$id.'_"  class="input_rows1 " size="30" maxlength = "50"  value="'.$value.' - '.$vName['vName'].'"/>';
                }


                return $o;
            }   
            
            function insertBox_lokal_skala_trial_iksm_kimiawi($field, $id) {
                $return = '<select id="'.$id.'" class="combobox" name="'.$field.'">
                            <option value="">--Select--</option>
                            <option value="0">TMS</option>
                            <option value="1">MS</option>
                          </select><input type="hidden" name="isdraft" id="isdraft">
                          <style>
                             #'.$id.'{
                                 width:160px;   
                            }
                          </style>';
                return $return;
            }
            function updateBox_lokal_skala_trial_iksm_kimiawi($field, $id, $value, $rowData) {
                $ast = array(''=>'--Select--','0'=>'TMS','1'=>'MS'); 

                if ($this->input->get('action') == 'view') {
                    $return= $ast[$value];
                }
                else{
                    $return  = "<select id='".$id."' class='combobox' name='".$field."'>";            
                        foreach($ast as $k=>$v) {
                            if ($k == $value) $selected = " selected";
                            else $selected = "";
                            $return .= "<option {$selected} value='".$k."'>".$v."</option>";
                        }            
                    $return .= "</select><input type='hidden' name='isdraft' id='isdraft'>";
                    $return .= '<style>
                                    #'.$id.'{
                                    width:160px;   
                                    }
                                </style>';
                }
                
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_dksm_kimiawi($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_lokal_skala_trial_dksm_kimiawi($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_dstart_kimiawi($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 " size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_lokal_skala_trial_dstart_kimiawi($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 " size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_dfinish_kimiawi($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 " size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_lokal_skala_trial_dfinish_kimiawi($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 " size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_cpic_disolusi($field, $id) {
                $url6 = base_url().'processor/reformulasi/lokal/skala/trial?action=searchcNip'; 
                $o = "<script type='text/javascript'>
                                $(document).ready(function() { 
                                    $('#".$id."_').live('keyup', function(e) {
                                        var config = {
                                            source: '".$url6."',                    
                                            select: function(event, ui){
                                                $('#".$id."').val(ui.item.id);
                                                $('#".$id."_').val(ui.item.value);  
                                                return false;                           
                                            },
                                            minLength: 2,
                                            autoFocus: true,
                                            }; 
                                        $('#".$id."_').autocomplete(config);  
                                        $(this).keypress(function(e){
                                            if(e.which != 13) {
                                                $('#".$id."').val('');
                                            }           
                                        });
                                        $(this).blur(function(){
                                            if($('#".$id."').val() == '') {
                                                $(this).val('');
                                            }           
                                        });

                                    }); 
                                        
                                }); 
                          </script>";
                $o   .= '<input type="hidden" name="'.$field.'"  id="'.$id.'"  class="input_rows1 " size="30" maxlength = "50"  value=""/>';
                $o   .= '<input type="text" name="'.$field.'_"  id="'.$id.'_"  class="input_rows1 " size="30" maxlength = "50"  value=""/>';             
                return $o;
            }
            function updateBox_lokal_skala_trial_cpic_disolusi($field, $id, $value, $rowData) {
                $vn = "SELECT e.`vName` FROM hrd.`employee` e WHERE e.`cNip` = '".$value."'";
                $vName = $this->db->query($vn)->row_array();
                if(empty($vName['vName'])){
                    $vName['vName'] = '-';
                }
                if ($this->input->get('action') == 'view') {
                     $o= $value.' - '.$vName['vName']; 
                }else{
                    $url6 = base_url().'processor/reformulasi/lokal/skala/trial?action=searchcNip'; 
                    $o = "<script type='text/javascript'>
                                    $(document).ready(function() { 
                                        $('#".$id."_').live('keyup', function(e) {
                                            var config = {
                                                source: '".$url6."',                    
                                                select: function(event, ui){
                                                    $('#".$id."').val(ui.item.id);
                                                    $('#".$id."_').val(ui.item.value);  
                                                    return false;                           
                                                },
                                                minLength: 2,
                                                autoFocus: true,
                                                }; 
                                            $('#".$id."_').autocomplete(config);  
                                            $(this).keypress(function(e){
                                                if(e.which != 13) {
                                                    $('#".$id."').val('');
                                                }           
                                            });
                                            $(this).blur(function(){
                                                if($('#".$id."').val() == '') {
                                                    $(this).val('');
                                                }           
                                            });

                                        }); 
                                            
                                    }); 
                              </script>";
                    $o   .= '<input type="hidden" name="'.$field.'"  id="'.$id.'"  class="input_rows1 " size="30" maxlength = "50"  value="'.$value.'"/>';
                    $o   .= '<input type="text" name="'.$field.'_"  id="'.$id.'_"  class="input_rows1 " size="30" maxlength = "50"  value="'.$value.' - '.$vName['vName'].'"/>';
                }


                return $o;
            }   
            
            function insertBox_lokal_skala_trial_iksm_disolusi($field, $id) {
                 $return = '<select id="'.$id.'" class="combobox" name="'.$field.'">
                            <option value="">--Select--</option>
                            <option value="0">TMS</option>
                            <option value="1">MS</option>
                          </select><input type="hidden" name="isdraft" id="isdraft">
                          <style>
                             #'.$id.'{
                                 width:160px;   
                            }
                          </style>';
                return $return;
            }
            function updateBox_lokal_skala_trial_iksm_disolusi($field, $id, $value, $rowData) {
                $ast = array(''=>'--Select--','0'=>'TMS','1'=>'MS'); 

                if ($this->input->get('action') == 'view') {
                    $return= $ast[$value];
                }
                else{
                    $return  = "<select id='".$id."' class='combobox' name='".$field."'>";            
                        foreach($ast as $k=>$v) {
                            if ($k == $value) $selected = " selected";
                            else $selected = "";
                            $return .= "<option {$selected} value='".$k."'>".$v."</option>";
                        }            
                    $return .= "</select><input type='hidden' name='isdraft' id='isdraft'>";
                    $return .= '<style>
                                    #'.$id.'{
                                    width:160px;   
                                    }
                                </style>';
                }
                
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_dksm_disolusi($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_lokal_skala_trial_dksm_disolusi($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_dstart_disolusi($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_lokal_skala_trial_dstart_disolusi($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                $return .= '<input type="hidden" name="ilokal_refor_skala_trial"  id="ilokal_refor_skala_trial"  
                            class="input_rows1" size="30" value="'.$rowData['ilokal_refor_skala_trial'].'"/>';
                
                } 
                return $return;
            }   
            
            function insertBox_lokal_skala_trial_dfinish_disolusi($field, $id) {
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1" size="30" />';
                $return .= '<script>
                                $("#'.$id.'").datepicker({  changeMonth:true,
                                        changeYear:true,
                                        dateFormat:"yy-mm-dd"}); 
                             </script>';
                return $return;
            }
            function updateBox_lokal_skala_trial_dfinish_disolusi($field, $id, $value, $rowData) {
                if ($this->input->get('action') == 'view') {
                     $return= $value; 
                }else{
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1" size="30" value="'.$value.'"/>';
                $return .= '<script>
                                $("#'.$id.'").datepicker({
                                    changeMonth:true,
                                    changeYear:true,
                                    dateFormat:"yy-mm-dd"
                                });
                             </script>';
                } 
                return $return;
            }   
            
            
                //Ini Merupakan Standart Approve yang digunakan di erp
 
                function approve_view() {
                    $echo = '<script type="text/javascript">
                                 function submit_ajax(form_id) {
                                    return $.ajax({
                                        url: $("#"+form_id).attr("action"),
                                        type: $("#"+form_id).attr("method"),
                                        data: $("#"+form_id).serialize(),
                                        success: function(data) {
                                            var o = $.parseJSON(data);
                                            var last_id = o.last_id;
                                            var url = "'.base_url().'processor/reformulasi/lokal_skala_trial";                             
                                            if(o.status == true) { 
                                                $("#alert_dialog_form").dialog("close");
                                                     $.get(url+"?action=update&id="+last_id, function(data) {
                                                     $("div#form_lokal_skala_trial").html(data);
                                                     
                                                });
                                                
                                            }
                                                reload_grid("grid_lokal_skala_trial");
                                        }
                                        
                                     })
                                 }
                             </script>';
                    $echo .= '<h1>Approve</h1><br />';
                    $echo .= '<form id="form_lokal_skala_trial_approve" action="'.base_url().'processor/reformulasi/lokal_skala_trial?action=approve_process" method="post">';
                    $echo .= '<div style="vertical-align: top;">';
                    $echo .= 'Remark : 
                            <input type="hidden" name="ilokal_refor_skala_trial" value="'.$this->input->get('ilokal_refor_skala_trial').'" />
                            <input type="hidden" name="lvl" value="'.$this->input->get('lvl').'" />
                            <input type="hidden" name="group_id" value="'.$this->input->get('group_id').'" />
                            <input type="hidden" name="modul_id" value="'.$this->input->get('modul_id').'" />
                            <textarea name="vRemark"></textarea>
                    <button type="button" onclick="submit_ajax(\'form_lokal_skala_trial_approve\')">Approve</button>';
                        
                    $echo .= '</div>';
                    $echo .= '</form>';
                    return $echo;
                } 
 
                function approve_process() {
                    $post = $this->input->post();
                    $cNip= $this->user->gNIP;
                    $vName= $this->user->gName;
                    $ilokal_refor_skala_trial = $post['ilokal_refor_skala_trial'];
                    $vRemark = $post['vRemark'];
                    $lvl = $post['lvl'];
 
                    //Letakan Query Update approve disini 
                    $nip = $this->user->gNIP;
                    $skg=date('Y-m-d H:i:s'); 
                    $this->db->where('ilokal_refor_skala_trial', $post['ilokal_refor_skala_trial']);
                    $this->db->update('reformulasi.lokal_refor_skala_trial', array('iappd'=>2,'cappd'=>$nip,'dappd'=>$skg,'tappd'=>$vRemark));

                    $to = $cc = '';  
                    $sql = "SELECT * FROM 
                            reformulasi.`lokal_refor_skala_trial` st WHERE st.`lDeleted` = 0 
                            AND st.`ilokal_refor_skala_trial` = '".$post['ilokal_refor_skala_trial']."'";

                    $dtm = $this->db->query($sql)->row_array();

                    #update status refor
                    $sqlD = "SELECT mp.`imaster_proses_refor`, mp.`iUrutan`, lm.`iLocal_req_refor` FROM 
                        reformulasi.lokal_mapping_refor lm JOIN reformulasi.`master_proses_refor` mp 
                        ON lm.`imaster_proses_refor` = mp.`imaster_proses_refor` WHERE lm.`iLocal_req_refor` = '".$dtm['iLocal_req_refor']."'
                        AND lm.`lDeleted` = 0 AND mp.`lDeleted` = 0 ORDER BY mp.`iUrutan`";
                    $sqlDQ = $this->db->query($sqlD)->result_array();
                    $int = 0 ;
                    $ke = 0;
                    foreach($sqlDQ as $k) {
                       if($int==1){
                        $ke=$k['imaster_proses_refor'];
                        $int=2;
                       } 
                       if($k['imaster_proses_refor']==4){
                            $int = 1 ;
                       } 
                    }
                    if($int==1){
                        $ke = 13;
                    } 
                    $sql2 = "UPDATE reformulasi.`local_req_refor` st SET st.`iStatus_proses` = '".$ke."' WHERE 
                            st.`iLocal_req_refor` = '".$dtm['iLocal_req_refor']."'";
                    $this->db->query($sql2); 


                    $iAm = $this->whoAmI($cNip); 
                    $iAm1 = $this->whoAmI($dtm['cpic_disolusi']); 
                    $iAm2 = $this->whoAmI($dtm['cpic_kimiawi']); 
                    $iAm3 = $this->whoAmI($dtm['cpic_skala_trial']); 

                    if(empty($iAm['vEmail']) || $iAm['vEmail']==""){
                        $iAm['vEmail'] = '';
                    }else{
                        $iAm['vEmail'] = $iAm['vEmail'].';';
                    }
                    if(empty($iAm1['vEmail']) || $iAm1['vEmail']==""){
                        $iAm1['vEmail'] = '';
                    }else{
                        $iAm1['vEmail'] = $iAm1['vEmail'].';';
                    }
                    if(empty($iAm2['vEmail']) || $iAm2['vEmail']==""){
                        $iAm2['vEmail'] = '';
                    }else{
                        $iAm2['vEmail'] = $iAm2['vEmail'].';';
                    }
                    if(empty($iAm3['vEmail']) || $iAm3['vEmail']==""){
                        $iAm3['vEmail'] = '';
                    }else{
                        $iAm3['vEmail'] = $iAm3['vEmail'].';';
                    }

                    $to = $iAm3['vEmail'];
                    $cc = $iAm['vEmail'];  
                    $arr = array(''=>'Tidak Memenuhi Syarat','0'=>'Tidak Memeuni Syarat','1'=>'Memenuhi Syarat');
                    $subject="Approval Skala Trial: No Formula ".$dtm['vnoFormulasi']; 
                        $content="
                        Diberitahukan bahwa telah ada Approval Skala Trial, 
                            dengan rincian sebagai berikut :<br><br>  
                            <table border='0' style='width: 600px;'>
                                <tr>
                                        <td style='width: 110px;'><b>No Formulasi </b></td><td style='width: 20px;'> : </td>
                                        <td>".$dtm['vnoFormulasi']."</td>
                                </tr>
                                <tr>
                                        <td><b>Kesimpulan Hasil  </b></td><td> : </td>
                                        <td>".$arr[$dtm['iksm_skala_trial']]."</td>
                                </tr>  
                            </table> 
                        <br/> 
                        Link Aplikasi : www.npl-net.com/erp <br>
                        Menu : Reformulasi - Transaksi - Skala Trial
                        <br/> <br/>
                        Demikian, mohon segera follow up  pada aplikasi ERP Reformulasi. Terimakasih.<br><br><br>
                        Post Master";  
                        //$this->lib_utilitas->send_email($to, $cc, $subject, $content);

                    $data['status']  = true;
                    $data['last_id'] = $post['ilokal_refor_skala_trial'];
                    return json_encode($data);
                }
            
                //Ini Merupakan Standart Reject yang digunakan di erp

                function reject_view() {
                    $echo = '<script type="text/javascript">
                                 function submit_ajax(form_id) {
                                    var remark = $("#lokal_skala_trial_remark").val();
                                    if (remark=="") {
                                        alert("Remark tidak boleh kosong ");
                                        return
                                    }

                                    return $.ajax({
                                        url: $("#"+form_id).attr("action"),
                                        type: $("#"+form_id).attr("method"),
                                        data: $("#"+form_id).serialize(),
                                        success: function(data) {
                                            var o = $.parseJSON(data);
                                            var last_id = o.last_id;
                                            var url = "'.base_url().'processor/reformulasi/lokal_skala_trial";                             
                                            if(o.status == true) { 
                                                $("#alert_dialog_form").dialog("close");
                                                     $.get(url+"?action=update&id="+last_id, function(data) {
                                                     $("div#form_lokal_skala_trial").html(data);
                                                     
                                                });
                                                
                                            }
                                                reload_grid("grid_lokal_skala_trial");
                                        }
                                        
                                     })
                                 }
                             </script>';
                    $echo .= '<h1>Reject</h1><br />';
                    $echo .= '<form id="form_lokal_skala_trial_reject" action="'.base_url().'processor/reformulasi/lokal_skala_trial?action=reject_process" method="post">';
                    $echo .= '<div style="vertical-align: top;">';
                    $echo .= 'Remark : 
                            <input type="hidden" name="ilokal_refor_skala_trial" value="'.$this->input->get('ilokal_refor_skala_trial').'" />
                            <input type="hidden" name="lvl" value="'.$this->input->get('lvl').'" />
                            <input type="hidden" name="group_id" value="'.$this->input->get('group_id').'" />
                            <input type="hidden" name="modul_id" value="'.$this->input->get('modul_id').'" />
                            <textarea name="vRemark" id="reject_lokal_skala_trial_remark"></textarea>
                    <button type="button" onclick="submit_ajax(\'form_lokal_skala_trial_reject\')">Reject</button>';
                        
                    $echo .= '</div>';
                    $echo .= '</form>';
                    return $echo;
                }


                
                function reject_process() {
                    $post = $this->input->post();
                    $cNip= $this->user->gNIP;
                    $vName= $this->user->gName;
                    $ilokal_refor_skala_trial = $post['ilokal_refor_skala_trial'];
                    $vRemark = $post['vRemark'];
                    $lvl = $post['lvl'];
 
                    //Letakan Query Update approve disini
                    $nip = $this->user->gNIP;
                    $skg=date('Y-m-d H:i:s'); 
                    $this->db->where('ilokal_refor_skala_trial', $post['ilokal_refor_skala_trial']);
                    $this->db->update('reformulasi.lokal_refor_skala_trial', array('iappd'=>1,'cappd'=>$nip,'dappd'=>$skg,'tappd'=>$vRemark));

                    $data['status']  = true;
                    $data['last_id'] = $post['ilokal_refor_skala_trial'];
                    return json_encode($data);
                }
            

        
            //Standart Setiap table harus memiliki dCreate , cCreated, dupdate, cUpdate
            function before_insert_processor($row, $postData) {
                $postData['dCreate'] = date('Y-m-d H:i:s');
                $postData['cCreated']=$this->user->gNIP;
                if($postData['isdraft']==true){
                    $postData['isubmit_trial']=0; 
                } 
                else{
                    $postData['isubmit_trial']=1; 
                } 
                return $postData;

            }
            function before_update_processor($row, $postData) {
                $postData['dupdate'] = date('Y-m-d H:i:s');
                $postData['cUpdate'] = $this->user->gNIP;
                if($postData['isdraft']==true){
                    $postData['isubmit_trial']=0; 
                } 
                else{
                    $postData['isubmit_trial']=1; 
                } 
                return $postData; 
            }    
        
            function after_insert_processor($fields, $id, $postData) {
                //Example After Insert
                /*
                $cNip = $this->sess_auth_local->gNIP; 
                $sql = 'Place Query In Here';
                $this->dbset->query($sql);
                */

                if($postData['isubmit_trial']==1){
                    $to = $cc = ''; 
                    $cNip = $this->user->gNIP;
                    $sql = "SELECT * FROM 
                            reformulasi.`lokal_refor_skala_trial` st WHERE st.`lDeleted` = 0 
                            AND st.`ilokal_refor_skala_trial` = '".$id."'";   
                    $dtm = $this->db->query($sql)->row_array();

                    $up = "SELECT rt.`vnip` FROM reformulasi.`local_req_refor` lr JOIN `reformulasi`.`reformulasi_team` 
                        rt ON rt.`ireformulasi_team` = lr.`iteam_pd`
                        WHERE lr.`lDeleted` = 0 AND rt.`ldeleted` = 0 AND lr.`iLocal_req_refor` = '".$dtm['iLocal_req_refor']."'";
                    $toto = $this->db->query($up)->row_array();
                    $tom = $this->whoAmI($toto['vnip']); 
                    $to = $tom['vEmail']; 

                    $iAm = $this->whoAmI($cNip); 
                    $iAm1 = $this->whoAmI($dtm['cpic_disolusi']); 
                    $iAm2 = $this->whoAmI($dtm['cpic_kimiawi']); 
                    $iAm3 = $this->whoAmI($dtm['cpic_skala_trial']); 
                    if(empty($iAm['vEmail']) || $iAm['vEmail']==""){
                        $iAm['vEmail'] = '';
                    }else{
                        $iAm['vEmail'] = $iAm['vEmail'].';';
                    }
                    if(empty($iAm1['vEmail']) || $iAm1['vEmail']==""){
                        $iAm1['vEmail'] = '';
                    }else{
                        $iAm1['vEmail'] = $iAm1['vEmail'].';';
                    }
                    if(empty($iAm2['vEmail']) || $iAm2['vEmail']==""){
                        $iAm2['vEmail'] = '';
                    }else{
                        $iAm2['vEmail'] = $iAm2['vEmail'].';';
                    }
                    if(empty($iAm3['vEmail']) || $iAm3['vEmail']==""){
                        $iAm3['vEmail'] = '';
                    }else{
                        $iAm3['vEmail'] = $iAm3['vEmail'].';';
                    }

                    $cc = $iAm['vEmail'].$iAm3['vEmail'];
                    //$cc = '';  
                    $arr = array(''=>'Tidak Memenuhi Syarat','0'=>'Tidak Memenuni Syarat','1'=>'Memenuhi Syarat');
                    $subject="Submited Skala Trial: No Formula ".$dtm['vnoFormulasi']; 
                        $content="
                        Diberitahukan bahwa telah ada Submited Skala Trial, 
                            dengan rincian sebagai berikut :<br><br>  
                            <table border='0' style='width: 600px;'>
                                <tr>
                                        <td style='width: 110px;'><b>No Formulasi </b></td><td style='width: 20px;'> : </td>
                                        <td>".$dtm['vnoFormulasi']."</td>
                                </tr>
                                <tr>
                                        <td><b>Kesimpulan Hasil  </b></td><td> : </td>
                                        <td>".$arr[$dtm['iksm_skala_trial']]."</td>
                                </tr>  
                            </table> 
                        <br/> 
                        Link Aplikasi : www.npl-net.com/erp <br>
                        Menu : Reformulasi - Transaksi - Skala Trial
                        <br/> <br/>
                        Demikian, mohon segera follow up  pada aplikasi ERP Reformulasi. Terimakasih.<br><br><br>
                        Post Master"; 
                        // echo $to;
                        // exit; 
                        $this->lib_utilitas->send_email($to, $cc, $subject, $content);
                }
            }
    
            function after_update_processor($fields, $id, $postData) {
                //Example After Update
                /*
                $cNip = $this->sess_auth_local->gNIP; 
                $sql = 'Place Query In Here';
                $this->dbset->query($sql);
                */

                if($postData['isubmit_trial']==1){
                    $to = $cc = ''; 
                    $cNip = $this->user->gNIP;
                    $sql = "SELECT * FROM 
                            reformulasi.`lokal_refor_skala_trial` st WHERE st.`lDeleted` = 0 
                            AND st.`ilokal_refor_skala_trial` = '".$id."'";   
                    $dtm = $this->db->query($sql)->row_array();

                    $up = "SELECT rt.`vnip` FROM reformulasi.`local_req_refor` lr JOIN `reformulasi`.`reformulasi_team` 
                        rt ON rt.`ireformulasi_team` = lr.`iteam_pd`
                        WHERE lr.`lDeleted` = 0 AND rt.`ldeleted` = 0 AND lr.`iLocal_req_refor` = '".$dtm['iLocal_req_refor']."'";
                    $toto = $this->db->query($up)->row_array();
                    $tom = $this->whoAmI($toto['vnip']); 
                    $to = $tom['vEmail']; 

                    $iAm = $this->whoAmI($cNip); 
                    $iAm1 = $this->whoAmI($dtm['cpic_disolusi']); 
                    $iAm2 = $this->whoAmI($dtm['cpic_kimiawi']); 
                    $iAm3 = $this->whoAmI($dtm['cpic_skala_trial']); 
                    if(empty($iAm['vEmail']) || $iAm['vEmail']==""){
                        $iAm['vEmail'] = '';
                    }else{
                        $iAm['vEmail'] = $iAm['vEmail'].';';
                    }
                    if(empty($iAm1['vEmail']) || $iAm1['vEmail']==""){
                        $iAm1['vEmail'] = '';
                    }else{
                        $iAm1['vEmail'] = $iAm1['vEmail'].';';
                    }
                    if(empty($iAm2['vEmail']) || $iAm2['vEmail']==""){
                        $iAm2['vEmail'] = '';
                    }else{
                        $iAm2['vEmail'] = $iAm2['vEmail'].';';
                    }
                    if(empty($iAm3['vEmail']) || $iAm3['vEmail']==""){
                        $iAm3['vEmail'] = '';
                    }else{
                        $iAm3['vEmail'] = $iAm3['vEmail'].';';
                    }

                    //$cc = '';
                    $cc = $iAm['vEmail'].$iAm3['vEmail'];  
                    $arr = array(''=>'Tidak Memenuhi Syarat','0'=>'Tidak Memenuni Syarat','1'=>'Memenuhi Syarat');
                    $subject="Submited Skala Trial: No Formula ".$dtm['vnoFormulasi']; 
                        $content="
                        Diberitahukan bahwa telah ada Submited Skala Trial, 
                            dengan rincian sebagai berikut :<br><br>  
                            <table border='0' style='width: 600px;'>
                                <tr>
                                        <td style='width: 110px;'><b>No Formulasi </b></td><td style='width: 20px;'> : </td>
                                        <td>".$dtm['vnoFormulasi']."</td>
                                </tr>
                                <tr>
                                        <td><b>Kesimpulan Hasil  </b></td><td> : </td>
                                        <td>".$arr[$dtm['iksm_skala_trial']]."</td>
                                </tr>  
                            </table> 
                        <br/> 
                        Link Aplikasi : www.npl-net.com/erp <br>
                        Menu : Reformulasi - Transaksi - Skala Trial
                        <br/> <br/>
                        Demikian, mohon segera follow up  pada aplikasi ERP Reformulasi. Terimakasih.<br><br><br>
                        Post Master"; 
                        // echo $to;
                        // exit; 
                        $this->lib_utilitas->send_email($to, $cc, $subject, $content);
                }
            }
            function manipulate_insert_button($buttons) {
                unset($buttons['save']);
                $js = $this->load->view('local/js/lokal_skala_trial_js'); 

                $save_draft = '<button onclick="javascript:save_draft_btn_multiupload(\'lokal_skala_trial\', \''.base_url().'processor/reformulasi/lokal/skala/trial?draft=true\', this, true)" class="ui-button-text icon-save" id="button_save_draft_lokal_skala_trial_js">Save as Draft</button>';
                $save = '<button onclick="javascript:save_btn_multiupload(\'lokal_skala_trial\', \''.base_url().'processor/reformulasi/lokal/skala/trial?company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\', this)" class="ui-button-text icon-save" id="button_save_lokal_skala_trial_js">Save &amp Submit</button>';
                 
                
                $buttons['save'] = $save_draft.$save.$js; 

                return $buttons;
            }
            function manipulate_update_button($buttons, $rowData) { 
                //Load Javascript In Here 
                if ($this->input->get('action') == 'view') {
                    unset($buttons['update_back']);
                    unset($buttons['update']);
                }
                else{ 
                    $cNip= $this->user->gNIP;
            
                    $js = $this->load->view('local/js/lokal_skala_trial_js'); 
                    $update = '<button onclick="javascript:update_btn_back(\'lokal_skala_trial\', \''.base_url().'processor/reformulasi/lokal/skala/trial?company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\', this)" class="ui-button-text icon-save" id="button_update_lokal_skala_trial">Update & Submit</button>';
                    $updatedraft = '<button onclick="javascript:update_draft_btn(\'lokal_skala_trial\', \''.base_url().'processor/reformulasi/lokal/skala/trial?company_id='.$this->input->get('company_id').'&draft=true&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\', this, true)" class="ui-button-text icon-save" id="button_save_lokal_skala_trial">Update as Draft</button>';
                    
                    $approve = '<button onclick="javascript:load_popup(\''.base_url().'processor/reformulasi/lokal/skala/trial?action=approve&ilokal_refor_skala_trial='.$rowData['ilokal_refor_skala_trial'].'&cNip='.$cNip.'&lvl=1&status=1&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\')" class="ui-button-text icon-save" id="button_approve_lokal_skala_trial">Approve</button>';
                    $reject = '<button onclick="javascript:load_popup(\''.base_url().'processor/reformulasi/lokal/skala/trial?action=reject&ilokal_refor_skala_trial='.$rowData['ilokal_refor_skala_trial'].'&cNip='.$cNip.'&lvl=1&status=2&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').'\')" class="ui-button-text icon-save" id="button_reject_lokal_skala_trial">Reject</button>';

                    $user = $this->auth_local->user();
    
                     
                    $type = '';
                    if($this->auth_local->is_manager()){
                        $x=$this->auth_local->tipe();
                        $manager=$x['manager'];
                        if(in_array('PD', $manager)){
                            $type='PD';
                        }
                        else{
                            $type='';
                        }
                    } 

                    if($rowData['isubmit_trial']!=1){
                        $buttons['update'] = $updatedraft.$update.$js;   
                    }else{
                        if($rowData['iappd']<>0){
                            unset($buttons['update_back']);
                            unset($buttons['update']);
                        }else{
                            if($this->auth_local->is_manager() && $type=='PD'){
                                $buttons['update'] = $approve.$js;  
                            }else{
                                unset($buttons['update_back']);
                                unset($buttons['update']);
                            } 
                        }
                       
                    }

                }
                
                return $buttons;
            }
            function download($filename) {
                $this->load->helper('download');        
                $name = $_GET['file'];
                $id = $_GET['id'];
                $file = $_GET['filepath'];
                $path = file_get_contents('./files/reformulasi/local/skala_trial/'.$file.'/'.$id.'/'.$name);   
                force_download($name, $path);
            }

            //Output
            public function output(){
                $this->index($this->input->get('action'));
            }
        }