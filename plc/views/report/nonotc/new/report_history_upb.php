 
<body style="font-family: serif; font-size: 14px;">
<style>

.table1 {
    color: #000;
    border-collapse: collapse;
}
 
.dddd tr th{
    background: #35A9DB;
    color: #fff;
    font-weight: normal;
}
 
.table1, .table1 th, .table1 td {
    text-align: left;
    border: 1px solid #BBB;
}

.table1 tbody tr:nth-child(even) {
    background-color: #f2f5f7;
}
.table1 thead tr td{
	background: #35A9DB;
     color: #fff;
    font-weight: normal;
    text-align: center;
}

.tablechild {
	color: #000;
    border-collapse: collapse;
}
.tablechild tr td{
    font-weight: normal;
    text-align: left;
}
</style>

<?php
$this->load->view('template/js/jquery_datatables_js'); 
$this->load->view('template/css/jquery_datatables_css'); 

?>
<script type="text/javascript">
    $('#example').DataTable( {
        "columnDefs": [ {
            "visible": false, 
        } ],
        "scrollY": '50vh',
        "scrollX": true,
        "paging": false

    } ); 
    $('#example_filter').hide(); 

     
    
    //$('#example_wrapper').hide(); 
</script>


<div style='width:100%;'>
<div width='100%' align="center" style="font-size: 16px;"><b>Report History UPB</b></br><br></div>
<table border="1" id="example" class="display dddd" cellspacing="0" width="100%" >
	<thead>
		 <tr>
			<th rowspan="2">No UPB</th>
			<th rowspan="2">Nama Usulan</th>
			<th colspan="2">Daftar UPB</th> 
			<th colspan="1" >Set Prioritas Prareg</th>
			<th colspan="2" >Request Originator</th>			
			<th colspan="4" >Input Sample Originator</th>

			<th colspan="2" >Study Literatur</th>
			<th colspan="1" >Permintaan Sample</th>
			<th colspan="1" >Po Sample</th>
			<th colspan="1" >Penerimaan Sample</th> 
			<th colspan="3" >Terima Sample Bahan Baku</th>
			<th colspan="1" >Perlu Uji Mikro BB</th>  
			<th colspan="1" >Uji Mikro BB</th> 
			<th colspan="1" >Perlu uJI Mikro BB Spesifik</th>
			<th colspan="1" >Draft SOI Mikro BB</th> 
			<th colspan="1" >SOI Mikro BB Final</th> 
			<th colspan="1" >Analisa dan Release Sample</th>
			<th colspan="1" >Draft Soi BB</th> 
			<th colspan="2" >SOI Bahan Baku</th>

			<th colspan="1" >Formula Skala Trial</th> 
			<th colspan="1" >Perlu Stress Test</th> 
			<th colspan="1" >Stress Test</th>  
			<th colspan="1" >Formula Skala Lab</th> 
			<th colspan="2" >SOI FG</th>
			<th colspan="1" >Perlu Uji Mikro FG</th>
			<th colspan="1" >Uji Mikro FG</th> 
			<th colspan="1" >SOI Mikro FG</th>  
			<th colspan="1" >Validasi MOA</th>     
			 
			 
			<th colspan="1" >Stabilita Lab</th> 

			 
			<th colspan="1" >Best Formula</th>
			<th colspan="1" >Approval KSK</th>
			<th colspan="1" >Basic Formula  & Spesifikasi FG</th>
			<th colspan="4" >Dokumentasi Spesifikasi Bahan Kemas</th>
			<th colspan="1" >Pembuatan MBR</th>
			<th colspan="1" >Protokol Valpro</th> 
			<th colspan="1" >Produksi Pilot</th>  
			<th colspan="1" >Laporan Pengembangan Produk</th> 
			<th colspan="1" >Laporan Pemeriksaan Originator</th>
			 
			  
			<th colspan="1" >Stabilita Pilot</th>
			<th colspan="1" >Laporan Validasi Proses</th> 
			<th colspan="1" >Cek Dokumen Prareg</th>
			<th colspan="1" >Prareg</th> 
			<th colspan="1" >HPR</th>
			<th colspan="1" >Cek Dokumen Reg</th>
			<th colspan="1" >Reg</th>
			<th colspan="1" >Applet</th>             
		</tr> 
		<tr>
			<th>Approval Busdev</th>
			<th>Approval Direksi</th>
			<th>Approval Busdev</th>
			<th>Input (PD)</th>
			<th>Approval (PD)</th>
			<th>Input (Busdev)</th>
			<th>Input (PD)</th>
			<th>Input (AD)</th>
			<th>Input (QA)</th>
			<th>Approval (PD)</th>
			<th>Approval (AD)</th>
			<th>Approval PD</th>
			<th>Approval PR</th>
			<th>Approval PR</th>
			<th>Input Data (PD)</th>
			<th>Input Data (AD)</th>
			<th>Input Data (QA)</th>
			<th>Ya / Tidak</th>
			<th>Approval Chief Mikro</th>
			<th>Ya / Tidak</th>
			<th>Approval Chief Mikro</th>
			<th>Approval QA</th>
			<th>Approval PD</th>
			<th>Approval PD</th>
			<th>Approval PD</th>
			<th>Approval QA</th>
			<th>Approval PD</th>
			<th>Ya / Tidak</th>
			<th>Approval PD</th>
			<th>Approval PD</th>
			<th>Approval PD</th>
			<th>Approval QA</th>
			<th>Ya / Tidak</th>
			<th>Approval Chief Mikro</th>
			<th>Approval QA</th>
 

			<th>Approval PD</th>
			 
			 
			<th>Approval PD</th>
 
			<th>Approval PD</th>
			<th>Approval QA</th>
			<th>Approval PD</th>
			<th>Approval PackDev</th>
			<th>Approval PD</th>
			<th>Approval Busdev</th>
			<th>Approval QA</th>
			<th>Approval PD</th>
			<th>Approval QA</th>
			<th>Approval PD</th>
			<th>Approval PD</th>
			<th>Approval PD</th>
			 
			 
			<th>Approval PD</th>
			<th>Approval QA</th> 
			<th>Approval Busdev</th>
			<th>Approval Busdev</th>
			<th>Approval Busdev</th>
			<th>Approval Busdev</th>
			<th>Approval Busdev</th>
			<th>Approval Busdev</th>
		</tr>
	</thead>
	<tbody>
 		<?php 
		foreach ($row as $kr => $vr) {
			echo "<tr>";
			echo "<td>".$vr['vupb_nomor']."</td>"; 
			echo "<td>".$vr['vupb_nama']."</td>";
			//DAFTAR UPB APPROVE
				$appBD = "SELECT cnip,`tUpdate` FROM plc2.plc2_upb_approve WHERE vmodule IN ('AppUPB-BD','2471') AND vtipe='BD' 
					AND iupb_id='".$vr['iupb_id']."' AND ldeleted=0 LIMIT 1"; 
				$appBd_p = $this->db_plc0->query($appBD)->row_array();
				if(empty($appBd_p['cnip'])){
					$appBd_p['cnip'] = '-';
				}
				if(empty($appBd_p['tUpdate'])){
					$appBd_p['tUpdate'] = '-';
				}

				if($vr['iappbusdev']==2){ //Approve
					echo "<td> Approved Oleh ".$appBd_p['cnip']."<br>Pada ".$appBd_p['tUpdate']."</td>";
				}else if($vr['iappbusdev']==1){ // Reject
					echo "<td> Rejected Oleh ".$appBd_p['cnip']."<br>Pada ".$appBd_p['tUpdate']."</td>";
				}else{
					echo '<td></td>';
				}
				//Direksi
				$appDR = "SELECT cnip,`tUpdate` FROM plc2.plc2_upb_approve WHERE vmodule IN ('AppUPB-DR','2471') AND vtipe='DR' 
					AND iupb_id='".$vr['iupb_id']."' AND ldeleted=0 LIMIT 1"; 
				$appDR_p = $this->db_plc0->query($appDR)->row_array();
				if(empty($appDR_p['cnip'])){
					$appDR_p['cnip'] = '-';
				}
				if(empty($appDR_p['tUpdate'])){
					$appDR_p['tUpdate'] = '-';
				} 
				if($vr['iappbusdev']==2){ //Approve
					echo "<td> Approved Oleh ".$appDR_p['cnip']."<br>Pada ".$appDR_p['tUpdate']."</td>";
				}else if($vr['iappbusdev']==1){ // Reject
					echo "<td> Rejected Oleh ".$appDR_p['cnip']."<br>Pada ".$appDR_p['tUpdate']."</td>";
				}else{
					echo '<td></td>';
				}
				//Set Prioritas
				$appPerio = "SELECT pr.iappbusdev, pr.cnip, pr.tappbusdev
					FROM  plc2.plc2_upb_prioritas_detail prd
					INNER JOIN plc2.plc2_upb_prioritas pr ON pr.iprioritas_id=prd.iprioritas_id AND pr.ldeleted=0 
					WHERE prd.iupb_id='".$vr['iupb_id']."' AND prd.ldeleted=0
					AND pr.iyear = '".$iyear."' AND pr.imonth = '".$imonth."'
					ORDER BY pr.iyear DESC LIMIT 1"; 

				$appPerio_p = $this->db_plc0->query($appPerio)->row_array();

				if(empty($appPerio_p['cnip'])){
					$appPerio_p['cnip'] = '-';
				}
				if(empty($appPerio_p['tappbusdev'])){
					$appPerio_p['tappbusdev'] = '-';
				}
				if(empty($appPerio_p['iappbusdev'])){
					$appPerio_p['iappbusdev'] = '-';
				}

				if($appPerio_p['iappbusdev']==2){ //Approve
					echo "<td> Approved Oleh ".$appPerio_p['cnip']."<br>Pada ".$appPerio_p['tappbusdev']."</td>";
				}else if($appPerio_p['iappbusdev']==1){ // Reject
					echo "<td> Rejected Oleh ".$appPerio_p['cnip']."<br>Pada ".$appPerio_p['tappbusdev']."</td>";
				}else{
					echo "<td></td>";
				}
				//Request Originator
				$reqOrigi = "
					SELECT pu.vreq_ori_no, pu.`ireq_ori_id`, pu.`iupb_id`, pu.`trequest_ori`, pu.`cnip`, 
					pu.`iapppd`, pu.`tapppd`, pu.`vnip_apppd` 
					FROM plc2.`plc2_upb_request_originator` pu
					WHERE pu.`ldeleted` = 0
					AND pu.`iupb_id` = '".$vr['iupb_id']."' GROUP BY pu.vreq_ori_no
					";

				$reqOrigi_p = $this->db_plc0->query($reqOrigi)->result_array(); 

				echo "<td><table>";
				$i1 = 1;
				foreach ($reqOrigi_p as $k) {
					if(!empty($k['trequest_ori'])){
					 echo "<tr><td>";
					 echo $i1++;
					 echo "</td><td><b>".$k['vreq_ori_no']."</b><br>Di Input Oleh ".$k['cnip']."<br>Pada ".$k['trequest_ori']."</td><tr>";
					}
				}
				echo "</table></td>";

				echo "<td><table>";
				$i1 = 1;
				foreach ($reqOrigi_p as $v) {
					 echo "<tr><td>";
					 echo $i1++;
					 echo "</td>"; 
					 	if($v['iapppd']==2){ //Approve
							echo "<td> <b>".$v['vreq_ori_no']."</b><br> Approved Oleh ".$v['vnip_apppd']."<br>Pada ".$v['tapppd']."</td>";
						}else if($v['iapppd']==1){ // Reject
							echo "<td> <b>".$v['vreq_ori_no']."</b><br> Rejected Oleh ".$v['vnip_apppd']."<br>Pada ".$v['tapppd']."</td>";
						}else{
							echo "<td> <b>".$v['vreq_ori_no']."</b><br> </td>";
						}
					 echo "<tr>";
				}
				echo "</table></td>"; 

				//Input Sample Originator

				$inputOri = 'SELECT b.vreq_ori_no, a.`dInputBD`,a.`cAdmBD`, a.`dInputPD`, a.`cAdmPD`, a.`dInputAD`, a.`cAdmAD`, a.`dInputQA`, a.`cAdmQA` FROM plc2.plc2_upb_date_sample a
					JOIN plc2.plc2_upb_request_originator b ON b.ireq_ori_id = a.iReq_ori_id 
					WHERE b.iupb_id="'.$vr['iupb_id'].'" AND b.`ldeleted` = 0
					GROUP BY a.iKirimID, b.vreq_ori_no
					ORDER BY iCounter ASC'; 
				$inputOri_p = $this->db_plc0->query($inputOri)->result_array();

				echo "<td><table>";
				$i1 = 1;
				foreach ($inputOri_p as $k) {
					if(!empty($k['dInputBD'])){
					 echo "<tr><td>";
					 echo $i1++;
					 echo "</td><td> <b>".$k['vreq_ori_no']."</b><br> Di Input Oleh ".$k['cAdmBD']."<br>Pada ".$k['dInputBD']."</td><tr>";
					}
				}
				echo "</table></td>";

				echo "<td><table>";
				$i1 = 1;
				foreach ($inputOri_p as $k) {
					if(!empty($k['dInputPD'])){
					 echo "<tr><td>";
					 echo $i1++;
					 echo "</td><td> <b>".$k['vreq_ori_no']."</b><br> Di Input Oleh ".$k['cAdmPD']."<br>Pada ".$k['dInputPD']."</td><tr>";
					}
				}
				echo "</table></td>";

				echo "<td><table>";
				$i1 = 1;
				foreach ($inputOri_p as $k) {
					 if(!empty($k['dInputAD'])){
					 	echo "<tr><td>";
					 	echo $i1++;
					 	echo "</td><td> <b>".$k['vreq_ori_no']."</b><br> Di Input Oleh ".$k['cAdmAD']."<br>Pada ".$k['dInputAD']."</td><tr>";
					 }
				}
				echo "</table></td>";

				echo "<td><table>";
				$i1 = 1;
				foreach ($inputOri_p as $k) {
					 if(!empty($k['dInputQA'])){
					 	echo "<tr><td>";
					 	echo $i1++;
					 	echo "</td><td> <b>".$k['vreq_ori_no']."</b><br> Di Input Oleh ".$k['cAdmQA']."<br>Pada ".$k['dInputQA']."</td><tr>";
					 }
				}
				echo "</table></td>";
				//Studi PD AD
				$studiPD = "SELECT IF(stp.iapppd>=1,CONCAT(IF(stp.iapppd=2,'Approved','Rejected'),
							' Oleh : ',stp.capppd,' <br>Pada : ',stp.dapppd),'') AS stdPd
							FROM plc2.study_literatur_pd stp WHERE stp.lDeleted=0 AND stp.iupb_id='".$vr['iupb_id']."'";
				$studiPD_p = $this->db_plc0->query($studiPD)->row_array();
				if(empty($studiPD_p['stdPd'])){
					$studiPD_p['stdPd'] = "";
				}
				echo '<td>'.$studiPD_p['stdPd'].'</td>';

				$studiAD = "select if(stpa.iappad>=1,concat(if(stpa.iappad=2,'Approved','Rejected'),
							' Oleh : ',stpa.cappad,' Pada : ',stpa.dappad),'')  as stdAd
							from plc2.study_literatur_ad stpa where stpa.lDeleted=0 and stpa.iupb_id='".$vr['iupb_id']."'";
				$studiAD_p = $this->db_plc0->query($studiAD)->row_array();
				if(empty($studiAD_p['stdAd'])){
					$studiAD_p['stdAd'] = "";
				}
				echo '<td>'.$studiAD_p['stdAd'].'</td>';
			//sAMPLE
				$permSample ="SELECT rs.vreq_nomor, 
					CONCAT (
						(CASE
						  WHEN rs.iapppd=1 THEN 'Reject'
						  WHEN rs.iapppd=2 THEN 'Approve' 
						  END),' Oleh: ',rs.vnip_apppd,
						  ' Pada: ',rs.tapppd
					) AS samAd
					FROM plc2.plc2_upb_request_sample rs 
					WHERE rs.`ldeleted`=0 AND rs.`iupb_id` = '".$vr['iupb_id']."'";
				$permSample_p = $this->db_plc0->query($permSample)->result_array();
				echo "<td><table>";
				$i1 = 1;
				foreach ($permSample_p as $k) { 
					if(!empty($k['samAd'])){
					 	echo "<tr><td>";
					 	echo $i1++; 
					 	echo "</td><td><b>".$k['vreq_nomor']."</b><br>".$k['samAd']."</td><tr>"; 	
				 	}			
				 }
				echo "</table></td>";
				//Purchase
				$purchase = "SELECT pu.`iapppr`, pu.`vpo_nomor`,pu.`vnip_pur`, pu.tapp_pur, 
						ps.`iupb_id` FROM plc2.`plc2_upb_po_detail` pd 
						JOIN plc2.`plc2_upb_po` pu ON pu.`ipo_id` = pd.`ipo_id`
						JOIN plc2.`plc2_upb_request_sample` ps ON pd.`ireq_id` = ps.`ireq_id`
						WHERE pu.`vpo_nomor` IS NOT NULL AND pu.`vnip_pur` IS NOT NULL AND 
						pu.`tapp_pur` IS NOT NULL AND pu.`vpo_nomor` <> '' AND
						pu.`ldeleted` = 0 AND pd.`ldeleted` = 0 AND ps.lDeleted = 0 AND ps.`iupb_id` = '".$vr['iupb_id']."'
						GROUP BY pu.`vpo_nomor`";
				$purchase_p = $this->db_plc0->query($purchase)->result_array();

				echo "<td><table>";
				$i1 = 1;
				foreach ($purchase_p as $k) { 
					if(!empty($k['tapp_pur'])){
				 	echo "<tr><td>";
				 	echo $i1++;
				 	echo "</td><td><b>".$k['vpo_nomor']."</b><br>";

				 	if($k['iapppr']==2){ //Approve
						echo "Approved Oleh ".$k['vnip_pur']."<br>Pada ".$k['tapp_pur']."";
					}else if($k['iapppr']==1){ // Reject
						echo "Rejected Oleh ".$k['vnip_pur']."<br>Pada ".$k['tapp_pur']."";
					}else{
						echo "";
					}

				 	echo "</td><tr>"; 	
				 }
				 				
				 }
				echo "</table></td>";

				$penrsample = "SELECT ro.`iapppr`,ro.`vro_nomor`,ro.`vnip_pur`, ro.tapp_pur, ps.`iupb_id` 
					FROM plc2.`plc2_upb_po_detail` pd 
					JOIN plc2.`plc2_upb_request_sample` ps ON pd.`ireq_id` = ps.`ireq_id`
					JOIN plc2.`plc2_upb_po` pu ON pu.`ipo_id` = pd.`ipo_id`
					JOIN plc2.plc2_upb_ro ro ON ro.`ipo_id` = pu.`ipo_id`
					WHERE ro.`vro_nomor` IS NOT NULL AND ro.`vnip_pur` IS NOT NULL AND 
					ro.`tapp_pur` IS NOT NULL AND
					pu.`ldeleted` = 0 AND pd.`ldeleted` = 0 AND ps.lDeleted = 0 AND ro.`ldeleted` = 0 AND ps.`iupb_id` = '".$vr['iupb_id']."' 
					GROUP BY ro.`vro_nomor`";
				$penrsample_p = $this->db_plc0->query($penrsample)->result_array();

				echo "<td><table>";
				$i1 = 1;
				foreach ($penrsample_p as $k) { 
					//if(!empty($k['tapp_pur'])){
					 	echo "<tr><td>";
					 	echo $i1++;
					 	echo "</td><td><b>".$k['vro_nomor']."</b><br>";

					 	if($k['iapppr']==2){ //Approve
							echo "Approved Oleh ".$k['vnip_pur']."<br>Pada ".$k['tapp_pur']."";
						}else if($k['iapppr']==1){ // Reject
							echo "Rejected Oleh ".$k['vnip_pur']."<br>Pada ".$k['tapp_pur']."";
						}else{
							echo "Waiting Approved";
						}

				 		echo "</td><tr>"; 	
				 	//}
				 				
				 }
				echo "</table></td>";
				//Input Terima
				$sql_input = "SELECT rd.iUjiMikro_bb, ro.`vro_nomor`, ps.`vreq_nomor`,ps.iTujuan_req, rd.vrec_nip_pd,rd.trec_date_pd,rd.vrec_nip_qc,rd.trec_date_qc,rd.vrec_nip_qa, rd.trec_date_qa FROM plc2.`plc2_upb_po_detail` pd 
					JOIN plc2.`plc2_upb_request_sample` ps ON pd.`ireq_id` = ps.`ireq_id`
					JOIN plc2.`plc2_upb_po` pu ON pu.`ipo_id` = pd.`ipo_id`
					JOIN plc2.plc2_upb_ro ro ON ro.`ipo_id` = pu.`ipo_id`
					JOIN plc2.`plc2_upb_ro_detail` rd ON rd.`iro_id` = ro.`iro_id`
					WHERE ro.`vro_nomor` IS NOT NULL 
					AND ro.`vnip_pur` IS NOT NULL 
					AND  ro.`tapp_pur` IS NOT NULL   
					AND pu.`ldeleted` = 0 
					AND pd.`ldeleted` = 0 
					AND ps.lDeleted = 0 
					AND ro.`ldeleted` = 0 
					AND rd.`ldeleted` = 0 
					AND ps.`iupb_id` = '".$vr['iupb_id']."'
					GROUP BY ro.`vro_nomor`";

				$sql_input_p = $this->db_plc0->query($sql_input)->result_array();
				echo "<td><table>";
				$i1 = 1;
				
	    		$tujuan = array(''=>'-','0'=>'-','1'=>'Sample','2'=>'Pilot I','3'=>'Pilot II', '4'=>'Re-Sample','Skala Lab');
				foreach ($sql_input_p as $k) {
					if(!empty($k['vrec_nip_pd'])){
					 echo "<tr><td>";
					 echo $i1++;
					 echo "</td><td> <b>".$k['vro_nomor']."</b> <br>Di Input Oleh ".$k['vrec_nip_pd']."<br>Pada ".$k['trec_date_pd']."
					 <br><b>".$tujuan[$k['iTujuan_req']]."</b></td><tr>";
					}
				}
				echo "</table></td>";

				echo "<td><table>";
				$i1 = 1;
				foreach ($sql_input_p as $k) {
					if(!empty($k['vrec_nip_qc'])){
					 echo "<tr><td>";
					 echo $i1++;
					 echo "</td><td> <b>".$k['vro_nomor']."</b> <br>Di Input Oleh ".$k['vrec_nip_qc']."<br>Pada ".$k['trec_date_qc']."<br><b>".$tujuan[$k['iTujuan_req']]."</b></td><tr>";
					}
				}
				echo "</table></td>";

				echo "<td><table>";
				$i1 = 1;
				foreach ($sql_input_p as $k) {
					if(!empty($k['vrec_nip_qa'])){
					 echo "<tr><td>";
					 echo $i1++;
					 echo "</td><td> <b>".$k['vro_nomor']."</b> <br>Di Input Oleh ".$k['vrec_nip_qa']."<br>Pada ".$k['trec_date_qa']."<br><b>".$tujuan[$k['iTujuan_req']]."</b></td><tr>";
					}
				}
				echo "</table></td>";

				$lchoose = array(''=>'', 1=>'Ya', 0=>'Tidak'); 
				echo "<td><table>";
				$i1 = 1;
				foreach ($sql_input_p as $k) {
					//if(!empty($k['iUjiMikro_bb'])){
					 echo "<tr><td>";
					 
					 if($i1==1){
					 	echo "</td><td> <b>".$k['vro_nomor']."</b> <br><b>".$lchoose[$k['iUjiMikro_bb']]."</b></td><tr>";
					 } 
					 echo $i1++;
					//}
				}
				echo "</table></td>";
				//Uji Mikro
				$mikrobb = "SELECT i.iApprove_draft,i.dApproval_draft,i.cApproval_draft, i.iApprove_mikro_final, i.cApproval_mikro_final, i.dApproval_mikro_final ,i.iUji_spesifik, b.`vreq_nomor`, i.iApprove_uji,i.cApproval_uji,i.dApproval_uji
					FROM plc2.plc2_upb_request_sample_detail a
					JOIN plc2.plc2_upb_request_sample b ON b.ireq_id=a.ireq_id
					JOIN plc2.plc2_upb_ro_detail d ON d.ireq_id=a.ireq_id AND d.raw_id=a.raw_id
					JOIN plc2.plc2_upb_po  e ON e.ipo_id=d.ipo_id
					JOIN plc2.plc2_upb_ro f ON f.iro_id=d.iro_id
					JOIN plc2.plc2_raw_material g ON g.raw_id=a.raw_id
					JOIN plc2.plc2_upb h ON h.iupb_id=b.iupb_id
					JOIN plc2.uji_mikro_bb i ON i.ireqdet_id=a.ireqdet_id
					WHERE 
					a.ldeleted=0
					AND b.ldeleted=0
					AND d.ldeleted=0
					AND e.ldeleted=0
					AND f.ldeleted=0
					AND g.ldeleted=0
					AND h.ldeleted=0
					AND i.lDeleted=0 
					AND h.`iupb_id` = '".$vr['iupb_id']."'
					GROUP by `vreq_nomor`";

				//echo '<td>'.$mikrobb.'</td>';
				$mikrobb_b = $this->db_plc0->query($mikrobb)->result_array();
				echo "<td><table>";
				$i1 = 1;
				foreach ($mikrobb_b as $k) { 
					if(!empty($k['dApproval_uji'])){
				 	echo "<tr><td>";
				 	echo $i1++;
				 	echo "</td><td><b>".$k['vreq_nomor']."</b><br>";

				 	if($k['iApprove_uji']==2){ //Approve
						echo "Approved Oleh ".$k['cApproval_uji']."<br>Pada ".$k['dApproval_uji']."";
					}else if($k['iApprove_uji']==1){ // Reject
						echo "Rejected Oleh ".$k['cApproval_uji']."<br>Pada ".$k['dApproval_uji']."";
					}else if($k['iApprove_uji']==0){
						echo "Waiting for Approval";
					} 
				 	echo "</td><tr>"; 	
				 }
				 				
				 }
				echo "</table></td>";

				echo "<td><table>";
				$i1 = 1;
				$lchoose = array(''=>'', 1=>'Ya', 0=>'Tidak'); 
				foreach ($mikrobb_b as $k) { 
					if(!empty($k['iUji_spesifik'])){
					
					 	echo "<tr><td>";
					 	echo $i1++;
					 	echo "</td><td><b>".$k['vreq_nomor']."</b><br>";
 
						echo $lchoose[$k['iUji_spesifik']];
						 
					 	echo "</td><tr>"; 	
					 }
				 				
				 }
				echo "</table></td>";
				//Draft SOI BB MIKRO 
				echo "<td><table>";
				$i1 = 1;
				foreach ($mikrobb_b as $k) { 
					if(!empty($k['dApproval_draft']) && $k['iApprove_uji']!=0){
					 	echo "<tr><td>";
					 	echo $i1++;
					 	echo "</td><td><b>".$k['vreq_nomor']."</b><br>"; 
						 	if($k['iApprove_draft']==2){ //Approve
								echo "Approved Oleh ".$k['cApproval_draft']."<br>Pada ".$k['dApproval_draft']."";
							}else if($k['iApprove_draft']==1){ // Reject
								echo "Rejected Oleh ".$k['cApproval_draft']."<br>Pada ".$k['dApproval_draft']."";
							}else if($k['iApprove_draft']==0){
								echo "Waiting Approval";
							} 
				 	echo "</td><tr>"; 	
					}
				 				
				 }
				echo "</table></td>";
				//Uji Mikro Final 
				echo "<td><table>";
				$i1 = 1;
				foreach ($mikrobb_b as $k) { 
					if(!empty($k['dApproval_mikro_final']) && $k['iApprove_draft']!=0){
				 	echo "<tr><td>";
				 	echo $i1++;
				 	echo "</td><td><b>".$k['vreq_nomor']."</b><br>";

				 	if($k['iApprove_mikro_final']==2){ //Approve
						echo "Approved Oleh ".$k['cApproval_mikro_final']."<br>Pada ".$k['dApproval_mikro_final']."";
					}else if($k['iApprove_mikro_final']==1){ // Reject
						echo "Rejected Oleh ".$k['cApproval_mikro_final']."<br>Pada ".$k['dApproval_mikro_final']."";
					}else if($k['iApprove_mikro_final']==0){
						echo "Waiting for Approval";
					} 
				 	echo "</td><tr>"; 
				 	}	
				 				
				 }
				echo "</table></td>";
				//Analisa Sample
				

				$analisaSample = "SELECT pu.`vnip_apppd_analisa`, pu.`iapppd_analisa`,pu.`vnip_apppd_analisa` FROM plc2.plc2_upb_ro_detail pu JOIN
					plc2.plc2_upb_request_sample ps ON ps.`ireq_id` = pu.`ireq_id` JOIN 
					plc2.`plc2_upb` pp ON pp.`iupb_id` = ps.`iupb_id`
					WHERE pu.`ldeleted` = 0 AND ps.`ldeleted` = 0 AND pp.`ldeleted` = 0
					AND pp.`iupb_id` = '".$vr['iupb_id']."'";
				$analisaSample_p = $this->db_plc0->query($analisaSample)->result_array();
				echo "<td><table>";
				$i1 = 1;
				foreach ($analisaSample_p as $k) {  
					if(!empty($k['iapppd_analisa'])){
					 	echo "<tr><td>";
					 	echo $i1++;
					 	echo "</td><td>"; 

					 	if(empty($k['tapppd_analisa'])){
					 		$k['tapppd_analisa'] = '-';
					 	}
					 	if($k['iapppd_analisa']==2){ //Approve
							echo "Approved Oleh ".$k['vnip_apppd_analisa']."<br>Pada ".$k['tapppd_analisa']."";
						}else if($k['iapppd_analisa']==1){ // Reject
							echo "Rejected Oleh ".$k['vnip_apppd_analisa']."<br>Pada ".$k['tapppd_analisa']."";
						}else{
							echo "";
						} 
					 	echo "</td><tr>"; 	
					}
				 				
				 }
				echo "</table></td>";

				//Draft Soi BB
				$draftsoibb = "SELECT ds.`cApproval`, ds.`dApproval`,ds.`iApprove`, ds.`vNoDraft`
					FROM plc2.`draft_soi_bb` ds WHERE 
					ds.`lDeleted` = 0 AND 
					ds.`iupb_id` = '".$vr['iupb_id']."'";
				$draftsoibb_b = $this->db_plc0->query($draftsoibb)->result_array();
				echo "<td><table>";
				$i1 = 1;
				foreach ($draftsoibb_b as $k) {  
					if(!empty($k['dApproval'])){
					 	echo "<tr><td>";
					 	echo $i1++;
					 	echo "</td><td><b>".$k['vNoDraft']."</b><br>";

					 	if($k['iApprove']==2){ //Approve
							echo "Approved Oleh ".$k['cApproval']."<br>Pada ".$k['dApproval']."";
						}else if($k['iApprove']==1){ // Reject
							echo "Rejected Oleh ".$k['cApproval']."<br>Pada ".$k['dApproval']."";
						}else if($k['iApprove']==0){
							echo "Waiting For Approval";
						} 
					 	echo "</td><tr>"; 	
				 }
				 				
				 }
				echo "</table></td>";

				//Spesifikasi SOI BB

				$soibb = "SELECT p.`vkode_surat`, p.`vnip_qc`, p.`iappqc`,p.`tapp_qc`, p.`vnip_qa`,p.`iappqa`, p.`tapp_qa` FROM 
				plc2.plc2_upb_soi_bahanbaku p 
					WHERE p.`ldeleted` = 0 AND p.`iupb_id` = '".$vr['iupb_id']."'";
				$soibb_b = $this->db_plc0->query($soibb)->result_array();
				echo "<td><table>";
				$i1 = 1;
				foreach ($soibb_b as $k) {  
					if(!empty($k['tapp_qc'])){
				 	echo "<tr><td>";
				 	echo $i1++;
				 	echo "</td><td><b>".$k['vkode_surat']."</b><br>";

				 	if($k['iappqc']==2){ //Approve
						echo "Approved Oleh ".$k['vnip_qc']."<br>Pada ".$k['tapp_qc']."";
					}else if($k['iappqc']==1){ // Reject
						echo "Rejected Oleh ".$k['vnip_qc']."<br>Pada ".$k['tapp_qc']."";
					}else if($k['iappqc']==0){
						echo "";
					} 
				 	echo "</td><tr>";
				 	}	
				 				
				 }
				echo "</table></td>";

				echo "<td><table>";
				$i1 = 1;
				foreach ($soibb_b as $k) {  
					if(!empty($k['tapp_qa'])){
				 	echo "<tr><td>";
				 	echo $i1++;
				 	echo "</td><td><b>".$k['vkode_surat']."</b><br>";

				 	if($k['iappqa']==2){ //Approve
						echo "Approved Oleh ".$k['vnip_qa']."<br>Pada ".$k['tapp_qa']."";
					}else if($k['iappqa']==1){ // Reject
						echo "Rejected Oleh ".$k['vnip_qa']."<br>Pada ".$k['tapp_qa']."";
					}else{
						echo "Waiting for Approval";
					} 
				 	echo "</td><tr>"; 	
				 	}
				 				
				 }
				echo "</table></td>";

				//Formula Skala Trial 
				//PLC
				
					$formula_skla = "SELECT puf.vkode_surat, puf.tformula_apppd, puf.iformula_apppd,puf.vformula_nip_apppd FROM plc2.`plc2_upb_formula` puf 
						WHERE puf.`ldeleted` = 0 AND puf.`iSubmit` = 1 AND puf.`iupb_id` = '".$vr['iupb_id']."'";
					$formula_skla_p = $this->db_plc0->query($formula_skla)->result_array();
					echo "<td><table>";
					$i1 = 1;
					foreach ($formula_skla_p as $k) {  
						if(!empty($k['tformula_apppd'])){
					 	echo "<tr><td>";
					 	echo $i1++;
					 	echo "</td><td><b>".$k['vkode_surat']."</b><br>";

					 	if($k['iformula_apppd']==2){ //Approve
							echo "Approved Oleh ".$k['vformula_nip_apppd']."<br>Pada ".$k['tformula_apppd']."";
						}else if($k['iformula_apppd']==1){ // Reject
							echo "Rejected Oleh ".$k['vformula_nip_apppd']."<br>Pada ".$k['tformula_apppd']."";
						}else{
							echo "Waiting for Approval";
						} 
					 	echo "</td><tr>"; 	
					 	}
					 				
					 }
					echo "</table></td>";

				
				//PD DETAIL
					/*
					$formula_skla = "SELECT F.vNo_formula , f.`iFinishSkalaTrial`, fp.`iMaster_flow`, fp.`iupb_id`, f.`iApp_formula`, f.`cApp_formula`, f.`dApp_formula` 
						FROM pddetail.`formula_process` fp JOIN
						pddetail.`formula` f ON f.`iFormula_process` = fp.`iFormula_process`
						WHERE  fp.`iMaster_flow` = 1
						AND f.`lDeleted` = 0 AND fp.`lDeleted` = 0 AND fp.`iupb_id` = '".$vr['iupb_id']."'";
					$formula_skla_p = $this->db_plc0->query($formula_skla)->result_array();
					echo "<td><table>";
					$i1 = 1;
					foreach ($formula_skla_p as $k) {  
						if($k['iFinishSkalaTrial']==1){
						 	echo "<tr><td>";
						 	echo $i1++;
						 	echo "</td><td><b>".$k['vNo_formula']."</b><br>";
						 	
							 	if($k['iApp_formula']==2){ //Approve
									echo "Approved Oleh ".$k['cApp_formula']."<br>Pada ".$k['dApp_formula']."";
								}else if($k['iApp_formula']==1){ // Reject
									echo "Rejected Oleh ".$k['cApp_formula']."<br>Pada ".$k['dApp_formula']."";
								}else{
									echo "";
								} 
							
						 	echo "</td><tr>"; 	
					 	}
					 				
					 }
					echo "</table></td>"; 
					*/
					//Formula Skala Trial 
					//PLC
					
						$nextStress = "SELECT puf.vkode_surat, puf.iwithstress FROM plc2.`plc2_upb_formula` puf 
							WHERE puf.`ldeleted` = 0 AND puf.`iSubmit` = 1 AND puf.`iupb_id` = '".$vr['iupb_id']."'";
						$nextStress_p = $this->db_plc0->query($nextStress)->result_array();
						 
						$lchoose = array(''=>'', 1=>'Ya', 0=>'Tidak'); 
						echo "<td><table>";
						$i1 = 1;  

						foreach ($nextStress_p as $k) {  
							if(!empty($k['iwithstress'])){
								if(!empty($k['vkode_surat'])){
							 	echo "<tr><td>";
							 	echo $i1++;
							 	echo "</td><td><b>".$k['vkode_surat']."</b><br>";
								echo $lchoose[$k['iwithstress']]; 
							 	echo "</td><tr>"; 	 
							 	}
						 	}
						 				
						 }
						echo "</table></td>";

						//PD DETAIL
					/*	
						$nextStress = "SELECT F.vNo_formula , f.`iFinishSkalaTrial`, f.iNextStressTest
							FROM pddetail.`formula_process` fp JOIN
							pddetail.`formula` f ON f.`iFormula_process` = fp.`iFormula_process`
							WHERE  fp.`iMaster_flow` = 1
							AND f.`lDeleted` = 0 AND fp.`lDeleted` = 0 AND fp.`iupb_id` = '".$vr['iupb_id']."'";
						$nextStress_p = $this->db_plc0->query($nextStress)->result_array();
						$lchoose = array(''=>'', 1=>'Ya', 0=>'Tidak'); 
						
						echo "<td><table>";
						$i1 = 1;   
						foreach ($nextStress_p as $k) {  
							if($k['iFinishSkalaTrial']==1){
							 	echo "<tr><td>";
							 	echo $i1++;
							 	echo "</td><td><b>".$k['vNo_formula']."</b><br>";
								echo $lchoose[$k['iNextStressTest']]; 
							 	echo "</td><tr>"; 	 
						 	} 		
						 }
						echo "</table></td>";
						///////////////////////////
						
						//////////////////////////
					*///INIBELUM
						//Best Formula
						//Stress Test
						$stresstes = "SELECT pu.`vstress_nip_apppd`, pu.`istress_apppd`, pu.`tstress_apppd`
							FROM plc2.plc2_upb_formula pu
							WHERE pu.`ldeleted` =0 AND pu.`iupb_id` = '".$vr['iupb_id']."' LIMIT 1"; 
						$stresstes_p = $this->db_plc0->query($stresstes)->row_array();
						if(empty($stresstes_p['vstress_nip_apppd'])){
							$stresstes_p['vstress_nip_apppd'] = '-';
						}
						if(empty($stresstes_p['istress_apppd'])){
							$stresstes_p['istress_apppd'] = '-';
						}
						if(empty($stresstes_p['tstress_apppd'])){
							$stresstes_p['tstress_apppd'] = '-';
						}

						if($stresstes_p['istress_apppd']==2){ //Approve
							echo "<td> Approved Oleh ".$stresstes_p['vstress_nip_apppd']."<br>Pada ".$stresstes_p['tstress_apppd']."</td>";
						}else if($stresstes_p['istress_apppd']==1){ // Reject
							echo "<td> Rejected Oleh ".$stresstes_p['vstress_nip_apppd']."<br>Pada ".$stresstes_p['tstress_apppd']."</td>";
						} 
						else{
							echo '<td></td>';
						}

						//Lab
						$skalalab = "SELECT  pf.ilab_apppd, pf.`vlab_nip_apppd`, pf.tlab_apppd FROM 
							plc2.plc2_upb_formula pf WHERE 
							pf.`ldeleted` = 0 AND
							pf.`ilab` <> 1 AND 
							pf.`iformula_apppd` = 2 AND
							pf.`ifor_id` IN (SELECT fo.ifor_id FROM plc2.plc2_upb_formula fo
											 WHERE 
											 (CASE WHEN fo.iwithstress=1 THEN #Cek Melewati StresTest
											 		(CASE WHEN fo.iKeSkala_lab=1 THEN
												 	fo.istress_apppd=2
												 ELSE
													 (CASE WHEN fo.iwithbb=1 AND fo.iwithori=1 THEN 
													 fo.iupb_id IN (SELECT req.iupb_id FROM plc2.plc2_upb_ro_detail rod
													 INNER JOIN plc2.plc2_upb_ro ro ON rod.iro_id=ro.iro_id
													 INNER JOIN plc2.plc2_upb_request_sample req ON req.ireq_id=rod.ireq_id
													 WHERE rod.vwadah IS NOT NULL AND rod.vrec_jum_pd IS NOT NULL)
													 AND fo.iupb_id IN (SELECT ori.iupb_id FROM plc2.plc2_upb_request_originator ori WHERE ori.iapppd=2 AND
													 ori.isent_status=1)
													 WHEN fo.iwithbb=1 AND fo.iwithori=0 THEN
													 fo.iupb_id IN (SELECT req.iupb_id FROM plc2.plc2_upb_ro_detail rod
													 INNER JOIN plc2.plc2_upb_ro ro ON rod.iro_id=ro.iro_id
													 INNER JOIN plc2.plc2_upb_request_sample req ON req.ireq_id=rod.ireq_id
													 WHERE rod.vwadah IS NOT NULL AND rod.vrec_jum_pd IS NOT NULL)
													 WHEN fo.iwithbb=0 AND fo.iwithori=1 THEN
													 fo.iupb_id IN (SELECT ori.iupb_id FROM plc2.plc2_upb_request_originator ori WHERE ori.iapppd=2 AND ori
													.isent_status=1)
													 END)
												 END)
											 	ELSE
											 	fo.iformula_apppd=2
											 END))
							AND pf.`iupb_id` =  '".$vr['iupb_id']."' LIMIT 1"; 
						$skalalab_p = $this->db_plc0->query($skalalab)->row_array();
						if(empty($skalalab_p['ilab_apppd'])){
							$skalalab_p['ilab_apppd'] = '-';
						}
						if(empty($skalalab_p['vlab_nip_apppd'])){
							$skalalab_p['vlab_nip_apppd'] = '-';
						}
						if(empty($skalalab_p['tlab_apppd'])){
							$skalalab_p['tlab_apppd'] = '-';
						}

						if($skalalab_p['ilab_apppd']==2){ //Approve
							echo "<td> Approved Oleh ".$skalalab_p['vlab_nip_apppd']."<br>Pada ".$skalalab_p['tlab_apppd']."</td>";
						}else if($skalalab_p['ilab_apppd']==1){ // Reject
							echo "<td> Rejected Oleh ".$skalalab_p['vlab_nip_apppd']."<br>Pada ".$skalalab_p['tlab_apppd']."</td>";
						} 
						else{
							echo '<td></td>';
						}

						//SOI FG
						$soifg = "SELECT pf.`vkode_surat`, pf.vapppd, pf.dapppd, pf.iapppd, pf.vnip_qa, pf.tapp_qa, pf.iappqa FROM plc2.`plc2_upb_soi_fg` pf 
							WHERE pf.`ldeleted` = 0 AND pf.`iupb_id` = '".$vr['iupb_id']."'";
						$soifg_b = $this->db_plc0->query($soifg)->result_array();
						
						echo "<td><table>";
						$i1 = 1;
						foreach ($soifg_b as $k) {  
							if(!empty($k['dapppd'])){
							 	echo "<tr><td>";
							 	echo $i1++;
							 	echo "</td><td><b>".$k['vkode_surat']."</b><br>";
							 	
								 	if($k['iapppd']==2){ //Approve
										echo "Approved Oleh ".$k['vapppd']."<br>Pada ".$k['dapppd']."";
									}else if($k['iapppd']==1){ // Reject
										echo "Rejected Oleh ".$k['vapppd']."<br>Pada ".$k['dapppd']."";
									}else{
										echo "Waiting for Approval";
									} 
								
							 	echo "</td><tr>"; 	
						 	}
						 				
						 }
						echo "</table></td>"; 

						echo "<td><table>";
						$i1 = 1;
						foreach ($soifg_b as $k) {  
							if(!empty($k['tapp_qa'])){
							 	echo "<tr><td>";
							 	echo $i1++;
							 	echo "</td><td><b>".$k['vkode_surat']."</b><br>";
							 	
								 	if($k['iappqa']==2){ //Approve
										echo "Approved Oleh ".$k['vnip_qa']."<br>Pada ".$k['tapp_qa']."";
									}else if($k['iappqa']==1){ // Reject
										echo "Rejected Oleh ".$k['vnip_qa']."<br>Pada ".$k['tapp_qa']."";
									}else{
										echo "";
									} 
								
							 	echo "</td><tr>"; 	
						 	}
						 				
						 }
						echo "</table></td>"; 

						//Perlu FG

				$perlufg = "SELECT sl.iuji_mikro FROM plc2.`study_literatur_pd` sl WHERE sl.`lDeleted` = 0 AND sl.`iupb_id` = '".$vr['iupb_id']."' LIMIT 1";
				
				$perlufg_p = $this->db_plc0->query($perlufg)->row_array();
				$lchoose = array(''=>'', 1=>'Ya', 0=>'Tidak'); 
				if(!empty($perlufg_p['iuji_mikro'])){
					echo '<td><b>'.$lchoose[$perlufg_p['iuji_mikro']].'</b></td>'; 
				}else{
					echo '<td>-</td>';
				}

				//Uji FG

				$ujifg = "SELECT mf.iappqa_uji, mf.cappqa_uji, mf.dappqa_uji, mf.iappqa_soi, mf.cappqa_soi, mf.dappqa_soi FROM plc2.`mikro_fg` mf JOIN
					plc2.`plc2_upb_formula` puf ON puf.`ifor_id` = mf.`ifor_id`
					WHERE mf.`lDeleted` = 0 AND puf.`ldeleted` = 0 AND puf.`iupb_id` =  '".$vr['iupb_id']."'";
					$ujifg_p = $this->db_plc0->query($ujifg)->result_array();
					echo "<td><table>";
					$i1 = 1;
					foreach ($ujifg_p as $k) {  
						//f($k['iFinishSkalaTrial']==1){
						 	echo "<tr><td>";
						 	echo $i1++;
						 	echo "</td><td>";
						 	
							 	if($k['iappqa_uji']==2){ //Approve
									echo "Approved Oleh ".$k['cappqa_uji']."<br>Pada ".$k['dappqa_uji']."";
								}else if($k['iappqa_uji']==1){ // dappqa_uji
									echo "Rejected Oleh ".$k['cappqa_uji']."<br>Pada ".$k['dappqa_uji']."";
								}else{
									echo "";
								} 
							
						 	echo "</td><tr>"; 	
					 	//}
					 				
					 }
					echo "</table></td>"; 

					$ujifg_p2 = $this->db_plc0->query($ujifg)->result_array();
					echo "<td><table>";
					$i1 = 1;
					foreach ($ujifg_p2 as $k) {  
						//f($k['iFinishSkalaTrial']==1){
						 	echo "<tr><td>";
						 	echo $i1++;
						 	echo "</td><td>";
						 	
							 	if($k['iappqa_soi']==2){ //Approve
									echo "Approved Oleh ".$k['cappqa_soi']."<br>Pada ".$k['dappqa_soi']."";
								}else if($k['iappqa_soi']==1){ // dappqa_uji
									echo "Rejected Oleh ".$k['cappqa_soi']."<br>Pada ".$k['dappqa_soi']."";
								}else{
									echo "";
								} 
							
						 	echo "</td><tr>"; 	
					 	//}
					 				
					 }
					echo "</table></td>";  
				 
					//Validasi MOA

					$vamoa = "SELECT pv.`iapppd`, pv.`capppd`, pv.`dapppd` FROM plc2.`plc2_vamoa` pv WHERE pv.`lDeleted` = 0 AND pv.`iupb_id` = '".$vr['iupb_id']."' LIMIT 1"; 
					$vamoa_v = $this->db_plc0->query($vamoa)->row_array();
					if(empty($vamoa_v['capppd'])){
						$vamoa_v['capppd'] = '-';
					}
					if(empty($vamoa_v['dapppd'])){
						$vamoa_v['dapppd'] = '-';
					}
					if(empty($vamoa_v['iapppd'])){
						$vamoa_v['iapppd'] = '-';
					}

					if($vamoa_v['iapppd']==2){ //Approve
						echo "<td> Approved Oleh ".$vamoa_v['capppd']."<br>Pada ".$vamoa_v['dapppd']."</td>";
					}else if($vamoa_v['iapppd']==1){ // Reject
						echo "<td> Rejected Oleh ".$vamoa_v['capppd']."<br>Pada ".$vamoa_v['dapppd']."</td>";
					} 
					else{
						echo '<td></td>';
					}

						

			 //stabilitaLab

					$stabilitalab = "SELECT pf.`iupb_id`,ps.`iapppd`, ps.`vnip_apppd`, ps.tapppd FROM plc2.plc2_upb_stabilita ps JOIN
						plc2.`plc2_upb_formula` pf ON pf.`ifor_id` = ps.`ifor_id`
						WHERE ps.`ldeleted` = 0 AND ps.`inumber` = (SELECT MAX(st2.inumber) FROM 
						plc2.plc2_upb_stabilita st2 WHERE 
						ps.ifor_id=st2.ifor_id AND st2.ldeleted=0)
						AND pf.`iupb_id` =  '".$vr['iupb_id']."' ";
					$stabilitalab_p = $this->db_plc0->query($stabilitalab)->result_array();

					echo "<td><table>";
					$i1 = 1;
					foreach ($stabilitalab_p as $k) { 
						if($k['iapppd']!=0){
						 	echo "<tr><td>";
						 	echo $i1++;
						 	echo "</td><td>";

						 	if($k['iapppd']==2){ //Approve
								echo "Approved Oleh ".$k['vnip_apppd']."<br>Pada ".$k['tapppd']."";
							}else if($k['iapppd']==1){ // Reject
								echo "Rejected Oleh ".$k['vnip_apppd']."<br>Pada ".$k['tapppd']."";
							}else if($k['iapppd']==0){
								echo "";
							}

						 	echo "</td><tr>"; 	
					 	}
					 				
					 }
					echo "</table></td>";

					//Best Formula

					$bestformula = "SELECT pu.`iupb_id`,pf.`vbest_nip_apppd`,pf.`tbest_apppd` FROM plc2.plc2_upb pu 
							JOIN plc2.`plc2_upb_formula` pf ON pf.`iupb_id` = pu.`iupb_id`
								WHERE 
								pu.`ldeleted` = 0 AND 
								pu.`iappdireksi` = 2 AND
								pu.`iupb_id` IN (SELECT fp.iupb_id 
								FROM pddetail.formula_stabilita f 
								JOIN pddetail.formula_process fp ON fp.iFormula_process=f.iFormula_process
								WHERE f.lDeleted=0
								AND fp.lDeleted=0
								AND f.iKesimpulanStabilita=1
								AND f.iApp_formula=2
								AND fp.iFormula_process IN (SELECT a.iFormula_process 
								FROM pddetail.formula_process a WHERE a.lDeleted=0
								AND a.iMaster_flow IN (6,7,8))) 
								AND pu.`iupb_id`  =  '".$vr['iupb_id']."' LIMIT 1";

							$bestformula_p = $this->db_plc0->query($bestformula)->row_array();
							if(empty($bestformula_p['tbest_apppd'])){
								$bestformula_p['tbest_apppd'] = '-';
							}
							if(!empty($bestformula_p['vbest_nip_apppd'])){
							 	echo "<td> Confirm Oleh ".$bestformula_p['vbest_nip_apppd']."<br>
							 			Pada ".$bestformula_p['tbest_apppd']."</td>";
							}else{
								echo '<td></td>';
							}
					//Appksk
				$appksk = "SELECT pr.iappqa_ksk, pr.`vnip_appqa_ksk`,pr.`tappqa_ksk` FROM plc2.`plc2_upb_ro_detail` pr
					JOIN plc2.`plc2_raw_material` pm ON pm.`raw_id`= pr.`raw_id`
					JOIN plc2.plc2_upb_ro ro ON ro.`iro_id` = pr.`iro_id`
					JOIN plc2.plc2_upb_po po ON po.`ipo_id` = pr.`ipo_id`
					JOIN plc2.`plc2_upb_request_sample` ps ON ps.`ireq_id` = pr.`ireq_id`
					WHERE 
					pr.`ldeleted` = 0 AND
					pm.`ldeleted` = 0 AND
					ro.`ldeleted` = 0 AND
					po.`ldeleted` = 0 AND 
					ps.`ldeleted` = 0 AND
					ps.`iupb_id` = '".$vr['iupb_id']."' LIMIT 1"; 
					$appksk_p = $this->db_plc0->query($appksk)->row_array();
					if(empty($appksk_p['vnip_appqa_ksk'])){
						$appksk_p['vnip_appqa_ksk'] = '-';
					}
					if(empty($appksk_p['tappqa_ksk'])){
						$appksk_p['tappqa_ksk'] = '-';
					}
					if(empty($appksk_p['iappqa_ksk'])){
						$appksk_p['iappqa_ksk'] = '-';
					}

					if($appksk_p['iappqa_ksk']==2){ //Approve
						echo "<td> Approved Oleh ".$appksk_p['vnip_appqa_ksk']."<br>Pada ".$appksk_p['tappqa_ksk']."</td>";
					}else if($appksk_p['iappqa_ksk']==1){ // Reject
						echo "<td> Rejected Oleh ".$appksk_p['vnip_appqa_ksk']."<br>Pada ".$appksk_p['tappqa_ksk']."</td>";
					} 
					else{
						echo '<td></td>';
					}

					//Basic Formula
				$basic = "SELECT pf.`iapppd_basic`, pf.`vbasic_nip_apppd`, pf.`tbasic_apppd` FROM plc2.`plc2_upb_formula` pf JOIN
						plc2.`plc2_upb` pu ON pu.`iupb_id` = pf.`iupb_id`
						WHERE pf.`ldeleted` = 0 AND
						pf.`iupb_id` IN (SELECT plc2_upb.iupb_id
								 FROM (plc2.plc2_upb_ro_detail)
								 INNER JOIN plc2.plc2_upb_ro ON plc2.plc2_upb_ro.iro_id = plc2.plc2_upb_ro_detail.iro_id
								 INNER JOIN plc2.plc2_upb_po ON plc2.plc2_upb_po.ipo_id = plc2.plc2_upb_ro_detail.ipo_id
								 INNER JOIN plc2.plc2_upb_request_sample ON plc2.plc2_upb_request_sample.ireq_id = plc2.plc2_upb_ro_detail.ireq_id
								 INNER JOIN plc2.plc2_upb ON plc2.plc2_upb.iupb_id = plc2.plc2_upb_request_sample.iupb_id
								 WHERE plc2.plc2_upb.iupb_id IN (
								 SELECT fp.iupb_id 
								 FROM pddetail.formula_stabilita f 
								 JOIN pddetail.formula_process fp ON fp.iFormula_process=f.iFormula_process
								 WHERE f.lDeleted=0
								 AND fp.lDeleted=0
								 AND f.iKesimpulanStabilita=1
								 AND f.iApp_formula=2
								 AND fp.iFormula_process IN (SELECT a.iFormula_process 
								 FROM pddetail.formula_process a WHERE a.lDeleted=0
								 AND a.iMaster_flow IN (6,7,8))
								 )

								 AND plc2_upb_ro_detail.ldeleted = 0
								 AND plc2_upb_ro.iclose_po = 1
								 AND plc2_upb.ihold = 0
								 AND plc2_upb_ro_detail.iappqa_ksk=2
								 GROUP BY plc2_upb.iupb_id)
						AND pf.`iupb_id` =   '".$vr['iupb_id']."' LIMIT 1";

						//echo '<td>'.$basic.'</td>';

							$basic_p = $this->db_plc0->query($basic)->row_array();
							if(empty($basic_p['iapppd_basic'])){
								$basic_p['iapppd_basic'] = '-';
							}
							if(empty($basic_p['vbasic_nip_apppd'])){
								$basic_p['vbasic_nip_apppd'] = '-';
							}
							if(empty($basic_p['tbasic_apppd'])){
								$basic_p['tbasic_apppd'] = '-';
							}							 

							if($basic_p['iapppd_basic']==2){ //Approve
								echo "<td> Approved Oleh ".$basic_p['vbasic_nip_apppd']."<br>Pada ".$basic_p['tbasic_apppd']."</td>";
							}else if($basic_p['iapppd_basic']==1){
								echo "<td> Rejected Oleh ".$basic_p['vbasic_nip_apppd']."<br>Pada ".$basic_p['tbasic_apppd']."</td>";
							}else if($basic_p['iapppd_basic']==0){
								echo '<td></td>';
							}else{
								echo '<td></td>';
							}



							//Bahan Baku

							$bahanbaku = "SELECT pu.iapppc, pu.iapppd, pu.iappbd, pu.iappqa, 
					pu.vnip_apppc, pu.vnip_apppd, pu.vnip_appqa, pu.vnip_appbd, 
					pu.tapppc, pu.tapppd, pu.tappqa, pu.tappbd  FROM plc2.`plc2_upb_bahan_kemas` pu  
					WHERE pu.`ldeleted` = 0 AND 
					pu.tapppc IS NOT NULL 
					AND pu.tapppd IS NOT NULL 
					AND pu.tappqa IS NOT NULL 
					AND pu.tappbd IS NOT NULL 
					AND pu.`iupb_id` = '".$vr['iupb_id']."' LIMIT 1"; 
					$bahanbaku_b = $this->db_plc0->query($bahanbaku)->row_array();
					if(empty($bahanbaku_b['iapppc'])){
						$bahanbaku_b['iapppc'] = '-';
					}
					if(empty($bahanbaku_b['iapppd'])){
						$bahanbaku_b['iapppd'] = '-';
					}
					if(empty($bahanbaku_b['iappbd'])){
						$bahanbaku_b['iappbd'] = '-';
					}
					if(empty($bahanbaku_b['iappqa'])){
						$bahanbaku_b['iappqa'] = '-';
					}

					if(empty($bahanbaku_b['tapppc'])){
						$bahanbaku_b['tapppc'] = '-';
					}
					if(empty($bahanbaku_b['tapppd'])){
						$bahanbaku_b['tapppd'] = '-';
					}
					if(empty($bahanbaku_b['tappqa'])){
						$bahanbaku_b['tappqa'] = '-';
					}
					if(empty($bahanbaku_b['tappbd'])){
						$bahanbaku_b['tappbd'] = '-';
					}

					if(empty($bahanbaku_b['vnip_apppc'])){
						$bahanbaku_b['vnip_apppc'] = '-';
					}
					if(empty($bahanbaku_b['vnip_apppd'])){
						$bahanbaku_b['vnip_apppd'] = '-';
					}
					if(empty($bahanbaku_b['vnip_appqa'])){
						$bahanbaku_b['vnip_appqa'] = '-';
					}
					if(empty($bahanbaku_b['vnip_appbd'])){
						$bahanbaku_b['vnip_appbd'] = '-';
					}


					if($bahanbaku_b['iapppc']==2){ //Approve
						echo "<td> Approved Oleh ".$bahanbaku_b['vnip_apppc']."<br>Pada ".$bahanbaku_b['tapppc']."</td>";
					}else if($bahanbaku_b['iapppc']==1){ // Reject
						echo "<td> Rejected Oleh ".$bahanbaku_b['vnip_apppc']."<br>Pada ".$bahanbaku_b['tapppc']."</td>";
					} else if($bahanbaku_b['iapppc']==0){
						echo '<td></td>';
					}else{
						echo '<td></td>';
					}

					if($bahanbaku_b['iapppd']==2){ //Approve
						echo "<td> Approved Oleh ".$bahanbaku_b['vnip_apppd']."<br>Pada ".$bahanbaku_b['tapppd']."</td>";
					}else if($bahanbaku_b['iapppd']==1){ // Reject
						echo "<td> Rejected Oleh ".$bahanbaku_b['vnip_apppd']."<br>Pada ".$bahanbaku_b['tapppd']."</td>";
					} else if($bahanbaku_b['iapppd']==0){
						echo '<td></td>';
					}else{
						echo '<td></td>';
					}

					if($bahanbaku_b['iappbd']==2){ //Approve
						echo "<td> Approved Oleh ".$bahanbaku_b['vnip_appbd']."<br>Pada ".$bahanbaku_b['tappbd']."</td>";
					}else if($bahanbaku_b['iappbd']==1){ // Reject
						echo "<td> Rejected Oleh ".$bahanbaku_b['vnip_appbd']."<br>Pada ".$bahanbaku_b['tappbd']."</td>";
					} 
					else if($bahanbaku_b['iappbd']==0){
						echo '<td></td>';
					}else{
						echo '<td></td>';
					}

					if($bahanbaku_b['iappqa']==2){ //Approve
						echo "<td> Approved Oleh ".$bahanbaku_b['vnip_appqa']."<br>Pada ".$bahanbaku_b['tappqa']."</td>";
					}else if($bahanbaku_b['iappqa']==1){ // Reject
						echo "<td> Rejected Oleh ".$bahanbaku_b['vnip_appqa']."<br>Pada ".$bahanbaku_b['tappqa']."</td>";
					} 
					else if($bahanbaku_b['iappqa']==0){
						echo '<td></td>';
					}else{
						echo '<td></td>';
					}

					//Pembuatan MBR	
			// $pemMbr = "SELECT pm.iapppd_bm, pm.`vnip_apppd_bm`, pm.`tapppd_bm` FROM plc2.`plc2_upb_buat_mbr` pm 
			// 		JOIN plc2.`plc2_upb_formula`  pf ON pf.`ifor_id` = pm.`ifor_id`
			// 		WHERE pm.`ldeleted` = 0 AND pf.`ldeleted` = 0
			// 		AND pf.`iapp_basic` = 2 AND pf.`iapppd_basic` = 2
			// 		AND pf.`iupb_id` NOT IN (SELECT bk.iupb_id FROM plc2.plc2_upb_bahan_kemas bk WHERE bk.iapppc=2 AND bk.iapppd=2 AND bk.iappqa=2 AND bk.iappbd=2 
			// 		AND bk.ldeleted=0 GROUP BY bk.iupb_id)
			// 		AND pf.`iupb_id` = '".$vr['iupb_id']."' LIMIT 1";
			$pemMbr = "SELECT pm.iapppd_bm, pm.`vnip_apppd_bm`, pm.`tapppd_bm` FROM plc2.`plc2_upb_buat_mbr` pm 
					JOIN plc2.`plc2_upb_formula`  pf ON pf.`ifor_id` = pm.`ifor_id`
					WHERE pm.`ldeleted` = 0 AND pf.`ldeleted` = 0
					AND pf.`iapp_basic` = 2 AND pf.`iapppd_basic` = 2 
					AND pf.`iupb_id` = '".$vr['iupb_id']."' LIMIT 1";

					$pemMbr_b = $this->db_plc0->query($pemMbr)->row_array();
					if(empty($pemMbr_b['iapppd_bm'])){
						$pemMbr_b['iapppd_bm'] = '-';
					}
					if(empty($pemMbr_b['vnip_apppd_bm'])){
						$pemMbr_b['vnip_apppd_bm'] = '-';
					}
					if(empty($pemMbr_b['tapppd_bm'])){
						$pemMbr_b['tapppd_bm'] = '-';
					} 

					if($pemMbr_b['iapppd_bm']==2){ //Approve
						echo "<td> Approved Oleh ".$pemMbr_b['vnip_apppd_bm']."<br>Pada ".$pemMbr_b['tapppd_bm']."</td>";
					}else if($pemMbr_b['iapppd_bm']==1){ // Reject
						echo "<td> Rejected Oleh ".$pemMbr_b['vnip_apppd_bm']."<br>Pada ".$pemMbr_b['tapppd_bm']."</td>";
					} 
					else if($pemMbr_b['iapppd_bm']==0){
						echo '<td></td>';
					}else{
						echo '<td></td>';
					}

			//Protokol Valpro
			$valpro = "SELECT pv.`iappqa`, pv.`dappqa`, pv.`vappqa` FROM plc2.`protokol_valpro` pv 
					WHERE pv.`lDeleted` = 0 
					AND pv.`iupb_id` =  '".$vr['iupb_id']."' LIMIT 1";

					$valpro_b = $this->db_plc0->query($valpro)->row_array();
					if(empty($valpro_b['iappqa'])){
						$valpro_b['iappqa'] = '-';
					}
					if(empty($valpro_b['vappqa'])){
						$valpro_b['vappqa'] = '-';
					}
					if(empty($valpro_b['dappqa'])){
						$valpro_b['dappqa'] = '-';
					} 

					if($valpro_b['iappqa']==2){ //Approve
						echo "<td> Approved Oleh ".$valpro_b['vappqa']."<br>Pada ".$valpro_b['dappqa']."</td>";
					}else if($valpro_b['iappqa']==1){ // Reject
						echo "<td> Rejected Oleh ".$valpro_b['vappqa']."<br>Pada ".$valpro_b['dappqa']."</td>";
					} 
					else if($valpro_b['iappqa']==0){
						echo '<td></td>';
					}else{
						echo '<td></td>';
					}


					//Produksi Pilot
			$prodPilot = "SELECT pp.iapppd_pp, pp.vnip_apppd_pp, pp.tapppd_pp FROM plc2.`plc2_upb_formula` pf
				JOIN plc2.`plc2_upb_prodpilot` pp ON pp.`ifor_id` = pf.`ifor_id`
				AND pf.`ibest` = 2 
				AND IF(pp.`iprodpilot_id` IS NOT NULL,pp.`ldeleted` = 0 , pf.`ldeleted` = 0)
				AND pf.`ifor_id` IN (SELECT mb.ifor_id FROM plc2.plc2_upb_buat_mbr mb WHERE mb.iapppd_bm=2)
				AND pf.`iupb_id` IN (SELECT a.iupb_id FROM plc2.protokol_valpro a 
										WHERE a.iappqa =2 
										AND a.lDeleted=0)
				AND IF(pf.`iwithbasic`=1,(pf.`iupb_id` IN (SELECT d.iupb_id
					 FROM plc2.plc2_upb_ro_detail a 
					 JOIN plc2.plc2_upb_request_sample b ON b.ireq_id=a.ireq_id
					 JOIN plc2.plc2_upb_ro c ON c.iro_id=a.iro_id
					 JOIN plc2.plc2_upb d ON d.iupb_id=b.iupb_id
					 JOIN plc2.plc2_raw_material e ON e.raw_id=a.raw_id
					 WHERE 
					 a.vrec_nip_qc IS NOT NULL
					 AND a.trec_date_qc IS NOT NULL
					 AND a.ldeleted=0
					 AND b.ldeleted=0
					 AND c.ldeleted=0
					 AND d.ldeleted=0
					 AND e.ldeleted=0
					 AND b.iTujuan_req=3)),pf.`ldeleted` = 0)
					AND pf.`iupb_id` =  '".$vr['iupb_id']."' LIMIT 1";

					$prodPilot_p = $this->db_plc0->query($prodPilot)->row_array();
					if(empty($prodPilot_p['iapppd_pp'])){
						$prodPilot_p['iapppd_pp'] = '-';
					}
					if(empty($prodPilot_p['vnip_apppd_pp'])){
						$prodPilot_p['vnip_apppd_pp'] = '-';
					}
					if(empty($prodPilot_p['tapppd_pp'])){
						$prodPilot_p['tapppd_pp'] = '-';
					} 

					if($prodPilot_p['iapppd_pp']==2){ //Approve
						echo "<td> Approved Oleh ".$prodPilot_p['vnip_apppd_pp']."<br>Pada ".$prodPilot_p['tapppd_pp']."</td>";
					}else if($prodPilot_p['iapppd_pp']==1){ // Reject
						echo "<td> Rejected Oleh ".$prodPilot_p['vnip_apppd_pp']."<br>Pada ".$prodPilot_p['tapppd_pp']."</td>";
					} 
					else if($prodPilot_p['iapppd_pp']==0){
						echo '<td></td>';
					}else{
						echo '<td></td>';
					}
			//LPP

			/*$lpp = "SELECT pf.`iapppd_lpp`, pf.`dapppd_lpp`,pf.`capppd_lpp` 
				FROM plc2.`plc2_upb_formula` pf
				JOIN plc2.`plc2_upb_prodpilot` pp ON pp.`ifor_id` = pf.`ifor_id`
				JOIN  plc2.`plc2_upb_buat_mbr` pm ON pm.`ifor_id` = pf.`ifor_id`
				WHERE pm.`iapppd_bm` = 2 AND pm.`ldeleted` = 0
				AND pf.`iupb_id` IN (SELECT bk.iupb_id FROM plc2.plc2_upb_bahan_kemas bk WHERE bk.iapppc=2 AND bk.iapppd=2 AND bk.iappqa=2 AND bk.iappbd=2 AND bk.ldeleted=0 GROUP BY bk.iupb_id)
				AND pf.`iupb_id` IN (SELECT DISTINCT(fo.iupb_id) FROM plc2.plc2_upb_formula fo
										INNER JOIN plc2.plc2_upb_prodpilot pr ON pr.ifor_id=fo.ifor_id
										WHERE fo.ldeleted=0 AND pr.ldeleted=0 AND pr.iapppd_pp=2)
				AND pf.`iupb_id` =   '".$vr['iupb_id']."' LIMIT 1";*/
			$lpp = 'SELECT a.iapppd_lpp, a.`dapppd_lpp`, a.`capppd_lpp` FROM plc2.plc2_upb_formula a
					WHERE a.ldeleted=0
					AND a.iapppd_lpp!=1
					AND a.iupb_id="'.$vr['iupb_id'].'"
					ORDER BY a.ifor_id DESC';

					$lpp_p = $this->db_plc0->query($lpp)->row_array();
					if(empty($lpp_p['iapppd_lpp'])){
						$lpp_p['iapppd_lpp'] = '-';
					}
					if(empty($lpp_p['capppd_lpp'])){
						$lpp_p['capppd_lpp'] = '-';
					}
					if(empty($lpp_p['dapppd_lpp'])){
						$lpp_p['dapppd_lpp'] = '-';
					} 

					if($lpp_p['iapppd_lpp']==2){ //Approve
						echo "<td> Approved Oleh ".$lpp_p['capppd_lpp']."<br>Pada ".$lpp_p['dapppd_lpp']."</td>";
					}else if($lpp_p['iapppd_lpp']==1){ // Reject
						echo "<td> Rejected Oleh ".$lpp_p['capppd_lpp']."<br>Pada ".$lpp_p['dapppd_lpp']."</td>";
					} 
					else if($lpp_p['iapppd_lpp']==0){
						echo '<td></td>';
					}else{
						echo '<td></td>';
					}


			//LPO
			$lpo = "SELECT l.`iupb_id` ,l.`iapppd`, l.`dapppd`, l.`vapppd` FROM plc2.lpo l WHERE 
					l.`lDeleted` = 0 
					AND l.`iupb_id` =   '".$vr['iupb_id']."' LIMIT 1";

					$lpo_p = $this->db_plc0->query($lpo)->row_array();
					if(empty($lpo_p['iapppd'])){
						$lpo_p['iapppd'] = '-';
					}
					if(empty($lpo_p['vapppd'])){
						$lpo_p['vapppd'] = '-';
					}
					if(empty($lpo_p['dapppd'])){
						$lpo_p['dapppd'] = '-';
					} 

					if($lpo_p['iapppd']==2){ //Approve
						echo "<td> Approved Oleh ".$lpo_p['vapppd']."<br>Pada ".$lpo_p['dapppd']."</td>";
					}else if($lpo_p['iapppd']==1){ // Reject
						echo "<td> Rejected Oleh ".$lpo_p['vapppd']."<br>Pada ".$lpo_p['dapppd']."</td>";
					} 
					else if($lpo_p['iapppd']==0){
						echo '<td></td>';
					}else{
						echo '<td></td>';
					}

 			//Stabilita Pilot
					$stabilita_pilot = "SELECT psp.iapppd, psp.`vnip_apppd`, psp.`tapppd` FROM plc2.`plc2_upb_stabilita_pilot` psp 
						JOIN plc2.`plc2_upb_formula` pf ON pf.`ifor_id` = psp.`ifor_id`
						WHERE psp.`ldeleted` = 0 AND pf.`ldeleted` = 0
						AND pf.`iupb_id` =  '".$vr['iupb_id']."' ";
					$stabilita_pilot_p = $this->db_plc0->query($stabilita_pilot)->result_array();

					echo "<td><table>";
					$i1 = 1;
					foreach ($stabilita_pilot_p as $k) { 
						
					 	echo "<tr><td>";
					 	echo $i1++;
					 	echo "</td><td>";

					 	if($k['iapppd']==2){ //Approve
							echo "Approved Oleh ".$k['vnip_apppd']."<br>Pada ".$k['tapppd']."";
						}else if($k['iapppd']==1){ // Reject
							echo "Rejected Oleh ".$k['vnip_apppd']."<br>Pada ".$k['tapppd']."";
						}else if($k['iapppd']==0){
							echo "";
						}

					 	echo "</td><tr>"; 	
					 				
					 }
					echo "</table></td>";


				//Validasi Proses
				$valpros = "SELECT vp.`iupb_id` , vp.`iappqa`, vp.`vappqa`, vp.`dappqa` FROM 
					plc2.`validasi_proses` vp 
					WHERE vp.`lDeleted` = 0 AND vp.`iupb_id` = '".$vr['iupb_id']."' LIMIT 1";

					$valpros_p = $this->db_plc0->query($valpros)->row_array();
					if(empty($valpros_p['iappqa'])){
						$valpros_p['iappqa'] = '-';
					}
					if(empty($valpros_p['vappqa'])){
						$valpros_p['vappqa'] = '-';
					}
					if(empty($valpros_p['dappqa'])){
						$valpros_p['dappqa'] = '-';
					} 

					if($valpros_p['iappqa']==2){ //Approve
						echo "<td> Approved Oleh ".$valpros_p['vappqa']."<br>Pada ".$valpros_p['dappqa']."</td>";
					}else if($valpros_p['iappqa']==1){ // Reject
						echo "<td> Rejected Oleh ".$valpros_p['vappqa']."<br>Pada ".$valpros_p['dappqa']."</td>";
					} 
					else if($valpros_p['iappqa']==0){
						echo '<td></td>';
					}else{
						echo '<td></td>';
					}

				 
				//Cek Dokumen
					$cekdokumen = "SELECT p.`iconfirm_dok` , p.`vnip_confirm_dok`, p.`tconfirm_dok` FROM plc2.`plc2_upb` p WHERE
						p.`ldeleted` = 0 AND p.`iupb_id` = '".$vr['iupb_id']."' LIMIT 1";

						$cekdokumen_p = $this->db_plc0->query($cekdokumen)->row_array();
						if(empty($cekdokumen_p['iconfirm_dok'])){
							$cekdokumen_p['iconfirm_dok'] = '-';
						}
						if(empty($cekdokumen_p['vnip_confirm_dok'])){
							$cekdokumen_p['vnip_confirm_dok'] = '-';
						}
						if(empty($cekdokumen_p['tconfirm_dok'])){
							$cekdokumen_p['tconfirm_dok'] = '-';
						} 

						if($cekdokumen_p['iconfirm_dok']==1){ // Reject
							echo "<td> Confirm Oleh ".$cekdokumen_p['vnip_confirm_dok']."<br>Pada ".$cekdokumen_p['tconfirm_dok']."</td>";
						}else{
							echo '<td></td>';
						}
 
					$prareg = "SELECT p.iappbusdev_prareg, p.vnip_appbusdev_prareg, p.tappbusdev_prareg FROM plc2.`plc2_upb` p WHERE
							p.`ldeleted` = 0 AND p.`iupb_id` = '".$vr['iupb_id']."' LIMIT 1";

						$prareg_p = $this->db_plc0->query($prareg)->row_array();
						if(empty($prareg_p['iappbusdev_prareg'])){
							$prareg_p['iappbusdev_prareg'] = '-';
						}
						if(empty($prareg_p['vnip_appbusdev_prareg'])){
							$prareg_p['vnip_appbusdev_prareg'] = '-';
						}
						if(empty($prareg_p['tappbusdev_prareg'])){
							$prareg_p['tappbusdev_prareg'] = '-';
						} 

						if($prareg_p['iappbusdev_prareg']==2){ //Approve
							echo "<td> Approved Oleh ".$prareg_p['vnip_appbusdev_prareg']."<br>Pada ".$prareg_p['tappbusdev_prareg']."</td>";
						}else if($prareg_p['iappbusdev_prareg']==1){ // Reject
							echo "<td> Rejected Oleh ".$prareg_p['vnip_appbusdev_prareg']."<br>Pada ".$prareg_p['tappbusdev_prareg']."</td>";
						} 
						else if($prareg_p['iappbusdev_prareg']==0){
							echo '<td></td>';
						}else{
							echo '<td></td>';
						}


					$hpr = "SELECT p.ttarget_hpr FROM plc2.`plc2_upb` p WHERE
							p.`ldeleted` = 0 AND p.`iupb_id` = '".$vr['iupb_id']."' LIMIT 1";

						$hpr_p = $this->db_plc0->query($hpr)->row_array();
						if(!empty($hpr_p['ttarget_hpr'])){
							echo "<td> Di Input Pada  ".$hpr_p['ttarget_hpr']."</td>";
						}else{
							echo '<td></td>';
						}


					$cregistrasi = "SELECT p.`iconfirm_registrasi`,p.cconfirm_registrasi,p.dconfirm_registrasi FROM 
							plc2.`plc2_upb` p WHERE
							p.`ldeleted` = 0 AND 
							p.`iupb_id` IN (SELECT fp.iupb_id 
																		FROM pddetail.formula_stabilita f 
																		JOIN pddetail.formula_process fp ON fp.iFormula_process=f.iFormula_process
																		WHERE f.lDeleted=0
																		AND fp.lDeleted=0
																		AND f.iKesimpulanStabilita=1
																		AND f.iApp_formula=2
																		AND fp.iFormula_process IN (SELECT a.iFormula_process 
																											FROM pddetail.formula_process a WHERE a.lDeleted=0
																											AND a.iMaster_flow IN (9,10,11)))
							AND p.`iupb_id` IN (SELECT la.iupb_id FROM plc2.coa_pilot_lab la
													WHERE la.lDeleted=0 AND la.iappqa=2)
							AND p.`iupb_id` IN (SELECT up.iupb_id FROM plc2.plc2_upb up
													INNER JOIN plc2.study_literatur_pd st ON up.iupb_id=st.iupb_id
													WHERE (CASE WHEN st.ijenis_sediaan=0
														THEN up.iupb_id IN (SELECT fo.iupb_id FROM plc2.plc2_upb_formula fo 
														INNER JOIN plc2.mikro_fg mi ON mi.ifor_id=fo.ifor_id 
														WHERE mi.iappqa_soi=2 AND mi.lDeleted=0 AND fo.ldeleted=0
														AND fo.iFormula_process IS NOT NULL
														)
														ELSE
															up.iupb_id IN (SELECT la.iupb_id FROM plc2.coa_pilot_lab la WHERE la.lDeleted=0 AND la.iappqa=2)
														END))
							  AND p.`iupb_id` = '".$vr['iupb_id']."' LIMIT 1";

						$creg_p = $this->db_plc0->query($cregistrasi)->row_array();
						if(empty($creg_p['iconfirm_registrasi'])){
							$creg_p['iconfirm_registrasi'] = '-';
						}
						if(empty($creg_p['cconfirm_registrasi'])){
							$creg_p['cconfirm_registrasi'] = '-';
						}
						if(empty($creg_p['dconfirm_registrasi'])){
							$creg_p['dconfirm_registrasi'] = '-';
						} 

						if($creg_p['iconfirm_registrasi']==2){ //Approve
							echo "<td> Approved Oleh ".$creg_p['cconfirm_registrasi']."<br>Pada ".$creg_p['dconfirm_registrasi']."</td>";
						}else if($creg_p['iconfirm_registrasi']==1){ // Reject
							echo "<td> Rejected Oleh ".$creg_p['cconfirm_registrasi']."<br>Pada ".$creg_p['dconfirm_registrasi']."</td>";
						} 
						else if($creg_p['iconfirm_registrasi']==0){
							echo '<td></td>';
						}else{
							echo '<td></td>';
						}

					$registrasi = "SELECT p.iappbusdev_registrasi,p.vnip_appbusdev_registrasi,p.tappbusdev_registrasi 
						FROM plc2.`plc2_upb` p 
						WHERE p.`ldeleted` = 0 
						AND p.`iappdireksi`=2 AND
						p.`iconfirm_registrasi` = 2
						AND p.`iappbd_hpr` = 2
						AND p.`iupb_id` IN (SELECT fo.iupb_id FROM plc2.plc2_upb_stabilita_pilot st
												INNER JOIN plc2.plc2_upb_formula fo ON st.ifor_id=fo.ifor_id
												WHERE st.iapppd=2 AND fo.ldeleted=0 AND st.ldeleted=0)
						AND p.`iupb_id` IN (SELECT la.iupb_id FROM plc2.coa_pilot_lab la
												WHERE la.lDeleted=0 AND la.iappqa=2)
						AND p.`iupb_id` IN (SELECT up.iupb_id FROM plc2.plc2_upb up
												INNER JOIN plc2.study_literatur_pd st ON up.iupb_id=st.iupb_id
												WHERE (CASE WHEN st.ijenis_sediaan=0
													THEN up.iupb_id IN (SELECT fo.iupb_id FROM plc2.plc2_upb_formula fo INNER JOIN plc2.mikro_fg mi ON mi.ifor_id=fo.ifor_id WHERE mi.iappqa_soi=2 AND mi.lDeleted=0 AND fo.ldeleted=0)
													ELSE
														up.iupb_id IN (SELECT la.iupb_id FROM plc2.coa_pilot_lab la WHERE la.lDeleted=0 AND la.iappqa=2)
													END))
						AND p.`iupb_id` ='".$vr['iupb_id']."' LIMIT 1";

						$reg_p = $this->db_plc0->query($registrasi)->row_array();
						if(empty($reg_p['iappbusdev_registrasi'])){
							$reg_p['iappbusdev_registrasi'] = '-';
						}
						if(empty($reg_p['vnip_appbusdev_registrasi'])){
							$reg_p['vnip_appbusdev_registrasi'] = '-';
						}
						if(empty($reg_p['tappbusdev_registrasi'])){
							$reg_p['tappbusdev_registrasi'] = '-';
						} 

						if($reg_p['iappbusdev_registrasi']==2){ //Approve
							echo "<td> Approved Oleh ".$reg_p['vnip_appbusdev_registrasi']."<br>Pada ".$reg_p['tappbusdev_registrasi']."</td>";
						}else if($reg_p['iappbusdev_registrasi']==1){ // Reject
							echo "<td> Rejected Oleh ".$reg_p['vnip_appbusdev_registrasi']."<br>Pada ".$reg_p['tappbusdev_registrasi']."</td>";
						} 
						else if($reg_p['iappbusdev_registrasi']==0){
							echo '<td></td>';
						}else{
							echo '<td></td>';
						}

					$applet = "SELECT p.iappbd_applet,p.cappbd_applet, p.dappbd_applet  FROM plc2.`plc2_upb` p WHERE
							p.`ldeleted` = 0 AND p.`iappdireksi` = 2 AND p.`iappbusdev_registrasi` = 2 AND p.`iappbd_hpr` = 2 AND 
							p.`iupb_id` IN (SELECT fo.iupb_id FROM plc2.plc2_upb_stabilita_pilot st
													INNER JOIN plc2.plc2_upb_formula fo ON st.ifor_id=fo.ifor_id
													WHERE st.iapppd=2 AND fo.ldeleted=0 AND st.ldeleted=0)
							AND p.`iupb_id` IN (SELECT la.iupb_id FROM plc2.coa_pilot_lab la
													WHERE la.lDeleted=0 AND la.iappqa=2)
							AND p.`iupb_id` IN (SELECT up.iupb_id FROM plc2.plc2_upb up
													INNER JOIN plc2.study_literatur_pd st ON up.iupb_id=st.iupb_id
													WHERE (CASE WHEN st.ijenis_sediaan=0
														THEN up.iupb_id IN (SELECT fo.iupb_id FROM plc2.plc2_upb_formula fo INNER JOIN plc2.mikro_fg mi ON mi.ifor_id=fo.ifor_id WHERE mi.iappqa_soi=2 AND mi.lDeleted=0 AND fo.ldeleted=0)
														ELSE
															up.iupb_id IN (SELECT la.iupb_id FROM plc2.coa_pilot_lab la WHERE la.lDeleted=0 AND la.iappqa=2)
														END))
							AND p.`iupb_id` = '".$vr['iupb_id']."' LIMIT 1";

						$applet_p = $this->db_plc0->query($applet)->row_array();
						if(empty($applet_p['iappbd_applet'])){
							$applet_p['iappbd_applet'] = '-';
						}
						if(empty($applet_p['cappbd_applet'])){
							$applet_p['cappbd_applet'] = '-';
						}
						if(empty($applet_p['dappbd_applet'])){
							$applet_p['dappbd_applet'] = '-';
						} 

						if($applet_p['iappbd_applet']==2){ //Approve
							echo "<td> Approved Oleh ".$applet_p['cappbd_applet']."<br>Pada ".$applet_p['dappbd_applet']."</td>";
						}else if($applet_p['iappbd_applet']==1){ // Reject
							echo "<td> Rejected Oleh ".$applet_p['cappbd_applet']."<br>Pada ".$applet_p['dappbd_applet']."</td>";
						} 
						else if($applet_p['iappbd_applet']==0){
							echo '<td></td>';
						}else{
							echo '<td></td>';
						}
						echo '</tr>';


				 

			//Appksk
		}?>
	</tbody>
</table>
</div>
</body>