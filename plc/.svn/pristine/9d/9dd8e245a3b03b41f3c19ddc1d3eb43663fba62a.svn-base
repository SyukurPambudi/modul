 
<?php
/* Generated by Softdev 2 ERP Module Generator 2019-01-04 14:43:17 */
/* Location: ./modules/home/controllers/setup_modul.php */
/* Please DO NOT modify this information : */ 


/*
    Preparation 
    1. untuk load view halaman upload , file berada pada folder partial;
    2. lib auth untuk fungsi check modul



    Parameter need to be change after generate 
    1. plc => change to folder name where this controllers should be there
    2. Static Dropdown => change value for option
    3. Dynamic Dropdown => Change query for option

    Table Sample 
    test.item && test.item_file_upload




*/
 


 
if ( ! defined('BASEPATH')) exit('No direct script access allowed');
class setup_modul extends MX_Controller {
    function __construct() {
        parent::__construct();
        $this->db_schedulercheck = $this->load->database('schedulercheck',false, true);
        $this->load->library('auth');
        $this->db = $this->load->database('hrd',false, true);
        $this->user = $this->auth->user();

        $this->url="setup_modul";

        /*$checkMod = $this->auth->modul_set($this->input->get('modul_id'));
        $this->validation =$checkMod['iValidation'];*/

        $this->modul_id = $this->input->get('modul_id');

    }

    function index($action = '') {
        $action = $this->input->get('action');
        //Bikin Object Baru Nama nya $grid      
        $grid = new Grid;
        $grid->setTitle('Setup Modul');
        $grid->setTable('plc3.m_modul');      
        $grid->setUrl('setup_modul');

        //List Table
        $grid->addList('vKode_modul','iM_flow','vNama_modul','vCodeModule','iType_modul','vDesciption'); 
        $grid->setSortBy('iM_modul');
        $grid->setSortOrder('DESC');  

        //List field
        $grid->addFields('vKode_modul','iM_flow','vNama_modul','idprivi_modules','vCodeModule','iType_modul','vDesciption','vTable_name','vFieldPK','vDept_author','vNip_author','vDept_participant','vNip_participant','detail_activity','detail_field'); 
        //$grid->addFields('vKode_modul','iM_flow','vNama_modul','idprivi_modules','vCodeModule','iType_modul','vDesciption','vDept_author','vNip_author','vDept_participant','vNip_participant','detail_field'); 

        //Setting Grid Width Name 
        /*
        Kamu bisa merubah nama label dari sini, Contoh :
        $grid->setLabel('nama field','nama field yang akan diubah');

        */


        

        $grid->setWidth('iType_modul', '100');
        $grid->setAlign('iType_modul', 'center');
        $grid->setLabel('iType_modul','Tipe Modul');
    


        $grid->setWidth('vKode_modul', '100');
        $grid->setAlign('vKode_modul', 'left');
        $grid->setLabel('vKode_modul','Kode Modul');
    
        $grid->setWidth('iM_flow', '100');
        $grid->setAlign('iM_flow', 'left');
        $grid->setLabel('iM_flow','Flow');
    
        $grid->setWidth('vNama_modul', '250');
        $grid->setAlign('vNama_modul', 'left');
        $grid->setLabel('vNama_modul','Nama Modul');
    
        $grid->setWidth('idprivi_modules', '100');
        $grid->setAlign('idprivi_modules', 'left');
        $grid->setLabel('idprivi_modules','ID Privilege');
    
        $grid->setWidth('vCodeModule', '150');
        $grid->setAlign('vCodeModule', 'left');
        $grid->setLabel('vCodeModule','Code Module ');
    
        $grid->setWidth('vDesciption', '250');
        $grid->setAlign('vDesciption', 'left');
        $grid->setLabel('vDesciption','Deskripsi');
    
        $grid->setWidth('vDept_author', '100');
        $grid->setAlign('vDept_author', 'left');
        $grid->setLabel('vDept_author','Author');
    
        $grid->setWidth('vNip_author', '100');
        $grid->setAlign('vNip_author', 'left');
        $grid->setLabel('vNip_author','NIP Author');
    
        $grid->setWidth('vDept_participant', '100');
        $grid->setAlign('vDept_participant', 'left');
        $grid->setLabel('vDept_participant','Deptartement Participant');
    
        $grid->setWidth('vNip_participant', '100');
        $grid->setAlign('vNip_participant', 'left');
        $grid->setLabel('vNip_participant','NIP Participant');

        $grid->setLabel('vTable_name', 'Nama Table');
        $grid->setLabel('vFieldPK', 'Field Primary Key');
    
//Example modifikasi GRID ERP
    //- Set Query
        /*if ($this->validation) {
            $grid->setQuery('lDeleted = 0 ', null); 
        }*/

        $grid->setQuery('lDeleted = 0 ', null); 
        

/*
    - Set Query
        $grid->setQuery('lDeleted = 0 ', null); 
        $grid->setQuery('plc2_upb.iupb_id IN (select distinct(bk.iupb_id) from plc2.plc2_upb_spesifikasi_fg bk where bk.iappqa=2 and bk.lDeleted=0)', null);  

    - Join Table
        $grid->setJoinTable('hrd.employee', 'employee.cNip = pk_master.vnip', 'inner');

    - Change Field Name
        $grid->changeFieldType('ideleted','combobox','',array(''=>'Pilih',0=>'Aktif',1=>'Tidak aktif'));
*/

      
        $grid->changeFieldType('iType_modul','combobox','',array(''=>'Pilih',1=>'Insert / Update',2=>'Update'));

    //set search
        $grid->setSearch('vKode_modul','vNama_modul');
        
    //set required
        $grid->setRequired('vKode_modul','iM_flow','vNama_modul','idprivi_modules','vCodeModule','vDesciption','vTable_name','vFieldPK','vDept_author','vNip_author','vDept_participant','vNip_participant','iType_modul','dCreate','cCreated','dupdate','cUpdate','lDeleted'); 
        $grid->setGridView('grid');


        switch ($action) {
            case 'json':
                    $grid->getJsonData();
                    break;
            case 'view':
                    $grid->render_form($this->input->get('id'), true);
                    break;

             case 'create':
                    $grid->render_form();
                    break;
             
                case 'createproses':
                    echo $grid->saved_form();
                    break;
            
            case 'update':
                    $grid->render_form($this->input->get('id'));
                    break;
       
            case 'updateproses':
                    $post=$this->input->post();
                    $id=$post["setup_modul_iM_modul"];
                    /*Details Activity*/
                    $Usetup_modul_iM_activity=array();
                    $Isetup_modul_iM_activity=array();

                    $Usetup_modul_iType=array();
                    $Isetup_modul_iType=array(); 

                    $UvDept_assigned=array();
                    $IvDept_assigned=array();

                    $UvNip_assigned=array();
                    $IvNip_assigned=array();

                    $UvDesciption=array();
                    $IvDesciption=array();

                    $UiSort=array();
                    $IiSort=array();

                    $iM_modul_activity=array();

                    foreach ($post as $kpost => $vpost) {
                        if($kpost=="setup_modul_iM_activity"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_iM_activity[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $iM_modul_activity[]=$kplast;
                                        $Usetup_modul_iM_activity[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_iType"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_iType[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                       $Usetup_modul_iType[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_vDept_assigned"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $IvDept_assigned[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                       $UvDept_assigned[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_vNip_assigned"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $IvNip_assigned[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                       $UvNip_assigned[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_vDesciption"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $IvDesciption[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                       $UvDesciption[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_iSort"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $IiSort[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                       $UiSort[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                    }

                    /*Update lDeleted Activity*/
                    $query=array();
                    if(count($iM_modul_activity)>0){
                        $this->db_schedulercheck->where("iM_modul",$id);
                        $this->db_schedulercheck->where_not_in("iM_modul_activity",$iM_modul_activity);
                        $dupdate=array();
                        $dupdate['dupdate']=date("Y-m-d H:i:s");
                        $dupdate['cUpdate']=$this->user->gNIP;
                        $dupdate['lDeleted']=1;
                        $this->db_schedulercheck->update("plc3.m_modul_activity",$dupdate);
                        $query[]=$this->db_schedulercheck->last_query();
                    }else{
                        $this->db_schedulercheck->where("iM_modul",$id);
                        $dupdate=array();
                        $dupdate['dupdate']=date("Y-m-d H:i:s");
                        $dupdate['cUpdate']=$this->user->gNIP;
                        $dupdate['lDeleted']=1;
                        $this->db_schedulercheck->update("plc3.m_modul_activity",$dupdate);
                        $query[]=$this->db_schedulercheck->last_query();
                    }

                    /*Modif or Insert Activity*/
                    if(count($Usetup_modul_iM_activity)>0){
                        foreach ($Usetup_modul_iM_activity as $iddetail => $valini) {
                                $dupdated=array();
                                $dupdated['iM_activity']=$valini;
                                $dupdated['iType']=isset($Usetup_modul_iType[$iddetail])?$Usetup_modul_iType[$iddetail]:"";
                                $dupdated['vDept_assigned']=isset($UvDept_assigned[$iddetail])?$UvDept_assigned[$iddetail]:"";
                                $dupdated['vNip_assigned']=isset($UvNip_assigned[$iddetail])?$UvNip_assigned[$iddetail]:"";
                                $dupdated['vDesciption']=isset($UvDesciption[$iddetail])?$UvDesciption[$iddetail]:"";
                                $dupdated['iSort']=isset($UiSort[$iddetail])?$UiSort[$iddetail]:"";
                                $dupdated['dupdate']=date("Y-m-d H:i:s");
                                $dupdated['cUpdate']=$this->user->gNIP;
                                $this->db_schedulercheck->where('iM_modul_activity',$iddetail);
                                $this->db_schedulercheck->update('plc3.m_modul_activity',$dupdated);
                        }
                    }

                    if(count($Isetup_modul_iM_activity)>0){
                        foreach ($Isetup_modul_iM_activity as $iddinsert => $valinsert) {
                                $dinsertd=array();
                                $dinsertd['iM_modul']=$id;
                                $dinsertd['iM_activity']=$valinsert;
                                $dinsertd['iType']=isset($Isetup_modul_iType[$iddinsert])?$Isetup_modul_iType[$iddinsert]:"";
                                $dinsertd['vDept_assigned']=isset($IvDept_assigned[$iddinsert])?$IvDept_assigned[$iddinsert]:"";
                                $dinsertd['vNip_assigned']=isset($IvNip_assigned[$iddinsert])?$IvNip_assigned[$iddinsert]:"";
                                $dinsertd['vDesciption']=isset($IvDesciption[$iddinsert])?$IvDesciption[$iddinsert]:"";
                                $dinsertd['iSort']=isset($IiSort[$iddinsert])?$IiSort[$iddinsert]:"";
                                $dinsertd['dCreate']=date("Y-m-d H:i:s");
                                $dinsertd['cCreated']=$this->user->gNIP;
                                $this->db_schedulercheck->insert('plc3.m_modul_activity',$dinsertd);
                        }
                    }


                    /*Details Fields*/
                    $Usetup_modul_iM_jenis_field=array();
                    $Isetup_modul_iM_jenis_field=array();
                    
                    $Usetup_modul_vNama_field=array();
                    $Isetup_modul_vNama_field=array();
                    
                    $Usetup_modul_vSource_input=array();
                    $Isetup_modul_vSource_input=array();
                    
                    $Usetup_modul_vSource_input_edit=array();
                    $Isetup_modul_vSource_input_edit=array();
                    
                    $Usetup_modul_vRequirement_field=array();
                    $Isetup_modul_vRequirement_field=array();
                    
                    $Usetup_modul_iValidation=array();
                    $Isetup_modul_iValidation=array();
                    
                    $Usetup_modul_iRequired=array();
                    $Isetup_modul_iRequired=array();
                    
                    $Usetup_modul_vTabel_file=array();
                    $Isetup_modul_vTabel_file=array();

                    $Usetup_modul_vTabel_file_pk_id=array();
                    $Isetup_modul_vTabel_file_pk_id=array();

                    $Usetup_modul_vDept_author=array();
                    $Isetup_modul_vDept_author=array();

                    $Usetup_modul_vNip_author=array();
                    $Isetup_modul_vNip_author=array();

                    $Usetup_modul_vFile_detail=array();
                    $Isetup_modul_vFile_detail=array();

                    $Usetup_modul_iSort=array();
                    $Isetup_modul_iSort=array();

                    $iM_modul_fileds=array();
                    foreach ($post as $kpost => $vpost) {
                        if($kpost=="setup_modul_iM_jenis_field"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_iM_jenis_field[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $iM_modul_fileds[]=$kplast;
                                        $Usetup_modul_iM_jenis_field[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_vNama_field"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_vNama_field[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $Usetup_modul_vNama_field[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_vSource_input"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_vSource_input[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $Usetup_modul_vSource_input[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_vSource_input_edit"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_vSource_input_edit[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $Usetup_modul_vSource_input_edit[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_vRequirement_field"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_vRequirement_field[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $Usetup_modul_vRequirement_field[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_iValidation"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_iValidation[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $Usetup_modul_iValidation[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_iRequired"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_iRequired[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $Usetup_modul_iRequired[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_vDesciption"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_vDesciption[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $Usetup_modul_vDesciption[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_vTabel_file"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_vTabel_file[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $Usetup_modul_vTabel_file[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_vTabel_file_pk_id"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_vTabel_file_pk_id[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $Usetup_modul_vTabel_file_pk_id[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_vDept_author"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_vDept_author[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $Usetup_modul_vDept_author[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_vNip_author"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_vNip_author[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $Usetup_modul_vNip_author[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_vFile_detail"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_vFile_detail[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $Usetup_modul_vFile_detail[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                        if($kpost=="setup_modul_iSort"){
                            foreach ($vpost as $kplast => $vplast) {
                                if($kplast==0){
                                    foreach ($vplast as $kk => $vv) {
                                       $Isetup_modul_iSort[$kk]=$vv;
                                    }
                                }else{
                                    foreach ($vplast as $kk => $vv) {
                                        $Usetup_modul_iSort[$kplast]=$vv;
                                    }
                                }
                            }
                        }
                    }

                    /*Update lDeleted Activity*/
                    if(count($iM_modul_fileds)>0){
                        $this->db_schedulercheck->where("iM_modul",$id);
                        $this->db_schedulercheck->where_not_in("iM_modul_fileds",$iM_modul_fileds);
                        $dupdate=array();
                        $dupdate['dupdate']=date("Y-m-d H:i:s");
                        $dupdate['cUpdate']=$this->user->gNIP;
                        $dupdate['lDeleted']=1;
                        $this->db_schedulercheck->update("plc3.m_modul_fileds",$dupdate);
                    }else{
                        $this->db_schedulercheck->where("iM_modul",$id);
                        $dupdate=array();
                        $dupdate['dupdate']=date("Y-m-d H:i:s");
                        $dupdate['cUpdate']=$this->user->gNIP;
                        $dupdate['lDeleted']=1;
                        $this->db_schedulercheck->update("plc3.m_modul_fileds",$dupdate);
                    }

                     /*Modif or Insert Field*/
                    if(count($Usetup_modul_iM_jenis_field)>0){
                        foreach ($Usetup_modul_iM_jenis_field as $iddetail => $valini) {
                            $dupdated=array();
                            $dupdated['iM_jenis_field']=$valini;
                            $dupdated['vNama_field']=isset($Usetup_modul_vNama_field[$iddetail])?$Usetup_modul_vNama_field[$iddetail]:"";
                            $dupdated['vSource_input']=isset($Usetup_modul_vSource_input[$iddetail])?$Usetup_modul_vSource_input[$iddetail]:"";
                            $dupdated['vSource_input_edit']=isset($Usetup_modul_vSource_input_edit[$iddetail])?$Usetup_modul_vSource_input_edit[$iddetail]:"";
                            $dupdated['vRequirement_field']=isset($Usetup_modul_vRequirement_field[$iddetail])?$Usetup_modul_vRequirement_field[$iddetail]:"";
                            $dupdated['iValidation']=isset($Usetup_modul_iValidation[$iddetail])?$Usetup_modul_iValidation[$iddetail]:"";
                            $dupdated['iRequired']=isset($Usetup_modul_iRequired[$iddetail])?$Usetup_modul_iRequired[$iddetail]:"";
                            $dupdated['vDesciption']=isset($Usetup_modul_vDesciption[$iddetail])?$Usetup_modul_vDesciption[$iddetail]:"";
                            $dupdated['vTabel_file']=isset($Usetup_modul_vTabel_file[$iddetail])?$Usetup_modul_vTabel_file[$iddetail]:"";
                            $dupdated['vTabel_file_pk_id']=isset($Usetup_modul_vTabel_file_pk_id[$iddetail])?$Usetup_modul_vTabel_file_pk_id[$iddetail]:"";
                            $dupdated['vDept_author']=isset($Usetup_modul_vDept_author[$iddetail])?$Usetup_modul_vDept_author[$iddetail]:"";
                            $dupdated['vNip_author']=isset($Usetup_modul_vNip_author[$iddetail])?$Usetup_modul_vNip_author[$iddetail]:"";
                            $dupdated['vFile_detail']=isset($Usetup_modul_vFile_detail[$iddetail])?$Usetup_modul_vFile_detail[$iddetail]:"";
                            $dupdated['iSort']=isset($Usetup_modul_iSort[$iddetail])?$Usetup_modul_iSort[$iddetail]:"";
                            $dupdated['dupdate']=date("Y-m-d H:i:s");
                            $dupdated['cUpdate']=$this->user->gNIP;
                            $this->db_schedulercheck->where('iM_modul_fileds',$iddetail);
                            $this->db_schedulercheck->update('plc3.m_modul_fileds',$dupdated);
                        }
                    }

                     if(count($Isetup_modul_iM_jenis_field)>0){
                        foreach ($Isetup_modul_iM_jenis_field as $iddinsert => $valinsert) {
                                $dinsertd=array();
                                $dinsertd['iM_modul']=$id;
                                $dinsertd['iM_jenis_field']=$valini;
                                $dinsertd['vNama_field']=isset($Isetup_modul_vNama_field[$iddinsert])?$Isetup_modul_vNama_field[$iddinsert]:"";
                                $dinsertd['vSource_input']=isset($Isetup_modul_vSource_input[$iddinsert])?$Isetup_modul_vSource_input[$iddinsert]:"";
                                $dinsertd['vSource_input_edit']=isset($Isetup_modul_vSource_input_edit[$iddinsert])?$Isetup_modul_vSource_input_edit[$iddinsert]:"";
                                $dinsertd['vRequirement_field']=isset($Isetup_modul_vRequirement_field[$iddinsert])?$Isetup_modul_vRequirement_field[$iddinsert]:"";
                                $dinsertd['iValidation']=isset($Isetup_modul_iValidation[$iddinsert])?$Isetup_modul_iValidation[$iddinsert]:"";
                                $dinsertd['iRequired']=isset($Isetup_modul_iRequired[$iddinsert])?$Isetup_modul_iRequired[$iddinsert]:"";
                                $dinsertd['vDesciption']=isset($Isetup_modul_vDesciption[$iddinsert])?$Isetup_modul_vDesciption[$iddinsert]:"";
                                $dinsertd['vTabel_file']=isset($Isetup_modul_vTabel_file[$iddinsert])?$Isetup_modul_vTabel_file[$iddinsert]:"";
                                $dinsertd['vTabel_file_pk_id']=isset($Isetup_modul_vTabel_file_pk_id[$iddinsert])?$Isetup_modul_vTabel_file_pk_id[$iddinsert]:"";
                                $dinsertd['vDept_author']=isset($Isetup_modul_vDept_author[$iddinsert])?$Isetup_modul_vDept_author[$iddinsert]:"";
                                $dinsertd['vNip_author']=isset($Isetup_modul_vNip_author[$iddinsert])?$Isetup_modul_vNip_author[$iddinsert]:"";
                                $dinsertd['vFile_detail']=isset($Isetup_modul_vFile_detail[$iddinsert])?$Isetup_modul_vFile_detail[$iddinsert]:"";
                                $dinsertd['iSort']=isset($Isetup_modul_iSort[$iddinsert])?$Isetup_modul_iSort[$iddinsert]:"";
                                $dinsertd['dCreate']=date("Y-m-d H:i:s");
                                $dinsertd['cCreated']=$this->user->gNIP;
                                $this->db_schedulercheck->insert('plc3.m_modul_fileds',$dinsertd);
                        }
                    }

                    echo $grid->updated_form();
                    break;
        
        
            case 'delete':
                    echo $grid->delete_row();
                    break; 
            /*
                //Ini Merupakan Standart Case Untuk Approve

                case 'approve':
                    echo $this->approve_view();
                    break;
                case 'approve_process':
                    echo $this->approve_process();
                    break;
                case 'reject':
                    echo $this->reject_view();
                    break;
                case 'reject_process':
                    echo $this->reject_process();
                    break;

                
            */ 

                case 'dataDetailsModul':
                    echo $this->dataDetailsModul();
                break; 

                case 'dataDetailsFields':
                    echo $this->dataDetailsFields();
                break;

                case 'download':
                    $this->download($this->input->get('file'));
                    break;
                case 'load_field':
                    $this->load_field();
                    break;
            default:
                    $grid->render_grid();
                    break;
        }
    }

    function load_field(){
        $post = $this->input->post();
        $table = $post['table'];
        $splitted = explode('.', $table);
        $rowData = $post['row']; 

        $sql = 'SELECT k.COLUMN_NAME FROM information_schema.TABLE_CONSTRAINTS t
                JOIN information_schema.KEY_COLUMN_USAGE k
                    USING (CONSTRAINT_NAME, TABLE_SCHEMA, TABLE_NAME)
                WHERE t.CONSTRAINT_TYPE = "PRIMARY KEY"
                    AND t.TABLE_SCHEMA = ?
                    AND t.TABLE_NAME = ? ';
        $arrField = $this->db->query($sql, array($splitted[0], $splitted[1]))->row_array();
        $pk = (!empty($arrField)) ? $arrField['COLUMN_NAME']:'';
        echo $pk;exit();
    }



    //Jika Ingin Menambahkan Seting grid seperti button edit enable dalam kondisi tertentu
    /* 
    function listBox_Action($row, $actions) {
        if ($row->vNo_Or<>'' || $row->vNo_Or<>NULL) { 
                unset($actions['edit']);
        }
        return $actions;
    } 
    */

    function updateBox_setup_modul_detail_activity($field, $id, $value, $rowData) {
        //print_r($rowData);
        $sql = "select * from plc3.m_activity a where a.lDeleted = 0  ";
        $data['activities'] = $this->db_schedulercheck->query($sql)->result_array();
        $sql = "select * 
                from plc3.m_modul_activity pr 
                join plc3.m_modul b on b.iM_modul=pr.iM_modul
                where b.vCodeModule='".$rowData['vCodeModule']."'
                and pr.lDeleted=0
                order by pr.iSort ASC
                 ";

        $data['rows'] = $this->db_schedulercheck->query($sql)->result_array();
            
        /*DataActivity*/
        $this->db_schedulercheck->where('lDeleted',0);
        $data['listActivity']=$this->db_schedulercheck->get('plc3.m_activity')->result_array();

        // return $this->load->view('setup_modul_detail_activity',$data,TRUE);
        $data['get']=$this->input->get();
        $data['id']=$this->input->get('id');
        return $this->load->view('template/grid/master_module_activity_details',$data,TRUE);
    }


    function updateBox_setup_modul_detail_field($field, $id, $value, $rowData) {
        //print_r($rowData);
        $sql = "select * from plc3.m_activity a where a.lDeleted = 0  ";
        $data['activities'] = $this->db_schedulercheck->query($sql)->result_array();
        $sql = "select * 
                from plc3.m_modul_activity pr 
                join plc3.m_modul b on b.iM_modul=pr.iM_modul
                where b.vCodeModule='".$rowData['vCodeModule']."'
                and pr.lDeleted=0
                order by pr.iSort ASC
                 ";

        $data['rows'] = $this->db_schedulercheck->query($sql)->result_array();
            
        /*DataActivity*/
        $this->db_schedulercheck->where('lDeleted',0);
        $data['listField']=$this->db_schedulercheck->get('plc3.m_jenis_field')->result_array();

        // return $this->load->view('setup_modul_detail_activity',$data,TRUE);
        $data['get']=$this->input->get();
        $data['id']=$this->input->get('id');
        return $this->load->view('template/grid/master_module_fields_details',$data,TRUE);
    }


    function insertBox_setup_modul_vKode_modul($field, $id) {
        $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
        return $return;
    }
    
    function updateBox_setup_modul_vKode_modul($field, $id, $value, $rowData) {
            if ($this->input->get('action') == 'view') {
                 $return= $value; 
            }else{ 
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

            }
            
        return $return;
    }
    
    function insertBox_setup_modul_iM_flow($field, $id) {
        $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
        return $return;
    }
    
    function updateBox_setup_modul_iM_flow($field, $id, $value, $rowData) {
            if ($this->input->get('action') == 'view') {
                 $return= $value; 
            }else{ 
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

            }
            
        return $return;
    }
    
    function insertBox_setup_modul_vNama_modul($field, $id) {
        $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
        return $return;
    }
    
    function updateBox_setup_modul_vNama_modul($field, $id, $value, $rowData) {
            if ($this->input->get('action') == 'view') {
                 $return= $value; 
            }else{ 
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

            }
            
        return $return;
    }
    
    function insertBox_setup_modul_idprivi_modules($field, $id) {
        $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
        return $return;
    }
    
    function updateBox_setup_modul_idprivi_modules($field, $id, $value, $rowData) {
            if ($this->input->get('action') == 'view') {
                 $return= $value; 
            }else{ 
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

            }
            
        return $return;
    }
    
    function insertBox_setup_modul_vCodeModule($field, $id) {
        $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
        return $return;
    }
    
    function updateBox_setup_modul_vCodeModule($field, $id, $value, $rowData) {
            if ($this->input->get('action') == 'view') {
                 $return= $value; 
            }else{ 
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

            }
            
        return $return;
    }
    
    function insertBox_setup_modul_vDesciption($field, $id) {
        $return = '<textarea name="'.$field.'" id="'.$id.'" class="required" style="width: 240px; height: 75px;" size="250" maxlength ="250"></textarea>';
        return $return;
    }
    
    function updateBox_setup_modul_vDesciption($field, $id, $value, $rowData) {
            if ($this->input->get('action') == 'view') {
                 $return= '<label title="Note">'.nl2br($value).'</label>'; 
            }else{ 
                $return = '<textarea name="'.$field.'" id="'.$id.'" class="required" style="width: 240px; height: 75px;" size="250" maxlength ="250">'.nl2br($value).'</textarea>';

            }
            
        return $return;
    }

    function updateBox_setup_modul_vTable_name($field, $id, $value, $rowData) {
        $sql = 'SELECT CONCAT(TABLE_SCHEMA,".",TABLE_NAME) AS TABLE_NAME FROM information_schema.TABLES WHERE TABLE_SCHEMA LIKE "%plc%" ORDER BY TABLE_NAME ASC';
        $pilihan = $this->db->query($sql)->result_array();
        $action = $this->input->get('action');
        $disabled = ($action == 'view') ? 'disabled' : '';
        $return = '<select '.$disabled.' class="input_rows1 required" name="'.$field.'"  id="'.$id.'">';            
        foreach($pilihan as $me) {
            $selected = ($value == $me['TABLE_NAME']) ? 'selected' : '';
            $return .= '<option '.$selected.' value='.$me['TABLE_NAME'].'>'.$me['TABLE_NAME'].'</option>';
        }            
        $return .= '</select>';
        $return .= '<script>
                        var table = $("#'.$id.'").val();
                        $.ajax({
                            url: base_url+"processor/plc/setup/modul?action=load_field",
                            type: "post",
                            data : {
                                table: table,
                                row: "",
                                action: "'.$this->input->get('action').'"
                            },
                            success: function(data) {
                                $("#setup_modul_vFieldPK").val(data);
                            }
                        });

                        $("#'.$id.'").change(function(){
                            $.ajax({
                                url: base_url+"processor/plc/setup/modul?action=load_field",
                                type: "post",
                                data : {
                                    table: $(this).val(),
                                    row: "",
                                    action: "'.$this->input->get('action').'"
                                },
                                success: function(data) {
                                    $("#setup_modul_vFieldPK").val(data);
                                }
                            });
                        })
                    </script>';
    
        return $return;
    }

    function updateBox_setup_modul_vFieldPK($field, $id, $value, $rowData) {
            if ($this->input->get('action') == 'view') {
                 $return= $value; 
            }else{ 
                $return = '<input readonly type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

            }
            
        return $return;
    }
    
    function insertBox_setup_modul_vDept_author($field, $id) {
        $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
        return $return;
    }
    
    function updateBox_setup_modul_vDept_author($field, $id, $value, $rowData) {
            if ($this->input->get('action') == 'view') {
                 $return= $value; 
            }else{ 
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

            }
            
        return $return;
    }
    
    function insertBox_setup_modul_vNip_author($field, $id) {
        $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
        return $return;
    }
    
    function updateBox_setup_modul_vNip_author($field, $id, $value, $rowData) {
            if ($this->input->get('action') == 'view') {
                 $return= $value; 
            }else{ 
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

            }
            
        return $return;
    }
    
    function insertBox_setup_modul_vDept_participant($field, $id) {
        $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
        return $return;
    }
    
    function updateBox_setup_modul_vDept_participant($field, $id, $value, $rowData) {
            if ($this->input->get('action') == 'view') {
                 $return= $value; 
            }else{ 
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

            }
            
        return $return;
    }
    
    function insertBox_setup_modul_vNip_participant($field, $id) {
        $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
        return $return;
    }
    
    function updateBox_setup_modul_vNip_participant($field, $id, $value, $rowData) {
            if ($this->input->get('action') == 'view') {
                 $return= $value; 
            }else{ 
                $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

            }
            
        return $return;
    }
                        
    /*
        //Ini Merupakan Standart Approve yang digunakan di erp
        function approve_view() {
            $echo = '<script type="text/javascript">
                         function submit_ajax(form_id) {
                            return $.ajax({
                                url: $("#"+form_id).attr("action"),
                                type: $("#"+form_id).attr("method"),
                                data: $("#"+form_id).serialize(),
                                success: function(data) {
                                    var o = $.parseJSON(data);
                                    var last_id = o.last_id;
                                    var url = "'.base_url().'processor/home/setup_modul";                             
                                    if(o.status == true) { 
                                        $("#alert_dialog_form").dialog("close");
                                             $.get(url+"?action=update&id="+last_id, function(data) {
                                             $("div#form_setup_modul").html(data);
                                             
                                        });
                                        
                                    }
                                        reload_grid("grid_setup_modul");
                                }
                                
                             })
                         }
                     </script>';
            $echo .= '<h1>Approve</h1><br />';
            $echo .= '<form id="form_setup_modul_approve" action="'.base_url().'processor/home/setup_modul?action=approve_process" method="post">';
            $echo .= '<div style="vertical-align: top;">';
            $echo .= 'Remark : 
                    <input type="hidden" name="iM_modul" value="'.$this->input->get('iM_modul').'" />
                    <input type="hidden" name="modul_id" value="'.$this->input->get('modul_id').'" />
                    <input type="hidden" name="lvl" value="'.$this->input->get('lvl').'" />
                    <input type="hidden" name="group_id" value="'.$this->input->get('group_id').'" />
                    
                    <textarea name="vRemark"></textarea>
            <button type="button" onclick="submit_ajax(\'form_setup_modul_approve\')">Approve</button>';
                
            $echo .= '</div>';
            $echo .= '</form>';
            return $echo;
        } 

        function approve_process() {
            $post = $this->input->post();
            $cNip= $this->user->gNIP;
            $vName= $this->user->gName;
            $iM_modul = $post['iM_modul'];
            $vRemark = $post['vRemark'];
            $lvl = $post['lvl'];

            //Letakan Query Update approve disini

            $data['status']  = true;
            $data['last_id'] = $post['iM_modul'];
            return json_encode($data);
        }
    */


    /*
        //Ini Merupakan Standart Reject yang digunakan di erp
        function reject_view() {
            $echo = '<script type="text/javascript">
                         function submit_ajax(form_id) {
                            var remark = $("#setup_modul_remark").val();
                            if (remark=="") {
                                alert("Remark tidak boleh kosong ");
                                return
                            }

                            return $.ajax({
                                url: $("#"+form_id).attr("action"),
                                type: $("#"+form_id).attr("method"),
                                data: $("#"+form_id).serialize(),
                                success: function(data) {
                                    var o = $.parseJSON(data);
                                    var last_id = o.last_id;
                                    var url = "'.base_url().'processor/home/setup_modul";                             
                                    if(o.status == true) { 
                                        $("#alert_dialog_form").dialog("close");
                                             $.get(url+"?action=update&id="+last_id, function(data) {
                                             $("div#form_setup_modul").html(data);
                                             
                                        });
                                        
                                    }
                                        reload_grid("grid_setup_modul");
                                }
                                
                             })
                         }
                     </script>';
            $echo .= '<h1>Reject</h1><br />';
            $echo .= '<form id="form_setup_modul_reject" action="'.base_url().'processor/home/setup_modul?action=reject_process" method="post">';
            $echo .= '<div style="vertical-align: top;">';
            $echo .= 'Remark : 
                    <input type="hidden" name="iM_modul" value="'.$this->input->get('iM_modul').'" />
                    <input type="hidden" name="modul_id" value="'.$this->input->get('modul_id').'" />
                    <input type="hidden" name="lvl" value="'.$this->input->get('lvl').'" />
                    <input type="hidden" name="group_id" value="'.$this->input->get('group_id').'" />
                    
                    <textarea name="vRemark" id="reject_setup_modul_remark"></textarea>
            <button type="button" onclick="submit_ajax(\'form_setup_modul_reject\')">Reject</button>';
                
            $echo .= '</div>';
            $echo .= '</form>';
            return $echo;
        }


        
        function reject_process() {
            $post = $this->input->post();
            $cNip= $this->user->gNIP;
            $vName= $this->user->gName;
            $iM_modul = $post['iM_modul'];
            $vRemark = $post['vRemark'];
            $lvl = $post['lvl'];

            //Letakan Query Update approve disini

            $data['status']  = true;
            $data['last_id'] = $post['iM_modul'];
            return json_encode($data);
        }
    */


    //Standart Setiap table harus memiliki dCreate , cCreated, dupdate, cUpdate
    function before_insert_processor($row, $postData) {
        $postData['dCreate'] = date('Y-m-d H:i:s');
        $postData['cCreated']=$this->user->gNIP;


        if($postData['isdraft']==true){
            $postData['iSubmit']=0;
        } else{
            $postData['iSubmit']=1;
        } 


        return $postData;

    }
    function before_update_processor($row, $postData) {
        $postData['dUpdate'] = date('Y-m-d H:i:s');
        $postData['cUpdate'] = $this->user->gNIP;

        if($postData['isdraft']==true){
            $postData['iSubmit']=0;
        } else{
            $postData['iSubmit']=1;
        } 


        return $postData; 
    }    

    function after_insert_processor($fields, $id, $postData) {
        //Example After Insert
        /*
        $cNip = $this->sess_auth->gNIP; 
        $sql = 'Place Query In Here';
        $this->db_schedulercheck->query($sql);
        */
    }

    function after_update_processor($fields, $id, $postData) {
        $cNip = $this->user->gNIP; 
        $skg=date('Y-m-d H:i:s');
        $pk = $postData['setup_modul_iM_modul'];


        $modul_activities=$postData['modul_activities'];

        //update detail sekunder
       /* $this->db_schedulercheck->where('iM_modul', $pk);
        $this->db_schedulercheck->update('plc3.m_modul_activity', array('lDeleted'=>1,'cUpdate'=>$cNip,'dupdate'=>$skg));
        
        $iSort = 1;
        foreach($modul_activities as $k2 => $v2) {
            $idet2['iM_modul'] = $pk;
            $idet2['iM_activity'] = $v2;
            $idet2['iSort'] = $iSort;


            $idet2['cCreated'] = $cNip;
            $idet2['dCreate'] = $skg;
            
            $this->db_schedulercheck->insert('plc3.m_modul_activity', $idet2);
            $iSort++;
        }
*/


    }

    function manipulate_insert_button($buttons, $rowData) { 
        //Load Javascript In Here 
        $cNip= $this->user->gNIP;
        $js = $this->load->view('js/standard_js');
        $js .= $this->load->view('js/upload_js');

        $iframe = '<iframe name="setup_modul_frame" id="setup_modul_frame" height="0" width="0"></iframe>';
        
        $save_draft = '<button onclick="javascript:save_draft_btn_multiupload(\'setup_modul\', \' '.base_url().'processor/plc/setup_modul?draft=true \',this,true )"  id="button_save_draft_setup_modul"  class="ui-button-text icon-save" >Save as Draft</button>';
        $save = '<button onclick="javascript:save_btn_multiupload(\'setup_modul\', \' '.base_url().'processor/plc/setup_modul?company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'modul_id='.$this->input->get('modul_id').' \',this,true )"  id="button_save_submit_setup_modul"  class="ui-button-text icon-save" >Save &amp; Submit</button>';

        

        $buttons['save'] = $iframe.$save_draft.$save.$js;
        
        return $buttons;
    }

    function manipulate_update_button($buttons, $rowData) { 
        $peka=$rowData['iM_modul'];


        //Load Javascript In Here 
       /* $cNip= $this->user->gNIP;
        $js = $this->load->view('js/standard_js');
        $js .= $this->load->view('js/upload_js');

        $iframe = '<iframe name="setup_modul_frame" id="setup_modul_frame" height="0" width="0"></iframe>';
        
        $update_draft = '<button onclick="javascript:update_draft_btn(\'setup_modul\', \' '.base_url().'processor/plc/setup_modul?draft=true \',this,true )"  id="button_update_draft_setup_modul"  class="ui-button-text icon-save" >Update</button>';
        $update = '<button onclick="javascript:update_btn_back(\'setup_modul\', \' '.base_url().'processor/plc/setup_modul?company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'modul_id='.$this->input->get('modul_id').' \',this,true )"  id="button_update_submit_setup_modul"  class="ui-button-text icon-save" >Update &amp; Submit</button>';

        $approve = '<button onclick="javascript:load_popup(\' '.base_url().'processor/plc/setup_modul?action=approve&iM_modul='.$peka.'&company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').' \')"  id="button_approve_setup_modul"  class="ui-button-text icon-save" >Approve</button>';
        $reject = '<button onclick="javascript:load_popup(\' '.base_url().'processor/plc/setup_modul?action=reject&iM_modul='.$peka.'&company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').' \' )"  id="button_reject_setup_modul"  class="ui-button-text icon-save" >Reject</button>';
        



        if ($this->input->get('action') == 'view') {
            unset($buttons['update']);
        }
        else{ 
            $buttons['update'] = $iframe.$update_draft.$js;    
        }*/
        
        return $buttons;
    }

    function whoAmI($nip) { 
        $sql = 'select b.vDescription as vdepartemen,a.*,b.*,c.iLvlemp 
                        from hrd.employee a 
                        join hrd.msdepartement b on b.iDeptID=a.iDepartementID
                        join hrd.position c on c.iPostId=a.iPostID
                        where a.cNip ="'.$nip.'"
                        ';
        
        $data = $this->db_schedulercheck->query($sql)->row_array();
        return $data;
    }

    function download($vFilename) { 
        $this->load->helper('download');        
        $name = $vFilename;
        $id = $_GET['id'];
        $tempat = $_GET['path'];    
        $path = file_get_contents('./files/plc/'.$tempat.'/'.$id.'/'.$name);    
        force_download($name, $path);
    }

    function dataDetailsModul(){
        $post=$this->input->post();
        $get=$this->input->get();
        $nmTable=isset($get['nmTable'])?$get['nmTable']:$this->url;
        $grid=isset($get['grid'])?$get['grid']:$this->url;
        $id=isset($get['id'])?$get['id']:0;
        /*DataActivity*/
        $this->db_schedulercheck->where('lDeleted',0);
        $listActivity=$this->db_schedulercheck->get('plc3.m_activity')->result_array();

        $sql_data="select mo.*,ac.vKode_activity,ac.vNama_activity from plc3.m_modul_activity mo
                join plc3.m_activity ac on ac.iM_activity=mo.iM_activity
                where mo.lDeleted=0 and ac.lDeleted=0 and mo.iM_modul=".$id;
        $q=$this->db_schedulercheck->query($sql_data);
        $rsel=array('hapus','vKode_activity','iType','vDept_assigned','vNip_assigned','vDesciption','iSort');
        $data = new StdClass;
        $data->records=$q->num_rows();
        $i=0;
        foreach ($q->result() as $k) {
            $data->rows[$i]['id']=$i;
            $z=0;
            foreach ($rsel as $dsel => $vsel) {
                if($vsel=="hapus"){
                    $dataar[$dsel]="<input type='hidden' class='num_rows_".$nmTable."' value='".$i."' /><a href='javascript:;' onclick='javascript:hapus_row_".$nmTable."(".$i.")'><center><span class='ui-icon ui-icon-close'></span></center></a>";
                }elseif($vsel=="vKode_activity"){
                    $option="<option value=''>---Pilih---</option>";
                    foreach ($listActivity as $kv => $vv) {
                        $select=$k->iM_activity==$vv['iM_activity']?"selected='selected'":"";
                        $option.="<option value='".$vv['iM_activity']."' ".$select.">".$vv['vKode_activity']." - ".$vv['vNama_activity']."</option>";
                    }
                    $dataar[$dsel]="<select id='".$grid."_iM_activity_".$i."' name='".$grid."_iM_activity[".$k->iM_modul_activity."][]'>".$option."</select>";
                }elseif($vsel=="iType"){
                   $option2="<option value=''>---Pilih---</option>";
                    $listType=array(1=>"Insert/Update",2=>"Approval",3=>"Confirmation");
                    foreach ($listType as $kv => $vv) {
                        $select2=$k->iType==$kv?"selected='selected'":"";
                       $option2.="<option value='".$kv."' ".$select2.">".$vv."</option>";
                    }
                    $dataar[$dsel]="<select id='".$grid."_iType_".$i."' name='".$grid."_iType[".$k->iM_modul_activity."][]' ".$select2.">".$option2."</select>";
                }elseif($vsel=="iSort"){
                    $dataar[$dsel]="<input type='text' size='3' id='".$grid."_iSort_".$i."' value='".$k->iSort."' class='numbersOnly required' name='".$grid."_iSort[".$k->iM_modul_activity."][]'>";
                }elseif($vsel=="vDept_assigned"){
                    $dataar[$dsel]="<input type='text' size='10' id='".$grid."_vDept_assigned_".$i."' value='".$k->vDept_assigned."' class='required' name='".$grid."_vDept_assigned[".$k->iM_modul_activity."][]'>";
                }elseif($vsel=="vNip_assigned"){
                    $dataar[$dsel]="<input type='text' size='20' id='".$grid."_vNip_assigned_".$i."' value='".$k->vNip_assigned."' class='required' name='".$grid."_vNip_assigned[".$k->iM_modul_activity."][]'>";
                }elseif($vsel=="vDesciption"){
                    $dataar[$dsel]="<textarea id='".$grid."_vDesciption_".$i."' class='required' name='".$grid."_vDesciption[".$k->iM_modul_activity."][]' size='250'>".$k->{$vsel}."</textarea>";
                }else{
                    $dataar[$dsel]=$k->{$vsel};
                }
                $z++;
            }
            $data->rows[$i]['cell']=$dataar;
            $i++;
        }
        return json_encode($data);
    }

    function dataDetailsFields(){
        $post=$this->input->post();
        $get=$this->input->get();
        $nmTable=isset($get['nmTable'])?$get['nmTable']:$this->url;
        $grid=isset($get['grid'])?$get['grid']:$this->url;
        $id=isset($get['id'])?$get['id']:0;
        /*DataActivity*/
        $this->db_schedulercheck->where('lDeleted',0);
        $listField=$this->db_schedulercheck->get('plc3.m_jenis_field')->result_array();

        $this->db_schedulercheck->where('lDeleted',0);
        $this->db_schedulercheck->where('iM_modul',$id);
        $this->db_schedulercheck->order_by("iSort", "ASC");
        $q=$this->db_schedulercheck->get('plc3.m_modul_fileds');
        $rsel=array('hapus','iM_jenis_field','vNama_field','vSource_input','vSource_input_edit','vRequirement_field','iValidation','iRequired','vDesciption','vTabel_file','vTabel_file_pk_id','vDept_author','vNip_author','vFile_detail','iSort');
        $data = new StdClass;
        $data->records=$q->num_rows();
        $i=0;
        
        $listTypeyesno=array(1=>"Iya",2=>"Tidak");
        
        foreach ($q->result() as $k) {
            $data->rows[$i]['id']=$i;
            $z=0;
            foreach ($rsel as $dsel => $vsel) {
                if($vsel=="hapus"){
                    $dataar[$dsel]="<input type='hidden' class='num_rows_".$nmTable."' value='".$i."' /><a href='javascript:;' onclick='javascript:hapus_row_".$nmTable."(".$i.")'><center><span class='ui-icon ui-icon-close'></span></center></a>";
                }elseif($vsel=="iM_jenis_field"){
                    $option="<option value=''>---Pilih---</option>";
                    foreach ($listField as $kv => $vv) {
                        $select=$k->iM_jenis_field==$vv['iM_jenis_field']?"selected='selected'":"";
                        $option.="<option value='".$vv['iM_jenis_field']."' ".$select.">".$vv['vKode_field']." - ".$vv['vNama_field']."</option>";
                    }
                    $dataar[$dsel]="<select id='".$grid."_iM_jenis_field_".$i."' name='".$grid."_iM_jenis_field[".$k->iM_modul_fileds."][]'><?php echo $option ?></select>";
                }elseif($vsel=="vNama_field"){
                    $dataar[$dsel]="<input type='text' size='20' id='".$grid."_vNama_field_".$i."' value='".$k->vNama_field."' class='' name='".$grid."_vNama_field[".$k->iM_modul_fileds."][]'>";
                }elseif($vsel=="vSource_input"){
                    $dataar[$dsel]="<textarea id='".$grid."_vSource_input_".$i."' class='' name='".$grid."_vSource_input[".$k->iM_modul_fileds."][]' size='250'>".$k->{$vsel}."</textarea>";
                }elseif($vsel=="vSource_input_edit"){
                    $dataar[$dsel]="<textarea id='".$grid."_vSource_input_edit_".$i."' class='' name='".$grid."_vSource_input_edit[".$k->iM_modul_fileds."][]' size='250'>".$k->{$vsel}."</textarea>";
                }elseif($vsel=="vRequirement_field"){
                    $dataar[$dsel]="<textarea id='".$grid."_vRequirement_field_".$i."' class='' name='".$grid."_vRequirement_field[".$k->iM_modul_fileds."][]' size='250'>".$k->{$vsel}."</textarea>";
                }elseif($vsel=="iValidation"){
                    $option2yesno1="<option value=''>---Pilih---</option>";
                    foreach ($listTypeyesno as $kv => $vv) {
                        $select=$k->iValidation==$kv?"selected='selected'":"";
                        $option2yesno1.="<option value='".$kv."' ".$select.">".$vv."</option>";
                    }
                    $dataar[$dsel]="<select id='".$grid."_iValidation_".$i."' name='".$grid."_iValidation[".$k->iM_modul_fileds."][]'><?php echo $option2yesno1 ?></select>";
                }elseif($vsel=="iRequired"){
                    $option2yesno1="<option value=''>---Pilih---</option>";
                    foreach ($listTypeyesno as $kv => $vv) {
                        $select=$k->iRequired==$kv?"selected='selected'":"";
                        $option2yesno1.="<option value='".$kv."' ".$select.">".$vv."</option>";
                    }
                    $dataar[$dsel]="<select id='".$grid."_iRequired_".$i."' name='".$grid."_iRequired[".$k->iM_modul_fileds."][]'><?php echo $option2yesno1 ?></select>";
                }elseif($vsel=="vDesciption"){
                    $dataar[$dsel]="<textarea id='".$grid."_vDesciption_".$i."' class='' name='".$grid."_vDesciption[".$k->iM_modul_fileds."][]' size='250'>".$k->{$vsel}."</textarea>";
                }elseif($vsel=="vTabel_file"){
                    $dataar[$dsel]="<input type='text' size='20' id='".$grid."_vTabel_file_".$i."' class='' name='".$grid."_vTabel_file[".$k->iM_modul_fileds."][]' value='".$k->{$vsel}."' />";
                }elseif($vsel=="vTabel_file_pk_id"){
                    $dataar[$dsel]="<input type='text' size='20' id='".$grid."_vTabel_file_pk_id_".$i."' class='' name='".$grid."_vTabel_file_pk_id[".$k->iM_modul_fileds."][]' value='".$k->{$vsel}."' />";
                }elseif($vsel=="vDept_author"){
                    $dataar[$dsel]="<input type='text' size='12' id='".$grid."_vDept_author_".$i."' class='' name='".$grid."_vDept_author[".$k->iM_modul_fileds."][]' value='".$k->{$vsel}."' />";
                }elseif($vsel=="vNip_author"){
                    $dataar[$dsel]="<input type='text' size='12' id='".$grid."_vNip_author_".$i."' class='' name='".$grid."_vNip_author[".$k->iM_modul_fileds."][]' value='".$k->{$vsel}."' />";
                }elseif($vsel=="vFile_detail"){
                    $dataar[$dsel]="<input type='text' size='18' id='".$grid."_vFile_detail_".$i."' class='' name='".$grid."_vFile_detail[".$k->iM_modul_fileds."][]' value='".$k->{$vsel}."' />";
                }elseif($vsel=="iSort"){
                    $dataar[$dsel]="<input type='text' size='3' id='".$grid."_iSort_".$i."' class='' name='".$grid."_iSort[".$k->iM_modul_fileds."][]' value='".$k->{$vsel}."' />";
                }else{
                    $dataar[$dsel]=$k->{$vsel};
                }
                $z++;
            }
            $data->rows[$i]['cell']=$dataar;
            $i++;
        }
        return json_encode($data);
    }

    //Output
    public function output(){
        $this->index($this->input->get('action'));
    }

}
